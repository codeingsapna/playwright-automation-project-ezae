import { test, expect } from '@playwright/test';
import { waitForPaceLoad,login,execute_learningplan_activation_cron,tostr_detector,login_superadmin,attachNetworkLogger} from '../tests2/common_reuseable_functions';


test.use({ storageState: 'storageState.json' });

// create new company and execute all test inside that company
test('create_new_company_for_execute_all_scenarios', async ({ page }) => {
     test.setTimeout(2000000);
 await login(page);
   // create company
    await page.goto('adminShowCompanies.php');
    await waitForPaceLoad(page);
 
    const playwright_company_name = 'playwright_allScenario_company_' + Math.floor(Math.random() * 100000);
    await page.evaluate((val)=>{localStorage.setItem("company",val);},playwright_company_name);
 
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    await page.fill('#name', playwright_company_name);
    await page.click('.note-editable');
    await page.fill('.note-editable','This company is created by playwright automation tool. for testing  create company scenario.');
    await page.click('#createButton');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout:4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… company created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ company not created (validation / no toastr /save button didn't trigger)");
    }
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.goto('adminShowCompanies.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentcompanyGrid');
    const gridText = await page.locator('#contentcompanyGrid').innerText();
    const companyFound = gridText.includes(playwright_company_name);
    if (companyFound) {
        console.log(`\x1b[32mâœ… Verified: Company "${playwright_company_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Company "${playwright_company_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    // go inside the new company and create data
    const storedCompany = await page.evaluate(() => localStorage.getItem('company'));
    console.log(`\x1b[32mðŸ“¦ Company retrieved from localStorage: ${storedCompany}\x1b[0m`);
    const companyDropdown = page.locator('#companySelect');
    await companyDropdown.waitFor({ state: 'visible' });
    await companyDropdown.selectOption({ label: storedCompany });
    const selectedValue = await companyDropdown.inputValue();
    console.log(`\x1b[32mðŸ¢ Selected company value: ${selectedValue}\x1b[0m`);
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);

    // set  storage size  in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#plan"]').click();
    await page.locator('#filespacequota').click();
    await page.locator('#filespacequota').fill('0.3');
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);
});
// dynamic skill grading with threshhold

test('original_skill_mapping_with_self_100%', async ({ page }) => {
    test.setTimeout('1200000');
    await attachNetworkLogger(page);
    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('1');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#proficiency_1').click();
    await page.fill('#proficiency_1','basic');
    await page.locator('#proficiency_2').click();
    await page.fill('#proficiency_2','advance');
    await page.locator('#proficiency_3').click();
    await page.fill('#proficiency_3','expert');
    await page.locator('#proficiency_4').click();
    await page.fill('#proficiency_4','pro');
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); 
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSelfAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    //  try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);



    // create skills
    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname1);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description1 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description1 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description1 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description1 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname2);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description2 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description2 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description2 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description2 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname3);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'behavioral'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description3 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description3 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description3 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description3 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname4);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description4 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description4 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description4 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description4 for expert level');
    await page.click('#saveSkillBtn');
   await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname5);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description5 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description5 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description5 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description5 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname6);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description6 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description6 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description6 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description6 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname7);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description7 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description7 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description7 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description7 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });


    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });


    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    await waitForPaceLoad(page);
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    await waitForPaceLoad(page);
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    await waitForPaceLoad(page);
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    await waitForPaceLoad(page);


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.locator('#contentskillsGrid').waitFor({state : 'visible'});
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    const skillN1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    await page.locator('.progress-admin-main', { hasText: skillN1 }).locator('input#customRange2').fill('2');
    const skillN2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    await page.locator('.progress-admin-main', { hasText: skillN2 }).locator('input#customRange2').fill('3');
    const skillN3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    await page.locator('.progress-admin-main', { hasText: skillN3 }).locator('input#customRange2').fill('1');
    const skillN4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    await page.locator('.progress-admin-main', { hasText: skillN4 }).locator('input#customRange2').fill('3');
    const skillN5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    await page.locator('.progress-admin-main', { hasText: skillN5 }).locator('input#customRange2').fill('2');
    const skillN6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    await page.locator('.progress-admin-main', { hasText: skillN6 }).locator('input#customRange2').fill('1');
    const skillN7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    await page.locator('.progress-admin-main', { hasText: skillN7 }).locator('input#customRange2').fill('4');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});

  

   
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#basic_username').fill(self_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m',"learner logged in successfully.");


    // self user  attempt skill grading
    await page.goto('userui/dashboard/');
    await page.getByRole('link', { name: 'My Skills' }).click();
    await page.getByRole('button', { name: 'Start Rating' }).click();
    // await page.click('.ant-btn-primary');
    async function setAllSliders(page) {
      // Attach console listener once
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });

      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 4 },
          { name: localStorage.getItem('skillname2'), value: 3 },
          { name: localStorage.getItem('skillname3'), value: 1 },
          { name: localStorage.getItem('skillname4'), value: 2 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 3 },
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 3) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});


  // admin login call
  await login(page);

  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 3) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue == useruiprogress){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }


    
  //delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);



    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','role deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});
test('original_skill_mapping_with_L1_100%', async ({ page }) => {
    test.setTimeout('1200000');

  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.locator('#saveNewBtn').waitFor({ state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('1');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#proficiency_1').click();
    await page.fill('#proficiency_1','basic');
    await page.locator('#proficiency_2').click();
    await page.fill('#proficiency_2','advance');
    await page.locator('#proficiency_3').click();
    await page.fill('#proficiency_3','expert');
    await page.locator('#proficiency_4').click();
    await page.fill('#proficiency_4','pro');
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);



    // create skills
    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname1);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description1 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description1 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description1 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description1 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname2);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description2 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description2 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description2 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description2 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname3);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'behavioral'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description3 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description3 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description3 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description3 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname4);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description4 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description4 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description4 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description4 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname5);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description5 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description5 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description5 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description5 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname6);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description6 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description6 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description6 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description6 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname7);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description7 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description7 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description7 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description7 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({ state: 'hidden' });

    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });


    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    await waitForPaceLoad(page);
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    await waitForPaceLoad(page);
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    await waitForPaceLoad(page);
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    await waitForPaceLoad(page);


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    const skillN1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    await page.locator('.progress-admin-main', { hasText: skillN1 }).locator('input#customRange2').fill('2');
    const skillN2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    await page.locator('.progress-admin-main', { hasText: skillN2 }).locator('input#customRange2').fill('3');
    const skillN3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    await page.locator('.progress-admin-main', { hasText: skillN3 }).locator('input#customRange2').fill('1');
    const skillN4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    await page.locator('.progress-admin-main', { hasText: skillN4 }).locator('input#customRange2').fill('3');
    const skillN5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    await page.locator('.progress-admin-main', { hasText: skillN5 }).locator('input#customRange2').fill('2');
    const skillN6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    await page.locator('.progress-admin-main', { hasText: skillN6 }).locator('input#customRange2').fill('1');
    const skillN7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    await page.locator('.progress-admin-main', { hasText: skillN7 }).locator('input#customRange2').fill('4');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});


    
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#basic_username').fill(L1_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


    // L1  attempt skill grading
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 2 },
          { name: localStorage.getItem('skillname2'), value: 4 },
          { name: localStorage.getItem('skillname3'), value: 3 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1},
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});


  // admin relogin call
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 3) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue == useruiprogress){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }

    
  //delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);



    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);


});
test('original_skill_mapping_with_L2_100%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.locator('#saveNewBtn').waitFor({ state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.locator('#saveNewBtn').waitFor({ state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.locator('#saveNewBtn').waitFor({ state: 'visible' });
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.locator('#saveNewBtn').waitFor({ state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }

    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('1');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#proficiency_1').click();
    await page.fill('#proficiency_1','basic');
    await page.locator('#proficiency_2').click();
    await page.fill('#proficiency_2','advance');
    await page.locator('#proficiency_3').click();
    await page.fill('#proficiency_3','expert');
    await page.locator('#proficiency_4').click();
    await page.fill('#proficiency_4','pro');
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSkipLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    

    // create skills
    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname1);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description1 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description1 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description1 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description1 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname2);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description2 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description2 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description2 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description2 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname3);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'behavioral'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description3 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description3 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description3 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description3 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname4);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description4 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description4 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description4 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description4 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname5);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description5 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description5 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description5 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description5 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname6);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description6 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description6 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description6 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description6 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname7);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#level1SkillDescriptionInput');
    await page.fill('#level1SkillDescriptionInput', 'description7 for beginner level');
    await page.click('#level2SkillDescriptionInput');
    await page.fill('#level2SkillDescriptionInput', 'description7 for intermediate level');
    await page.click('#level3SkillDescriptionInput');
    await page.fill('#level3SkillDescriptionInput', 'description7 for knowledgeable level');
    await page.click('#level4SkillDescriptionInput');
    await page.fill('#level4SkillDescriptionInput', 'description7 for expert level');
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});


    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({state:'hidden'});
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({state:'hidden'});
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({state:'hidden'});
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({state:'hidden'});
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({state:'hidden'});



    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});



    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    const skillN1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    await page.locator('.progress-admin-main', { hasText: skillN1 }).locator('input#customRange2').fill('2');
    const skillN2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    await page.locator('.progress-admin-main', { hasText: skillN2 }).locator('input#customRange2').fill('3');
    const skillN3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    await page.locator('.progress-admin-main', { hasText: skillN3 }).locator('input#customRange2').fill('1');
    const skillN4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    await page.locator('.progress-admin-main', { hasText: skillN4 }).locator('input#customRange2').fill('3');
    const skillN5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    await page.locator('.progress-admin-main', { hasText: skillN5 }).locator('input#customRange2').fill('2');
    const skillN6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    await page.locator('.progress-admin-main', { hasText: skillN6 }).locator('input#customRange2').fill('1');
    const skillN7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    await page.locator('.progress-admin-main', { hasText: skillN7 }).locator('input#customRange2').fill('4');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});


    
    // login L2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state:'visible'});
    await page.locator('#basic_username').click();
    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#basic_username').fill(L1_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


    // L2  attempt skill grading
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 2 },
          { name: localStorage.getItem('skillname2'), value: 4 },
          { name: localStorage.getItem('skillname3'), value: 3 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1},
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
   await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state:'visible'});


  // admin relogin call
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 3) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  await page.waitForTimeout(3000);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue == useruiprogress){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }


  //delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});
test('original_skill_mapping_with_self_L1_50%', async ({ page }) => {
    test.setTimeout('1200000');

  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }

    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });    
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('2');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#proficiency_1').click();
    await page.fill('#proficiency_1','basic');
    await page.locator('#proficiency_2').click();
    await page.fill('#proficiency_2','advance');
    await page.locator('#proficiency_3').click();
    await page.fill('#proficiency_3','expert');
    await page.locator('#proficiency_4').click();
    await page.fill('#proficiency_4','pro');
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSelfAssessment').click();
    await page.locator('#isLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);
  

    // create skills
    await page.goto('createTags1.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });

  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname1);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi = page.locator('li.clickable div.eh4', { hasText: playwright_skillname1 }).last();
  await expect(newLi).toBeVisible();
  const latestId = await newLi.getAttribute('data-id');
  console.log('\x1b[32m%s\x1b[0m','Latest data-id:', latestId);
  await page.locator(`[id="${latestId}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a Java class implement multiple interfaces?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname2);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi1 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname2 }).last();
  await expect(newLi1).toBeVisible();
  const latestId2 = await newLi1.getAttribute('data-id');
  console.log('\x1b[32m%s\x1b[0m','Latest data-id:', latestId2);
  await page.locator(`[id="${latestId2}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does PHP support both procedural and object-oriented programming?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname3);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi3 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname3 }).last();
  await expect(newLi3).toBeVisible();
  const latestId3 = await newLi3.getAttribute('data-id');
  console.log('\x1b[32m%s\x1b[0m','Latest data-id:', latestId3);
  await page.locator(`[id="${latestId3}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is active listening an essential part of effective communication?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname4);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi4 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname4}).last();
  await expect(newLi4).toBeVisible();
  const latestId4 = await newLi4.getAttribute('data-id');
  console.log('\x1b[32m%s\x1b[0m','Latest data-id:', latestId4);
  await page.locator(`[id="${latestId4}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does delegation of tasks improve team productivity?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname5);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi5 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname5 }).last();
  await expect(newLi5).toBeVisible();
  const latestId5 = await newLi5.getAttribute('data-id');
  console.log('\x1b[32m%s\x1b[0m','Latest data-id:', latestId5);
  await page.locator(`[id="${latestId5}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is Python a dynamically typed programming language?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname6);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi6 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname6 }).last();
  await expect(newLi6).toBeVisible();
  const latestId6 = await newLi6.getAttribute('data-id');
  console.log('\x1b[32m%s\x1b[0m','Latest data-id:', latestId6);
  await page.locator(`[id="${latestId6}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can unit testing help in detecting bugs early in the development cycle?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname7);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi7 = page.locator('li.clickable div.eh4', { hasText:playwright_skillname7 }).last();
  await expect(newLi7).toBeVisible();
  const latestId7 = await newLi7.getAttribute('data-id');
  console.log('\x1b[32m%s\x1b[0m','Latest data-id:', latestId7);
  await page.locator(`[id="${latestId7}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a table in SQL have more than one primary key?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});



    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });


    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    const skillN1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    await page.locator('.progress-admin-main', { hasText: skillN1 }).locator('input#customRange2').fill('4');
    const skillN2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    await page.locator('.progress-admin-main', { hasText: skillN2 }).locator('input#customRange2').fill('2');
    const skillN3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    await page.locator('.progress-admin-main', { hasText: skillN3 }).locator('input#customRange2').fill('1');
    const skillN4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    await page.locator('.progress-admin-main', { hasText: skillN4 }).locator('input#customRange2').fill('3');
    const skillN5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    await page.locator('.progress-admin-main', { hasText: skillN5 }).locator('input#customRange2').fill('2');
    const skillN6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    await page.locator('.progress-admin-main', { hasText: skillN6 }).locator('input#customRange2').fill('3');
    const skillN7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    await page.locator('.progress-admin-main', { hasText: skillN7 }).locator('input#customRange2').fill('2');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});

    
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#basic_username').fill(self_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


    // self user  attempt skill grading
    await page.goto('userui/dashboard/');
    await page.getByRole('link', { name: 'My Skills' }).click();
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 1 },
          { name: localStorage.getItem('skillname2'), value: 3 },
          { name: localStorage.getItem('skillname3'), value: 4 },
          { name: localStorage.getItem('skillname4'), value: 2 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 3 },
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    const L5_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
  // login L1 user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L1_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l1 logged in successfully.');



  // give grading from l1 for self user
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 2 },
          { name: localStorage.getItem('skillname2'), value: 4 },
          { name: localStorage.getItem('skillname3'), value: 3 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1},
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});

  // admin login call
  await login(page);

  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 3) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);

  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue == useruiprogress){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }


  // delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});
test('original_skill_mapping_with_self_L2_50%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }



    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });  
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('2');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#proficiency_1').click();
    await page.fill('#proficiency_1','basic');
    await page.locator('#proficiency_2').click();
    await page.fill('#proficiency_2','advance');
    await page.locator('#proficiency_3').click();
    await page.fill('#proficiency_3','expert');
    await page.locator('#proficiency_4').click();
    await page.fill('#proficiency_4','pro');
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSelfAssessment').click();
    await page.locator('#isSkipLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);



 // create skills
    await page.goto('createTags1.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });

  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname1);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi = page.locator('li.clickable div.eh4', { hasText: playwright_skillname1 }).last();
  await expect(newLi).toBeVisible();
  const latestId = await newLi.getAttribute('data-id');
  console.log('Latest data-id:', latestId);
  await page.locator(`[id="${latestId}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a Java class implement multiple interfaces?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname2);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi1 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname2 }).last();
  await expect(newLi1).toBeVisible();
  const latestId2 = await newLi1.getAttribute('data-id');
  console.log('Latest data-id:', latestId2);
  await page.locator(`[id="${latestId2}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does PHP support both procedural and object-oriented programming?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname3);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi3 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname3 }).last();
  await expect(newLi3).toBeVisible();
  const latestId3 = await newLi3.getAttribute('data-id');
  console.log('Latest data-id:', latestId3);
  await page.locator(`[id="${latestId3}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is active listening an essential part of effective communication?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname4);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi4 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname4}).last();
  await expect(newLi4).toBeVisible();
  const latestId4 = await newLi4.getAttribute('data-id');
  console.log('Latest data-id:', latestId4);
  await page.locator(`[id="${latestId4}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does delegation of tasks improve team productivity?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname5);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi5 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname5 }).last();
  await expect(newLi5).toBeVisible();
  const latestId5 = await newLi5.getAttribute('data-id');
  console.log('Latest data-id:', latestId5);
  await page.locator(`[id="${latestId5}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is Python a dynamically typed programming language?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname6);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi6 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname6 }).last();
  await expect(newLi6).toBeVisible();
  const latestId6 = await newLi6.getAttribute('data-id');
  console.log('Latest data-id:', latestId6);
  await page.locator(`[id="${latestId6}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can unit testing help in detecting bugs early in the development cycle?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname7);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi7 = page.locator('li.clickable div.eh4', { hasText:playwright_skillname7 }).last();
  await expect(newLi7).toBeVisible();
  const latestId7 = await newLi7.getAttribute('data-id');
  console.log('Latest data-id:', latestId7);
  await page.locator(`[id="${latestId7}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a table in SQL have more than one primary key?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});




    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });



    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    const skillN1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    await page.locator('.progress-admin-main', { hasText: skillN1 }).locator('input#customRange2').fill('4');
    const skillN2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    await page.locator('.progress-admin-main', { hasText: skillN2 }).locator('input#customRange2').fill('2');
    const skillN3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    await page.locator('.progress-admin-main', { hasText: skillN3 }).locator('input#customRange2').fill('1');
    const skillN4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    await page.locator('.progress-admin-main', { hasText: skillN4 }).locator('input#customRange2').fill('3');
    const skillN5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    await page.locator('.progress-admin-main', { hasText: skillN5 }).locator('input#customRange2').fill('2');
    const skillN6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    await page.locator('.progress-admin-main', { hasText: skillN6 }).locator('input#customRange2').fill('3');
    const skillN7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    await page.locator('.progress-admin-main', { hasText: skillN7 }).locator('input#customRange2').fill('2');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});

    
    // login self user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#basic_username').fill(self_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


    // self user  attempt skill grading
    await page.goto('userui/dashboard/');
    await page.getByRole('link', { name: 'My Skills' }).click();
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 1 },
          { name: localStorage.getItem('skillname2'), value: 3 },
          { name: localStorage.getItem('skillname3'), value: 4 },
          { name: localStorage.getItem('skillname4'), value: 2 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 3 },
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  // login L2 user
  const L2_userName = await page.evaluate(() => {return localStorage.getItem("username2");});
  // const L5_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.goto('userui/login/');
  await page.locator('#basic_username').waitFor({state : 'visible'});
  await page.locator('#basic_username').click();
  await page.locator('#basic_username').fill(L2_userName);
  await page.locator('#basic_password').click();
  await page.locator('#basic_password').fill('12345678');
  await page.getByRole('button', { name: 'Log In' }).click();
  await page.waitForURL('userui/dashboard/');
  await page.waitForLoadState('networkidle');
  console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


  // give grading from l2 for self user
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 3 },
          { name: localStorage.getItem('skillname2'), value: 3 },
          { name: localStorage.getItem('skillname3'), value: 2 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1 },
          { name: localStorage.getItem('skillname7'), value: 2 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});


  //admin  re-login call  
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 3) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue == useruiprogress){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }




  // delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);



    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);



    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);



    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});
test('original_skill_mapping_with_L1_&_L2_50%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });  
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('2');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#proficiency_1').click();
    await page.fill('#proficiency_1','basic');
    await page.locator('#proficiency_2').click();
    await page.fill('#proficiency_2','advance');
    await page.locator('#proficiency_3').click();
    await page.fill('#proficiency_3','expert');
    await page.locator('#proficiency_4').click();
    await page.fill('#proficiency_4','pro');
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isLeaderAssessment').click();
    await page.locator('#isSkipLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);
    

    // create skills
    await page.goto('createTags1.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });

  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname1);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi = page.locator('li.clickable div.eh4', { hasText: playwright_skillname1 }).last();
  await expect(newLi).toBeVisible();
  const latestId = await newLi.getAttribute('data-id');
  console.log('Latest data-id:', latestId);
  await page.locator(`[id="${latestId}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a Java class implement multiple interfaces?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname2);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi1 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname2 }).last();
  await expect(newLi1).toBeVisible();
  const latestId2 = await newLi1.getAttribute('data-id');
  console.log('Latest data-id:', latestId2);
  await page.locator(`[id="${latestId2}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does PHP support both procedural and object-oriented programming?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname3);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi3 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname3 }).last();
  await expect(newLi3).toBeVisible();
  const latestId3 = await newLi3.getAttribute('data-id');
  console.log('Latest data-id:', latestId3);
  await page.locator(`[id="${latestId3}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is active listening an essential part of effective communication?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname4);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi4 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname4}).last();
  await expect(newLi4).toBeVisible();
  const latestId4 = await newLi4.getAttribute('data-id');
  console.log('Latest data-id:', latestId4);
  await page.locator(`[id="${latestId4}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does delegation of tasks improve team productivity?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname5);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi5 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname5 }).last();
  await expect(newLi5).toBeVisible();
  const latestId5 = await newLi5.getAttribute('data-id');
  console.log('Latest data-id:', latestId5);
  await page.locator(`[id="${latestId5}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is Python a dynamically typed programming language?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname6);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi6 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname6 }).last();
  await expect(newLi6).toBeVisible();
  const latestId6 = await newLi6.getAttribute('data-id');
  console.log('Latest data-id:', latestId6);
  await page.locator(`[id="${latestId6}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can unit testing help in detecting bugs early in the development cycle?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname7);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi7 = page.locator('li.clickable div.eh4', { hasText:playwright_skillname7 }).last();
  await expect(newLi7).toBeVisible();
  const latestId7 = await newLi7.getAttribute('data-id');
  console.log('Latest data-id:', latestId7);
  await page.locator(`[id="${latestId7}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a table in SQL have more than one primary key?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.locator('#level1description').click();
  await page.locator('#level1description').fill('this is basic level');
  await page.locator('#level2description').click();
  await page.locator('#level2description').fill('this is advance level');
  await page.locator('#level3description').click();
  await page.locator('#level3description').fill('this is expert level');
  await page.locator('#level4description').click();
  await page.locator('#level4description').fill('this is pro level');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});


    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });


    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });



    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    const skillN1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    await page.locator('.progress-admin-main', { hasText: skillN1 }).locator('input#customRange2').fill('2');
    const skillN2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    await page.locator('.progress-admin-main', { hasText: skillN2 }).locator('input#customRange2').fill('3');
    const skillN3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    await page.locator('.progress-admin-main', { hasText: skillN3 }).locator('input#customRange2').fill('1');
    const skillN4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    await page.locator('.progress-admin-main', { hasText: skillN4 }).locator('input#customRange2').fill('3');
    const skillN5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    await page.locator('.progress-admin-main', { hasText: skillN5 }).locator('input#customRange2').fill('2');
    const skillN6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    await page.locator('.progress-admin-main', { hasText: skillN6 }).locator('input#customRange2').fill('1');
    const skillN7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    await page.locator('.progress-admin-main', { hasText: skillN7 }).locator('input#customRange2').fill('4');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});


    
    // login L1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#basic_username').fill(L1_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


    // L1  attempt skill grading
   await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 2 },
          { name: localStorage.getItem('skillname2'), value: 4 },
          { name: localStorage.getItem('skillname3'), value: 3 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1 },
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});




    // login l2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    const L2_userName = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#basic_username').fill(L2_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l2 logged in successfully.');


    // L2  attempt skill grading
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click();
    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('input.ant-select-selection-search-input').fill(self_userName);
    await page.locator('.ant-select-dropdown .ant-select-item-option', { hasText: self_userName }).waitFor({state:'visible'});
    await page.locator('.ant-select-dropdown .ant-select-item-option', { hasText: self_userName }).click();
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 3 },
          { name: localStorage.getItem('skillname2'), value: 2 },
          { name: localStorage.getItem('skillname3'), value: 3 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1},
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});




  // admin relogin call
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 3) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue == useruiprogress){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }




  //delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });  
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});
test('original_skill_mapping_with_self_l1_L2_33%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('3');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#proficiency_1').click();
    await page.fill('#proficiency_1','basic');
    await page.locator('#proficiency_2').click();
    await page.fill('#proficiency_2','advance');
    await page.locator('#proficiency_3').click();
    await page.fill('#proficiency_3','expert');
    await page.locator('#proficiency_4').click();
    await page.fill('#proficiency_4','pro');
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSelfAssessment').click();
    await page.locator('#isLeaderAssessment').click();
    await page.locator('#isSkipLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);


    // create skills
    await page.goto('createTags1.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });

    const sub_playwright_skillname1 = await page.evaluate(() => {
      let subskill1 = 'sub_unit_playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', subskill1); return subskill1;
    });
    const sub_playwright_skillname2 = await page.evaluate(() => {
      let subskill2 = 'sub_unit_playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', subskill2); return subskill2;
    });
    const sub_playwright_skillname3 = await page.evaluate(() => {
      let subskill3 = 'sub_unit_playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', subskill3); return subskill3;
    });
    const sub_playwright_skillname4 = await page.evaluate(() => {
      let subskill4 = 'sub_unit_playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', subskill4); return subskill4;
    });
    const sub_playwright_skillname5 = await page.evaluate(() => {
      let subskill5 = 'sub_unit_playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', subskill5); return subskill5;
    });
    const sub_playwright_skillname6 = await page.evaluate(() => {
      let subskill6 = 'sub_unit_playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', subskill6); return subskill6;
    });
    const sub_playwright_skillname7 = await page.evaluate(() => {
      let subskill7 = 'sub_unit_playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', subskill7); return subskill7;
    });

    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname1);
    await page.getByRole('button', { name: 'Save' }).click();
    const newLi = page.locator('li.clickable div.eh4', { hasText: playwright_skillname1 }).last();
    await expect(newLi).toBeVisible();
    const latestId = await newLi.getAttribute('data-id');
    console.log('Latest data-id:', latestId);
    await page.locator(`[id="${latestId}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname1);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSubLi = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname1 }).last();
    await expect(newLi).toBeVisible();
    const latestSubId = await newSubLi.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSubId); 
    await page.locator(`[id="${latestId}"] div`).filter({ hasText: `${playwright_skillname1} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSubId}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can a Java class implement multiple interfaces?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is advance level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is expert level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname2);
    await page.getByRole('button', { name: 'Save' }).click();
    const new2Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname2 }).last();
    await expect(new2Li).toBeVisible();
    const latestId2 = await new2Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId2);
    await page.locator(`[id="${latestId2}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname2);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub2Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname2 }).last();
    await expect(new2Li).toBeVisible();
    const latestSub2Id = await newSub2Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub2Id);
    await page.locator(`[id="${latestId2}"] div`).filter({ hasText: `${playwright_skillname2} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub2Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Does PHP support both procedural and object-oriented programming?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is advance level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is expert level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname3);
    await page.getByRole('button', { name: 'Save' }).click();
    const new3Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname3 }).last();
    await expect(new3Li).toBeVisible();
    const latestId3 = await new3Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId3);
    await page.locator(`[id="${latestId3}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname3);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub3Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname3 }).last();
    await expect(new3Li).toBeVisible();
    const latestSub3Id = await newSub3Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub3Id);
    await page.locator(`[id="${latestId3}"] div`).filter({ hasText: `${playwright_skillname3} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub3Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Is active listening an essential part of effective communication?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is advance level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is expert level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname4);
    await page.getByRole('button', { name: 'Save' }).click();
    const new4Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname4 }).last();
    await expect(new4Li).toBeVisible();
    const latestId4 = await new4Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId4);
    await page.locator(`[id="${latestId4}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname4);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub4Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname4 }).last();
    await expect(new4Li).toBeVisible();
    const latestSub4Id = await newSub4Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub4Id);
    await page.locator(`[id="${latestId4}"] div`).filter({ hasText: `${playwright_skillname4} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub4Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Does delegation of tasks improve team productivity?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is advance level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is expert level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname5);
    await page.getByRole('button', { name: 'Save' }).click();
    const new5Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname5 }).last();
    await expect(new5Li).toBeVisible();
    const latestId5 = await new5Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId5);
    await page.locator(`[id="${latestId5}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname5);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub5Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname5 }).last();
    await expect(new5Li).toBeVisible();
    const latestSub5Id = await newSub5Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub5Id);
    await page.locator(`[id="${latestId5}"] div`).filter({ hasText: `${playwright_skillname5} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub5Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Is Python a dynamically typed programming language?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is advance level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is expert level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname6);
    await page.getByRole('button', { name: 'Save' }).click();
    const new6Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname6 }).last();
    await expect(new6Li).toBeVisible();
    const latestId6 = await new6Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId6);
    await page.locator(`[id="${latestId6}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname6);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub6Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname6 }).last();
    await expect(new6Li).toBeVisible();
    const latestSub6Id = await newSub6Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub6Id);
    await page.locator(`[id="${latestId6}"] div`).filter({ hasText: `${playwright_skillname6} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub6Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can unit testing help in detecting bugs early in the development cycle?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is advance level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is expert level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname7);
    await page.getByRole('button', { name: 'Save' }).click();
    const new7Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname7 }).last();
    await expect(new7Li).toBeVisible();
    const latestId7 = await new7Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId7);
    await page.locator(`[id="${latestId7}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname7);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub7Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname7 }).last();
    await expect(new7Li).toBeVisible();
    const latestSub7Id = await newSub7Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub7Id);
    await page.locator(`[id="${latestId7}"] div`).filter({ hasText: `${playwright_skillname7} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub7Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can a table in SQL have more than one primary key?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is advance level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is expert level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});




    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);

    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });



    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    const skillN1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    await page.locator('.progress-admin-main', { hasText: skillN1 }).locator('input#customRange2').fill('4');
    const skillN2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    await page.locator('.progress-admin-main', { hasText: skillN2 }).locator('input#customRange2').fill('2');
    const skillN3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    await page.locator('.progress-admin-main', { hasText: skillN3 }).locator('input#customRange2').fill('1');
    const skillN4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    await page.locator('.progress-admin-main', { hasText: skillN4 }).locator('input#customRange2').fill('3');
    const skillN5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    await page.locator('.progress-admin-main', { hasText: skillN5 }).locator('input#customRange2').fill('2');
    const skillN6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    await page.locator('.progress-admin-main', { hasText: skillN6 }).locator('input#customRange2').fill('3');
    const skillN7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    await page.locator('.progress-admin-main', { hasText: skillN7 }).locator('input#customRange2').fill('2');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});


    
    // login self user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#basic_username').fill(self_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('learner logged in successfully.');


    // self user  attempt skill grading
    await page.goto('userui/dashboard/');
    await page.getByRole('link', { name: 'My Skills' }).click();
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 1 },
          { name: localStorage.getItem('skillname2'), value: 3 },
          { name: localStorage.getItem('skillname3'), value: 4 },
          { name: localStorage.getItem('skillname4'), value: 2 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 3 },
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log("â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log("âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});




    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    const L5_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
  // login L1 user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    // const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#basic_username').fill(L1_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('learner logged in successfully.');

  // give grading from l1 for self user
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );

    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    await page.waitForTimeout(2000);
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 2 },
          { name: localStorage.getItem('skillname2'), value: 4 },
          { name: localStorage.getItem('skillname3'), value: 3 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1},
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log("â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log("âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  const L2_userName = await page.evaluate(() => {return localStorage.getItem("username2");});

  // login L2 user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L2_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('learner logged in successfully.')


  // give grading from l2 for self user
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );

    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 3 },
          { name: localStorage.getItem('skillname2'), value: 3 },
          { name: localStorage.getItem('skillname3'), value: 2 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1 },
          { name: localStorage.getItem('skillname7'), value: 2 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log("â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log("âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log("Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  //admin  re-login call  
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 3) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  await page.waitForTimeout(3000);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue == useruiprogress){
    page.once('dialog', async dialog => {
      console.log('Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }




  // delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});
// threshold level 5 and 6 with self_L1_L2_33% 
test('original_skill_mapping_with_thershold_5', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state: 'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }



    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('3');
    await page.locator('#maxProficiencyLevel').selectOption('5');
    await page.locator('#proficiency_1').click();
    await page.fill('#proficiency_1','basic');
    await page.locator('#proficiency_2').click();
    await page.fill('#proficiency_2','intermediate');
    await page.locator('#proficiency_3').click();
    await page.fill('#proficiency_3','advance');
    await page.locator('#proficiency_4').click();
    await page.fill('#proficiency_4','expert');
    await page.locator('#proficiency_5').click();
    await page.fill('#proficiency_5','pro');
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSelfAssessment').click();
    await page.locator('#isLeaderAssessment').click();
    await page.locator('#isSkipLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);


    // create skills
    await page.goto('createTags1.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });

    const sub_playwright_skillname1 = await page.evaluate(() => {
      let subskill1 = 'sub_unit_playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', subskill1); return subskill1;
    });
    const sub_playwright_skillname2 = await page.evaluate(() => {
      let subskill2 = 'sub_unit_playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', subskill2); return subskill2;
    });
    const sub_playwright_skillname3 = await page.evaluate(() => {
      let subskill3 = 'sub_unit_playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', subskill3); return subskill3;
    });
    const sub_playwright_skillname4 = await page.evaluate(() => {
      let subskill4 = 'sub_unit_playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', subskill4); return subskill4;
    });
    const sub_playwright_skillname5 = await page.evaluate(() => {
      let subskill5 = 'sub_unit_playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', subskill5); return subskill5;
    });
    const sub_playwright_skillname6 = await page.evaluate(() => {
      let subskill6 = 'sub_unit_playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', subskill6); return subskill6;
    });
    const sub_playwright_skillname7 = await page.evaluate(() => {
      let subskill7 = 'sub_unit_playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', subskill7); return subskill7;
    });

    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname1);
    await page.getByRole('button', { name: 'Save' }).click();
    const newLi = page.locator('li.clickable div.eh4', { hasText: playwright_skillname1 }).last();
    await expect(newLi).toBeVisible();
    const latestId = await newLi.getAttribute('data-id');
    console.log('Latest data-id:', latestId);
    await page.locator(`[id="${latestId}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname1);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSubLi = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname1 }).last();
    await expect(newLi).toBeVisible();
    const latestSubId = await newSubLi.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSubId); 
    await page.locator(`[id="${latestId}"] div`).filter({ hasText: `${playwright_skillname1} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSubId}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can a Java class implement multiple interfaces?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname2);
    await page.getByRole('button', { name: 'Save' }).click();
    const new2Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname2 }).last();
    await expect(new2Li).toBeVisible();
    const latestId2 = await new2Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId2);
    await page.locator(`[id="${latestId2}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname2);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub2Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname2 }).last();
    await expect(new2Li).toBeVisible();
    const latestSub2Id = await newSub2Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub2Id);
    await page.locator(`[id="${latestId2}"] div`).filter({ hasText: `${playwright_skillname2} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub2Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Does PHP support both procedural and object-oriented programming?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname3);
    await page.getByRole('button', { name: 'Save' }).click();
    const new3Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname3 }).last();
    await expect(new3Li).toBeVisible();
    const latestId3 = await new3Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId3);
    await page.locator(`[id="${latestId3}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname3);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub3Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname3 }).last();
    await expect(new3Li).toBeVisible();
    const latestSub3Id = await newSub3Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub3Id);
    await page.locator(`[id="${latestId3}"] div`).filter({ hasText: `${playwright_skillname3} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub3Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Is active listening an essential part of effective communication?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname4);
    await page.getByRole('button', { name: 'Save' }).click();
    const new4Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname4 }).last();
    await expect(new4Li).toBeVisible();
    const latestId4 = await new4Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId4);
    await page.locator(`[id="${latestId4}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname4);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub4Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname4 }).last();
    await expect(new4Li).toBeVisible();
    const latestSub4Id = await newSub4Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub4Id);
    await page.locator(`[id="${latestId4}"] div`).filter({ hasText: `${playwright_skillname4} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub4Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Does delegation of tasks improve team productivity?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname5);
    await page.getByRole('button', { name: 'Save' }).click();
    const new5Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname5 }).last();
    await expect(new5Li).toBeVisible();
    const latestId5 = await new5Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId5);
    await page.locator(`[id="${latestId5}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname5);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub5Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname5 }).last();
    await expect(new5Li).toBeVisible();
    const latestSub5Id = await newSub5Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub5Id);
    await page.locator(`[id="${latestId5}"] div`).filter({ hasText: `${playwright_skillname5} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub5Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Is Python a dynamically typed programming language?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname6);
    await page.getByRole('button', { name: 'Save' }).click();
    const new6Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname6 }).last();
    await expect(new6Li).toBeVisible();
    const latestId6 = await new6Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId6);
    await page.locator(`[id="${latestId6}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname6);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub6Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname6 }).last();
    await expect(new6Li).toBeVisible();
    const latestSub6Id = await newSub6Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub6Id);
    await page.locator(`[id="${latestId6}"] div`).filter({ hasText: `${playwright_skillname6} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub6Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can unit testing help in detecting bugs early in the development cycle?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname7);
    await page.getByRole('button', { name: 'Save' }).click();
    const new7Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname7 }).last();
    await expect(new7Li).toBeVisible();
    const latestId7 = await new7Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId7);
    await page.locator(`[id="${latestId7}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname7);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub7Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname7 }).last();
    await expect(new7Li).toBeVisible();
    const latestSub7Id = await newSub7Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub7Id);
    await page.locator(`[id="${latestId7}"] div`).filter({ hasText: `${playwright_skillname7} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub7Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can a table in SQL have more than one primary key?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});




    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });



    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    const skillN1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    await page.locator('.progress-admin-main', { hasText: skillN1 }).locator('input#customRange2').fill('4');
    const skillN2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    await page.locator('.progress-admin-main', { hasText: skillN2 }).locator('input#customRange2').fill('5');
    const skillN3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    await page.locator('.progress-admin-main', { hasText: skillN3 }).locator('input#customRange2').fill('1');
    const skillN4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    await page.locator('.progress-admin-main', { hasText: skillN4 }).locator('input#customRange2').fill('3');
    const skillN5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    await page.locator('.progress-admin-main', { hasText: skillN5 }).locator('input#customRange2').fill('2');
    const skillN6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    await page.locator('.progress-admin-main', { hasText: skillN6 }).locator('input#customRange2').fill('5');
    const skillN7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    await page.locator('.progress-admin-main', { hasText: skillN7 }).locator('input#customRange2').fill('1');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});

    
    // login self user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#basic_username').fill(self_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


    // self user  attempt skill grading
    await page.goto('userui/dashboard/');
    await page.getByRole('link', { name: 'My Skills' }).click();
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 1 },
          { name: localStorage.getItem('skillname2'), value: 3 },
          { name: localStorage.getItem('skillname3'), value: 4 },
          { name: localStorage.getItem('skillname4'), value: 5 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 3 },
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});


    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    const L5_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
  // login L1 user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L1_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l1 logged in successfully.');


  // give grading from l1 for self user
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 2 },
          { name: localStorage.getItem('skillname2'), value: 4 },
          { name: localStorage.getItem('skillname3'), value: 3 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1},
          { name: localStorage.getItem('skillname7'), value: 5 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  const L2_userName = await page.evaluate(() => {return localStorage.getItem("username2");});
  // login L2 user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L2_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l2 logged in successfully.');



  // give grading from l2 for self user
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 3 },
          { name: localStorage.getItem('skillname2'), value: 5 },
          { name: localStorage.getItem('skillname3'), value: 2 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1 },
          { name: localStorage.getItem('skillname7'), value: 2 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  //admin  re-login call  
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 3) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue == useruiprogress){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('\x1b[32m%s\x1b[0m','dialog', async dialog => {
      console.log('Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }



  // delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
     await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);
});
test('original_skill_mapping_with_thershold_6', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }



    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('3');
    await page.locator('#maxProficiencyLevel').selectOption('6');
    await page.locator('#proficiency_1').click();
    await page.fill('#proficiency_1','basic');
    await page.locator('#proficiency_2').click();
    await page.fill('#proficiency_2','intermediate');
    await page.locator('#proficiency_3').click();
    await page.fill('#proficiency_3','advance');
    await page.locator('#proficiency_4').click();
    await page.fill('#proficiency_4','expert');
    await page.locator('#proficiency_5').click();
    await page.fill('#proficiency_5','pro');
    await page.locator('#proficiency_6').click();
    await page.fill('#proficiency_6','ultra-pro');
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSelfAssessment').click();
    await page.locator('#isLeaderAssessment').click();
    await page.locator('#isSkipLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);



    // create skills
    await page.goto('createTags1.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });

    const sub_playwright_skillname1 = await page.evaluate(() => {
      let subskill1 = 'sub_unit_playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', subskill1); return subskill1;
    });
    const sub_playwright_skillname2 = await page.evaluate(() => {
      let subskill2 = 'sub_unit_playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', subskill2); return subskill2;
    });
    const sub_playwright_skillname3 = await page.evaluate(() => {
      let subskill3 = 'sub_unit_playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', subskill3); return subskill3;
    });
    const sub_playwright_skillname4 = await page.evaluate(() => {
      let subskill4 = 'sub_unit_playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', subskill4); return subskill4;
    });
    const sub_playwright_skillname5 = await page.evaluate(() => {
      let subskill5 = 'sub_unit_playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', subskill5); return subskill5;
    });
    const sub_playwright_skillname6 = await page.evaluate(() => {
      let subskill6 = 'sub_unit_playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', subskill6); return subskill6;
    });
    const sub_playwright_skillname7 = await page.evaluate(() => {
      let subskill7 = 'sub_unit_playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', subskill7); return subskill7;
    });

    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname1);
    await page.getByRole('button', { name: 'Save' }).click();
    const newLi = page.locator('li.clickable div.eh4', { hasText: playwright_skillname1 }).last();
    await expect(newLi).toBeVisible();
    const latestId = await newLi.getAttribute('data-id');
    console.log('Latest data-id:', latestId);
    await page.locator(`[id="${latestId}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname1);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSubLi = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname1 }).last();
    await expect(newLi).toBeVisible();
    const latestSubId = await newSubLi.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSubId); 
    await page.locator(`[id="${latestId}"] div`).filter({ hasText: `${playwright_skillname1} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSubId}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can a Java class implement multiple interfaces?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.locator('#level6description').click();
    await page.locator('#level6description').fill('this is ultra pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname2);
    await page.getByRole('button', { name: 'Save' }).click();
    const new2Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname2 }).last();
    await expect(new2Li).toBeVisible();
    const latestId2 = await new2Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId2);
    await page.locator(`[id="${latestId2}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname2);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub2Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname2 }).last();
    await expect(new2Li).toBeVisible();
    const latestSub2Id = await newSub2Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub2Id);
    await page.locator(`[id="${latestId2}"] div`).filter({ hasText: `${playwright_skillname2} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub2Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Does PHP support both procedural and object-oriented programming?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.locator('#level6description').click();
    await page.locator('#level6description').fill('this is ultra pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname3);
    await page.getByRole('button', { name: 'Save' }).click();
    const new3Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname3 }).last();
    await expect(new3Li).toBeVisible();
    const latestId3 = await new3Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId3);
    await page.locator(`[id="${latestId3}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname3);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub3Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname3 }).last();
    await expect(new3Li).toBeVisible();
    const latestSub3Id = await newSub3Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub3Id);
    await page.locator(`[id="${latestId3}"] div`).filter({ hasText: `${playwright_skillname3} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub3Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Is active listening an essential part of effective communication?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.locator('#level6description').click();
    await page.locator('#level6description').fill('this is ultra pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname4);
    await page.getByRole('button', { name: 'Save' }).click();
    const new4Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname4 }).last();
    await expect(new4Li).toBeVisible();
    const latestId4 = await new4Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId4);
    await page.locator(`[id="${latestId4}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname4);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub4Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname4 }).last();
    await expect(new4Li).toBeVisible();
    const latestSub4Id = await newSub4Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub4Id);
    await page.locator(`[id="${latestId4}"] div`).filter({ hasText: `${playwright_skillname4} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub4Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Does delegation of tasks improve team productivity?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.locator('#level6description').click();
    await page.locator('#level6description').fill('this is ultra pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname5);
    await page.getByRole('button', { name: 'Save' }).click();
    const new5Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname5 }).last();
    await expect(new5Li).toBeVisible();
    const latestId5 = await new5Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId5);
    await page.locator(`[id="${latestId5}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname5);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub5Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname5 }).last();
    await expect(new5Li).toBeVisible();
    const latestSub5Id = await newSub5Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub5Id);
    await page.locator(`[id="${latestId5}"] div`).filter({ hasText: `${playwright_skillname5} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub5Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Is Python a dynamically typed programming language?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.locator('#level6description').click();
    await page.locator('#level6description').fill('this is ultra pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname6);
    await page.getByRole('button', { name: 'Save' }).click();
    const new6Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname6 }).last();
    await expect(new6Li).toBeVisible();
    const latestId6 = await new6Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId6);
    await page.locator(`[id="${latestId6}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname6);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub6Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname6 }).last();
    await expect(new6Li).toBeVisible();
    const latestSub6Id = await newSub6Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub6Id);
    await page.locator(`[id="${latestId6}"] div`).filter({ hasText: `${playwright_skillname6} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub6Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can unit testing help in detecting bugs early in the development cycle?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.locator('#level6description').click();
    await page.locator('#level6description').fill('this is ultra pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname7);
    await page.getByRole('button', { name: 'Save' }).click();
    const new7Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname7 }).last();
    await expect(new7Li).toBeVisible();
    const latestId7 = await new7Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId7);
    await page.locator(`[id="${latestId7}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname7);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub7Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname7 }).last();
    await expect(new7Li).toBeVisible();
    const latestSub7Id = await newSub7Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub7Id);
    await page.locator(`[id="${latestId7}"] div`).filter({ hasText: `${playwright_skillname7} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub7Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can a table in SQL have more than one primary key?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.locator('#level1description').click();
    await page.locator('#level1description').fill('this is basic level');
    await page.locator('#level2description').click();
    await page.locator('#level2description').fill('this is intermediate level');
    await page.locator('#level3description').click();
    await page.locator('#level3description').fill('this is advance level');
    await page.locator('#level4description').click();
    await page.locator('#level4description').fill('this is expert level');
    await page.locator('#level5description').click();
    await page.locator('#level5description').fill('this is pro level');
    await page.locator('#level6description').click();
    await page.locator('#level6description').fill('this is ultra pro level');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});



    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });


    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});



    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    const skillN1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    await page.locator('.progress-admin-main', { hasText: skillN1 }).locator('input#customRange2').fill('4');
    const skillN2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    await page.locator('.progress-admin-main', { hasText: skillN2 }).locator('input#customRange2').fill('5');
    const skillN3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    await page.locator('.progress-admin-main', { hasText: skillN3 }).locator('input#customRange2').fill('1');
    const skillN4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    await page.locator('.progress-admin-main', { hasText: skillN4 }).locator('input#customRange2').fill('3');
    const skillN5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    await page.locator('.progress-admin-main', { hasText: skillN5 }).locator('input#customRange2').fill('2');
    const skillN6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    await page.locator('.progress-admin-main', { hasText: skillN6 }).locator('input#customRange2').fill('5');
    const skillN7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    await page.locator('.progress-admin-main', { hasText: skillN7 }).locator('input#customRange2').fill('1');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});


    
    // login self user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#basic_username').fill(self_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


    // self user  attempt skill grading
    await page.goto('userui/dashboard/');
    await page.getByRole('link', { name: 'My Skills' }).click();
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 1 },
          { name: localStorage.getItem('skillname2'), value: 3 },
          { name: localStorage.getItem('skillname3'), value: 4 },
          { name: localStorage.getItem('skillname4'), value: 5 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 3 },
          { name: localStorage.getItem('skillname7'), value: 4 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    const L5_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
  // login L1 user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L1_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l1 logged in successfully.');


  // give grading from l1 for self user
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
     await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 2 },
          { name: localStorage.getItem('skillname2'), value: 4 },
          { name: localStorage.getItem('skillname3'), value: 3 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1},
          { name: localStorage.getItem('skillname7'), value: 5 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  const L2_userName = await page.evaluate(() => {return localStorage.getItem("username2");});
  // login L2 user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L2_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l2 logged in successfully.');


  // give grading from l2 for self user
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function setAllSliders(page) {
      page.on("console", msg => {
        console.log("BROWSER LOG:", msg.text());
      });
      await page.evaluate(() => {
        const skills = [
          { name: localStorage.getItem('skillname1'), value: 5 },
          { name: localStorage.getItem('skillname2'), value: 2 },
          { name: localStorage.getItem('skillname3'), value: 2 },
          { name: localStorage.getItem('skillname4'), value: 1 },
          { name: localStorage.getItem('skillname5'), value: 2 },
          { name: localStorage.getItem('skillname6'), value: 1 },
          { name: localStorage.getItem('skillname7'), value: 3 },
        ];
        const max = 4;
        const setSliderValue = (skillName, value) => {
          console.log('\x1b[32m%s\x1b[0m',"â–¶ï¸ Setting skill:", skillName, "with value:", value);
          const block = Array.from(document.querySelectorAll('.mb-6'))
            .find(el => el.innerText.includes(skillName));
          if (!block) {
            console.log("âŒ Block not found for:", skillName);
            return;
          }
          const slider = block.querySelector('.ant-slider');
          const rail = slider?.querySelector('.ant-slider-rail');
          if (!slider || !rail) {
            console.log("âŒ Slider/rail not found for:", skillName);
            return;
          }
          const percent = (value / max) * 100;
          const sliderRect = rail.getBoundingClientRect();
          const targetX = sliderRect.left + (percent / 100) * sliderRect.width;
          const centerY = sliderRect.top + sliderRect.height / 2;
          const simulateClick = (x, y) => {
            const mousedown = new MouseEvent('mousedown', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            rail.dispatchEvent(mousedown);
            const mouseup = new MouseEvent('mouseup', {
              bubbles: true,
              cancelable: true,
              clientX: x,
              clientY: y,
            });
            document.dispatchEvent(mouseup);
          };
          simulateClick(targetX, centerY);
          console.log('\x1b[32m%s\x1b[0m',"âœ… Slider set for:", skillName, "to", value);
        };
        for (const skill of skills) {
          if (skill.name) {
            setSliderValue(skill.name, skill.value);
          }
        }
      });
    }
  await setAllSliders(page);
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  //admin  re-login call  
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 3) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue == useruiprogress){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }



  // delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});


// dynamic skill grading with yes/no 
test('original_skill_mapping_with_YES_NO_self_100%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'visible'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('1');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#isYesNoProficiency').click();
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSelfAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);


    // create skills
    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname1);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname2);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname3);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'behavioral'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname4);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname5);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname6);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname7);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});



    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });



    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});



    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    const skill1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    console.log(skill1);
    const skill2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    console.log(skill2);
    const skill3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    console.log(skill3);
    const skill4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    console.log(skill4);
    const skill5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    console.log(skill5);
    const skill6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    console.log(skill6);
    const skill7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    console.log(skill7);
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    console.log(self_userName);
    await page.locator('#basic_username').fill(self_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');



  // self user  attempt skill grading
  await page.goto('userui/dashboard/');
  await page.getByRole('link', { name: 'My Skills' }).click();
  await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Start Rating' }).click();
  await page.pause();


  async function rateSkill(page, skillName, answer) {
    const row = page.locator('.ques-title', { hasText: skillName }).locator('..').locator('..');
    await row.getByRole('button', { name: answer }).click();
  }
  await rateSkill(page, skill1, 'Yes');
  await rateSkill(page, skill2, 'Yes');
  await rateSkill(page, skill3, 'No');
  await rateSkill(page, skill4, 'Yes');
  await rateSkill(page, skill5, 'No');
  await rateSkill(page, skill6, 'Yes');
  await rateSkill(page, skill7, 'No');
   
 

  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill1 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill2 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill3 }) }).getByRole('button', { name: 'No' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill4 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill5 }) }).getByRole('button', { name: 'No' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill6 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill7 }) }).getByRole('button', { name: 'No' }).click();

  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});


  // admin login call
  await login(page);

  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue.trim() === useruiprogress.trim()){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }
    

  //delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);


});
test('original_skill_mapping_with_YES_NO_L1_100%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state: 'visible'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('1');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#isYesNoProficiency').click();
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);



    // create skills
    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname1);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname2);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname3);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'behavioral'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname4);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname5);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname6);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname7);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});



    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });



    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});

    

    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    const skill1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    console.log(skill1);
    const skill2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    console.log(skill2);
    const skill3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    console.log(skill3);
    const skill4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    console.log(skill4);
    const skill5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    console.log(skill5);
    const skill6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    console.log(skill6);
    const skill7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    console.log(skill7);
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L1_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l1 logged in successfully.');


    // L1  attempt skill grading
  await page.goto('userui/dashboard/'); 
  await page.getByRole('link', { name: 'Team Skills' }).click();
  await page.waitForLoadState('networkidle');
  await page.locator('#rc_select_0').click().then(() => 
    page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
    page.locator('.ant-select-item-option-content').first().click()
  );
  await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Start Rating' }).click();

  async function rateSkill(page, skillName, answer) {
    const row = page.locator('.ques-title', { hasText: skillName }).locator('..').locator('..');
    await row.getByRole('button', { name: answer }).click();
  }
  await rateSkill(page, skill1, 'No');
  await rateSkill(page, skill2, 'Yes');
  await rateSkill(page, skill3, 'No');
  await rateSkill(page, skill4, 'Yes');
  await rateSkill(page, skill5, 'No');
  await rateSkill(page, skill6, 'Yes');
  await rateSkill(page, skill7, 'No');

  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill1 }) }).getByRole('button', { name: 'No' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill2 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill3 }) }).getByRole('button', { name: 'No' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill4 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill5 }) }).getByRole('button', { name: 'NO' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill6 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill7 }) }).getByRole('button', { name: 'No' }).click();
  
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});


  // admin relogin call
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue.trim() === useruiprogress.trim()){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }

    

  //delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);

    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);


});
test('original_skill_mapping_with_YES_NO_L2_100%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('1');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#isYesNoProficiency').click();
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSkipLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);


    

    // create skills
    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname1);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname2);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname3);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'behavioral'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname4);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname5);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname6);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});
    await page.click('.addIcon');
    await page.click('#skillHeadingInput');
    await page.fill('#skillHeadingInput', playwright_skillname7);
    await page.click('#skillDescriptionInput');
    await page.fill('#skillDescriptionInput','this skill created by playwright.');
    await page.click('#category');
    await page.selectOption('#category', {value:'technical'});
    await page.click('#trend');
    await page.selectOption('#trend', {value:'emerging'});
    await page.click('#saveSkillBtn');
    await page.locator('#saveSkillBtn').waitFor({state:'hidden'});

    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });



    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});


    

    const L2_userName = await page.evaluate(() => {return localStorage.getItem("username2");});
    const skill1 = await page.evaluate(() => {return localStorage.getItem("skillname1");});
    console.log(skill1);
    const skill2 = await page.evaluate(() => {return localStorage.getItem("skillname2");});
    console.log(skill2);
    const skill3 = await page.evaluate(() => {return localStorage.getItem("skillname3");});
    console.log(skill3);
    const skill4 = await page.evaluate(() => {return localStorage.getItem("skillname4");});
    console.log(skill4);
    const skill5 = await page.evaluate(() => {return localStorage.getItem("skillname5");});
    console.log(skill5);
    const skill6 = await page.evaluate(() => {return localStorage.getItem("skillname6");});
    console.log(skill6);
    const skill7 = await page.evaluate(() => {return localStorage.getItem("skillname7");});
    console.log(skill7);
    // login L2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L2_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l2 logged in successfully.');


  // L2  attempt skill grading
  await page.goto('userui/dashboard/'); 
  await page.getByRole('link', { name: 'Team Skills' }).click();
  await page.waitForLoadState('networkidle');
  await page.locator('#rc_select_0').click().then(() => 
    page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
    page.locator('.ant-select-item-option-content').first().click()
  );
  await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Start Rating' }).click();

  async function rateSkill(page, skillName, answer) {
    const row = page.locator('.ques-title', { hasText: skillName }).locator('..').locator('..');
    await row.getByRole('button', { name: answer }).click();
  }
  await rateSkill(page, skill1, 'Yes');
  await rateSkill(page, skill2, 'Yes');
  await rateSkill(page, skill3, 'No');
  await rateSkill(page, skill4, 'Yes');
  await rateSkill(page, skill5, 'Yes');
  await rateSkill(page, skill6, 'Yes');
  await rateSkill(page, skill7, 'No');

  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill1 }) }).getByRole('button', { name: 'No' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill2 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill3 }) }).getByRole('button', { name: 'No' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill4 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill5 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill6 }) }).getByRole('button', { name: 'Yes' }).click();
  // await page.locator('.w-full.flex.flex-row', {  has: page.locator('.ques-title', { hasText: skill7 }) }).getByRole('button', { name: 'No' }).click();
  
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});


  // admin relogin call
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue.trim() === useruiprogress.trim()){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }

    


  //delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});
test('original_skill_mapping_with_YES_NO_self_L1_50%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('2');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#isYesNoProficiency').click();
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSelfAssessment').click();
    await page.locator('#isLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);



    // create skills
    await page.goto('createTags1.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });

  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname1);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi = page.locator('li.clickable div.eh4', { hasText: playwright_skillname1 }).last();
  await expect(newLi).toBeVisible();
  const latestId = await newLi.getAttribute('data-id');
  console.log('Latest data-id:', latestId);
  await page.locator(`[id="${latestId}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a Java class implement multiple interfaces?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname2);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi1 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname2 }).last();
  await expect(newLi1).toBeVisible();
  const latestId2 = await newLi1.getAttribute('data-id');
  console.log('Latest data-id:', latestId2);
  await page.locator(`[id="${latestId2}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does PHP support both procedural and object-oriented programming?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname3);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi3 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname3 }).last();
  await expect(newLi3).toBeVisible();
  const latestId3 = await newLi3.getAttribute('data-id');
  console.log('Latest data-id:', latestId3);
  await page.locator(`[id="${latestId3}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is active listening an essential part of effective communication?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname4);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi4 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname4}).last();
  await expect(newLi4).toBeVisible();
  const latestId4 = await newLi4.getAttribute('data-id');
  console.log('Latest data-id:', latestId4);
  await page.locator(`[id="${latestId4}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does delegation of tasks improve team productivity?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname5);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi5 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname5 }).last();
  await expect(newLi5).toBeVisible();
  const latestId5 = await newLi5.getAttribute('data-id');
  console.log('Latest data-id:', latestId5);
  await page.locator(`[id="${latestId5}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is Python a dynamically typed programming language?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname6);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi6 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname6 }).last();
  await expect(newLi6).toBeVisible();
  const latestId6 = await newLi6.getAttribute('data-id');
  console.log('Latest data-id:', latestId6);
  await page.locator(`[id="${latestId6}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can unit testing help in detecting bugs early in the development cycle?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname7);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi7 = page.locator('li.clickable div.eh4', { hasText:playwright_skillname7 }).last();
  await expect(newLi7).toBeVisible();
  const latestId7 = await newLi7.getAttribute('data-id');
  console.log('Latest data-id:', latestId7);
  await page.locator(`[id="${latestId7}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a table in SQL have more than one primary key?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});




    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });


    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});


    
    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    console.log('l1 name is :', L1_userName);
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(self_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


    // self user  attempt skill grading
  await page.goto('userui/dashboard/');
  await page.getByRole('link', { name: 'My Skills' }).click();
  await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Start Rating' }).click();
  await page.pause();
  async function answerSkill(page, skillName, answer = 'No') {
    const questionBlock = page.locator('.flex.flex-col.gap-2', {
      has: page.locator('.font-semibold.text-base', { hasText: skillName })
    });
      // Self Rating = first Yes/No pair
    await questionBlock.getByRole('button', { name: answer }).first().click();
  }
  // read skills directly from DOM
  const skills = await page.locator('.flex.flex-col.gap-2 .font-semibold.text-base').allInnerTexts();
  console.log('\x1b[32m%s\x1b[0m','Skills from page:', skills);

  const answers = ['No', 'Yes', 'No', 'Yes', 'No', 'Yes', 'Yes'];

  for (let i = 0; i < skills.length; i++) {
    await answerSkill(page, skills[i], answers[i]);
  }
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});




  // const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
  console.log('l1 name is :', L1_userName);
  // login L1 user
  await page.goto('userui/login/');
  await page.locator('#basic_username').waitFor({state : 'visible'});
  await page.locator('#basic_username').click();
  await page.locator('#basic_username').fill(L1_userName);
  await page.locator('#basic_password').click();
  await page.locator('#basic_password').fill('12345678');
  await page.getByRole('button', { name: 'Log In' }).click();
  await page.waitForURL('userui/dashboard/');
  await page.waitForLoadState('networkidle');
  console.log('\x1b[32m%s\x1b[0m','l1 logged in successfully.');


  // give grading from l1 for self user
  await page.goto('userui/dashboard/'); 
  await page.getByRole('link', { name: 'Team Skills' }).click();
  await page.waitForLoadState('networkidle');
  await page.locator('#rc_select_0').click().then(() => 
    page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
    page.locator('.ant-select-item-option-content').first().click()
  );
  await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Start Rating' }).click();
  async function answerSkill(page, skillName, answer = 'No',rowIndex = 0) {
    const questionBlock = page.locator('.flex.flex-col.gap-2', {
      has: page.locator('.font-semibold.text-base', { hasText: skillName })    
    });
    // Self Rating = first Yes/No pair
    await questionBlock.getByRole('button', { name: answer }).nth(rowIndex).click();
  }
  // read skills directly from DOM
  const L1skills = await page.locator('.flex.flex-col.gap-2 .font-semibold.text-base').allInnerTexts();
  console.log('\x1b[32m%s\x1b[0m','Skills from page:', L1skills);

  const L1answers = ['No', 'Yes', 'Yes', 'Yes', 'No', 'Yes', 'Yes'];

  for (let i = 0; i < L1skills.length; i++) {
    await answerSkill(page, L1skills[i], L1answers[i],1);
  }
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});


  // admin login call
  await login(page);

  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue.trim() === useruiprogress.trim()){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }




  // delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);

    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);


});
test('original_skill_mapping_with_YES_NO_self_L2_50%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state: 'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }



    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('2');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#isYesNoProficiency').click();
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSelfAssessment').click();
    await page.locator('#isSkipLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);




 // create skills
    await page.goto('createTags1.php');
    await waitForPaceLoad(page);

    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });

  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname1);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi = page.locator('li.clickable div.eh4', { hasText: playwright_skillname1 }).last();
  await expect(newLi).toBeVisible();
  const latestId = await newLi.getAttribute('data-id');
  console.log('Latest data-id:', latestId);
  await page.locator(`[id="${latestId}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a Java class implement multiple interfaces?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname2);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi1 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname2 }).last();
  await expect(newLi1).toBeVisible();
  const latestId2 = await newLi1.getAttribute('data-id');
  console.log('Latest data-id:', latestId2);
  await page.locator(`[id="${latestId2}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does PHP support both procedural and object-oriented programming?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname3);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi3 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname3 }).last();
  await expect(newLi3).toBeVisible();
  const latestId3 = await newLi3.getAttribute('data-id');
  console.log('Latest data-id:', latestId3);
  await page.locator(`[id="${latestId3}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is active listening an essential part of effective communication?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname4);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi4 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname4}).last();
  await expect(newLi4).toBeVisible();
  const latestId4 = await newLi4.getAttribute('data-id');
  console.log('Latest data-id:', latestId4);
  await page.locator(`[id="${latestId4}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does delegation of tasks improve team productivity?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname5);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi5 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname5 }).last();
  await expect(newLi5).toBeVisible();
  const latestId5 = await newLi5.getAttribute('data-id');
  console.log('Latest data-id:', latestId5);
  await page.locator(`[id="${latestId5}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is Python a dynamically typed programming language?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname6);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi6 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname6 }).last();
  await expect(newLi6).toBeVisible();
  const latestId6 = await newLi6.getAttribute('data-id');
  console.log('Latest data-id:', latestId6);
  await page.locator(`[id="${latestId6}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can unit testing help in detecting bugs early in the development cycle?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname7);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi7 = page.locator('li.clickable div.eh4', { hasText:playwright_skillname7 }).last();
  await expect(newLi7).toBeVisible();
  const latestId7 = await newLi7.getAttribute('data-id');
  console.log('Latest data-id:', latestId7);
  await page.locator(`[id="${latestId7}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a table in SQL have more than one primary key?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});




    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);

    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });



    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});


    

  const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
  const L2_userName = await page.evaluate(() => {return localStorage.getItem("username2");});
  console.log('self user:',self_userName);
  console.log('l2 user:',L2_userName);

  // login self user
  await page.goto('userui/login/');
  await page.locator('#basic_username').waitFor({state : 'visible'});
  await page.locator('#basic_username').click();
  await page.locator('#basic_username').fill(self_userName);
  await page.locator('#basic_password').click();
  await page.locator('#basic_password').fill('12345678');
  await page.getByRole('button', { name: 'Log In' }).click();
  await page.waitForURL('userui/dashboard/');
  await page.waitForLoadState('networkidle');
  console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


  // self user  attempt skill grading
  await page.goto('userui/dashboard/');
  await page.getByRole('link', { name: 'My Skills' }).click();
  await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Start Rating' }).click();
  async function answerSkill(page, skillName, answer = 'No') {
    const questionBlock = page.locator('.flex.flex-col.gap-2', {
      has: page.locator('.font-semibold.text-base', { hasText: skillName })
    });
    await questionBlock.getByRole('button', { name: answer }).first().click();
  }
  const skills = await page.locator('.flex.flex-col.gap-2 .font-semibold.text-base').allInnerTexts();
  console.log('\x1b[32m%s\x1b[0m','Skills from page:', skills);

  const answers = ['No', 'Yes', 'No', 'Yes', 'No', 'Yes', 'Yes'];

  for (let i = 0; i < skills.length; i++) {
    await answerSkill(page, skills[i], answers[i]);
  }
 await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});


  console.log('l2 user:',L2_userName);
  // login L2 user
  await page.goto('userui/login/');
  await page.locator('#basic_username').waitFor({state : 'visible'});
  await page.locator('#basic_username').click();
  await page.locator('#basic_username').fill(L2_userName);
  await page.locator('#basic_password').click();
  await page.locator('#basic_password').fill('12345678');
  await page.getByRole('button', { name: 'Log In' }).click();
  await page.waitForURL('userui/dashboard/');
  await page.waitForLoadState('networkidle');
  console.log('\x1b[32m%s\x1b[0m','l2 logged in successfully.');


  // give grading from l2 for self user
  await page.goto('userui/dashboard/'); 
  await page.getByRole('link', { name: 'Team Skills' }).click();
  await page.waitForLoadState('networkidle');
  await page.locator('#rc_select_0').click().then(() => 
    page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
    page.locator('.ant-select-item-option-content').first().click()
  );
  await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Start Rating' }).click();
  async function answerSkill(page, skillName, answer = 'No',rowIndex = 0) {
    const questionBlock = page.locator('.flex.flex-col.gap-2', {
      has: page.locator('.font-semibold.text-base', { hasText: skillName })    
    });
    await questionBlock.getByRole('button', { name: answer }).nth(rowIndex).click();
  }
  const L1skills = await page.locator('.flex.flex-col.gap-2 .font-semibold.text-base').allInnerTexts();
  console.log('\x1b[32m%s\x1b[0m','Skills from page:', L1skills);

  const L1answers = ['No', 'Yes', 'Yes', 'Yes', 'No', 'Yes', 'Yes'];

  for (let i = 0; i < L1skills.length; i++) {
    await answerSkill(page, L1skills[i], L1answers[i],1);
  }
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  //admin  re-login call  
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue.trim() === useruiprogress.trim()){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }




  // delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);

    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});
test('original_skill_mapping_with_YES_NO_L1_&_L2_50%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state: 'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('2');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#isYesNoProficiency').click();
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isLeaderAssessment').click();
    await page.locator('#isSkipLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    

    // create skills
    await page.goto('createTags1.php');
    await waitForPaceLoad(page);
    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });

  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname1);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi = page.locator('li.clickable div.eh4', { hasText: playwright_skillname1 }).last();
  await expect(newLi).toBeVisible();
  const latestId = await newLi.getAttribute('data-id');
  console.log('Latest data-id:', latestId);
  await page.locator(`[id="${latestId}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a Java class implement multiple interfaces?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname2);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi1 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname2 }).last();
  const latestId2 = await newLi1.getAttribute('data-id');
  console.log('Latest data-id:', latestId2);
  await page.locator(`[id="${latestId2}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does PHP support both procedural and object-oriented programming?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname3);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi3 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname3 }).last();
  await expect(newLi3).toBeVisible();
  const latestId3 = await newLi3.getAttribute('data-id');
  console.log('Latest data-id:', latestId3);
  await page.locator(`[id="${latestId3}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is active listening an essential part of effective communication?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname4);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi4 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname4}).last();
  await expect(newLi4).toBeVisible();
  const latestId4 = await newLi4.getAttribute('data-id');
  console.log('Latest data-id:', latestId4);
  await page.locator(`[id="${latestId4}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Does delegation of tasks improve team productivity?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname5);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi5 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname5 }).last();
  await expect(newLi5).toBeVisible();
  const latestId5 = await newLi5.getAttribute('data-id');
  console.log('Latest data-id:', latestId5);
  await page.locator(`[id="${latestId5}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Is Python a dynamically typed programming language?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abc');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname6);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi6 = page.locator('li.clickable div.eh4', { hasText: playwright_skillname6 }).last();
  await expect(newLi6).toBeVisible();
  const latestId6 = await newLi6.getAttribute('data-id');
  console.log('Latest data-id:', latestId6);
  await page.locator(`[id="${latestId6}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can unit testing help in detecting bugs early in the development cycle?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
  await page.locator('#addNewTag').waitFor({state:'visible'});
  await page.locator('#addNewTag').click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill(playwright_skillname7);
  await page.getByRole('button', { name: 'Save' }).click();
  const newLi7 = page.locator('li.clickable div.eh4', { hasText:playwright_skillname7 }).last();
  await expect(newLi7).toBeVisible();
  const latestId7 = await newLi7.getAttribute('data-id');
  console.log('Latest data-id:', latestId7);
  await page.locator(`[id="${latestId7}"] i`).nth(1).click();
  await page.locator('#tagName').click();
  await page.locator('#tagName').fill('Can a table in SQL have more than one primary key?');
  await page.locator('#description').click();
  await page.locator('#description').fill('abcd');
  await page.locator('#category').selectOption('Skill');
  await page.click('#tagSaveBtn');
  await page.locator('#tagSaveBtn').waitFor({state:'hidden'});



    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });


    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});
    console.log('\x1b[32m%s\x1b[0m',"skills assigned to role : ",Role );

    
    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    const L2_userName = await page.evaluate(() => {return localStorage.getItem("username2");});
    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    // login L1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L1_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l1 logged in successfully.');


    // L1  attempt skill grading
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function answerSkill(page, skillName, answer = 'No',rowIndex = 0) {
    const questionBlock = page.locator('.flex.flex-col.gap-2', {
      has: page.locator('.font-semibold.text-base', { hasText: skillName })    
    });
    await questionBlock.getByRole('button', { name: answer }).nth(rowIndex).click();
  }
  const L1skills = await page.locator('.flex.flex-col.gap-2 .font-semibold.text-base').allInnerTexts();
  console.log('\x1b[32m%s\x1b[0m','Skills from page:', L1skills);

  const L1answers = ['No', 'Yes', 'Yes', 'Yes', 'No', 'Yes', 'Yes'];

  for (let i = 0; i < L1skills.length; i++) {
    await answerSkill(page, L1skills[i], L1answers[i],0);
  }
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



    // login 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L2_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l2 logged in successfully.');


    // L2  attempt skill grading
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.locator('#rc_select_0').click();
    await page.locator('input.ant-select-selection-search-input').fill(self_userName);
    await page.locator('.ant-select-dropdown .ant-select-item-option', { hasText: self_userName }).click();
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function answerSkill(page, skillName, answer = 'No',rowIndex = 0) {
    const questionBlock = page.locator('.flex.flex-col.gap-2', {
      has: page.locator('.font-semibold.text-base', { hasText: skillName })    
    });
    await questionBlock.getByRole('button', { name: answer }).nth(rowIndex).click();
  }
  const L2skills = await page.locator('.flex.flex-col.gap-2 .font-semibold.text-base').allInnerTexts();
  console.log('\x1b[32m%s\x1b[0m','Skills from page:', L2skills);

  const L2answers = ['No', 'Yes', 'Yes', 'Yes', 'No', 'Yes', 'Yes'];

  for (let i = 0; i < L2skills.length; i++) {
    await answerSkill(page, L2skills[i], L2answers[i],1);
  }
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.waitForLoadState('networkidle');
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  // admin relogin call
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue.trim() === useruiprogress.trim()){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }




  //delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);

    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});
test('original_skill_mapping_with_YES_NO_self_l1_L2_33%', async ({ page }) => {
    test.setTimeout('1200000');
  await attachNetworkLogger(page);  

    await login(page);
// create users for skill mapping
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username1 = await page.evaluate(() => {
      let name1 = 'playwright_skillmap_user1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username1', name1); return name1;
    });
    await page.fill('#username', username1);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username1);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name2 = 'playwright_skillmap_user2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name2); return name2;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name3 = 'playwright_skillmap_user3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name3); return name3;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);    
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name4 = 'playwright_skillmap_user4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name4); return name4;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username5 = await page.evaluate(() => {
      let name5 = 'playwright_skillmap_user5_' + Math.floor(Math.random() * 100000); localStorage.setItem('username5', name5); return name5;
    });
    await page.fill('#username', username5);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username5);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username1,
      username2,
      username3,
      username4,
      username5
    ];
    for (const username of usersToCheck) {
      if (gridText.includes(username)) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }



    // enable skill mapping in company
    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#isEnableSkillHierarchy').click();
    await page.locator('#maxSkillHierarchyLevel').selectOption('3');
    await page.locator('#maxProficiencyLevel').selectOption('4');
    await page.locator('#isYesNoProficiency').click();
    // await page.locator('#skillGradingStartingOn').click();
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const year = now.getFullYear();
    let hours = now.getHours();
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    const currentdatetimestring = `${day}-${month}-${year} ${hours}:${minutes} ${ampm}`;
    await page.fill('#skillGradingStartingOn',currentdatetimestring);
    await page.locator('#skillGradingCompletionDays').click();
    await page.fill('#skillGradingCompletionDays','3');
    await page.locator('#skillGradingRestartMonths').click();
    await page.fill('#skillGradingRestartMonths','4');
    await page.locator('#isSelfAssessment').click();
    await page.locator('#isLeaderAssessment').click();
    await page.locator('#isSkipLeaderAssessment').click();
    await page.locator('#isStartSkillMap').click();
    await page.getByRole('button', { name: 'OK' }).click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m âœ…skill mapping enabled in company form and company saved  success message showed successfully!\x1b[0m`);
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ skill mapping enabled in company form and company saved  success message showed (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);



    // create skills
    await page.goto('createTags1.php');
    await waitForPaceLoad(page);

    const playwright_skillname1 = await page.evaluate(() => {
      let skill1 = 'playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', skill1); return skill1;
    });
    const playwright_skillname2 = await page.evaluate(() => {
      let skill2 = 'playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', skill2); return skill2;
    });
    const playwright_skillname3 = await page.evaluate(() => {
      let skill3 = 'playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', skill3); return skill3;
    });
    const playwright_skillname4 = await page.evaluate(() => {
      let skill4 = 'playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', skill4); return skill4;
    });
    const playwright_skillname5 = await page.evaluate(() => {
      let skill5 = 'playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', skill5); return skill5;
    });
    const playwright_skillname6 = await page.evaluate(() => {
      let skill6 = 'playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', skill6); return skill6;
    });
    const playwright_skillname7 = await page.evaluate(() => {
      let skill7 = 'playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', skill7); return skill7;
    });

    const sub_playwright_skillname1 = await page.evaluate(() => {
      let subskill1 = 'sub_unit_playwright_JAVA_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname1', subskill1); return subskill1;
    });
    const sub_playwright_skillname2 = await page.evaluate(() => {
      let subskill2 = 'sub_unit_playwright_PHP_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname2', subskill2); return subskill2;
    });
    const sub_playwright_skillname3 = await page.evaluate(() => {
      let subskill3 = 'sub_unit_playwright_Communication_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname3', subskill3); return subskill3;
    });
    const sub_playwright_skillname4 = await page.evaluate(() => {
      let subskill4 = 'sub_unit_playwright_management_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname4', subskill4); return subskill4;
    });
    const sub_playwright_skillname5 = await page.evaluate(() => {
      let subskill5 = 'sub_unit_playwright_python_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname5', subskill5); return subskill5;
    });
    const sub_playwright_skillname6 = await page.evaluate(() => {
      let subskill6 = 'sub_unit_playwright_testing_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname6', subskill6); return subskill6;
    });
    const sub_playwright_skillname7 = await page.evaluate(() => {
      let subskill7 = 'sub_unit_playwright_sql_' + Math.floor(Math.random() * 100000); localStorage.setItem('skillname7', subskill7); return subskill7;
    });

    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname1);
    await page.getByRole('button', { name: 'Save' }).click();
    const newLi = page.locator('li.clickable div.eh4', { hasText: playwright_skillname1 }).last();
    await expect(newLi).toBeVisible();
    const latestId = await newLi.getAttribute('data-id');
    console.log('Latest data-id:', latestId);
    await page.locator(`[id="${latestId}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname1);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSubLi = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname1 }).last();
    await expect(newLi).toBeVisible();
    const latestSubId = await newSubLi.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSubId); 
    await page.locator(`[id="${latestId}"] div`).filter({ hasText: `${playwright_skillname1} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSubId}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can a Java class implement multiple interfaces?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname2);
    await page.getByRole('button', { name: 'Save' }).click();
    const new2Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname2 }).last();
    await expect(new2Li).toBeVisible();
    const latestId2 = await new2Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId2);
    await page.locator(`[id="${latestId2}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname2);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub2Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname2 }).last();
    await expect(new2Li).toBeVisible();
    const latestSub2Id = await newSub2Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub2Id);
    await page.locator(`[id="${latestId2}"] div`).filter({ hasText: `${playwright_skillname2} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub2Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Does PHP support both procedural and object-oriented programming?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname3);
    await page.getByRole('button', { name: 'Save' }).click();
    const new3Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname3 }).last();
    await expect(new3Li).toBeVisible();
    const latestId3 = await new3Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId3);
    await page.locator(`[id="${latestId3}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname3);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub3Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname3 }).last();
    await expect(new3Li).toBeVisible();
    const latestSub3Id = await newSub3Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub3Id);
    await page.locator(`[id="${latestId3}"] div`).filter({ hasText: `${playwright_skillname3} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub3Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Is active listening an essential part of effective communication?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname4);
    await page.getByRole('button', { name: 'Save' }).click();
    const new4Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname4 }).last();
    await expect(new4Li).toBeVisible();
    const latestId4 = await new4Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId4);
    await page.locator(`[id="${latestId4}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname4);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub4Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname4 }).last();
    await expect(new4Li).toBeVisible();
    const latestSub4Id = await newSub4Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub4Id);
    await page.locator(`[id="${latestId4}"] div`).filter({ hasText: `${playwright_skillname4} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub4Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Does delegation of tasks improve team productivity?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname5);
    await page.getByRole('button', { name: 'Save' }).click();
    const new5Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname5 }).last();
    await expect(new5Li).toBeVisible();
    const latestId5 = await new5Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId5);
    await page.locator(`[id="${latestId5}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname5);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub5Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname5 }).last();
    await expect(new5Li).toBeVisible();
    const latestSub5Id = await newSub5Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub5Id);
    await page.locator(`[id="${latestId5}"] div`).filter({ hasText: `${playwright_skillname5} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub5Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Is Python a dynamically typed programming language?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname6);
    await page.getByRole('button', { name: 'Save' }).click();
    const new6Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname6 }).last();
    await expect(new6Li).toBeVisible();
    const latestId6 = await new6Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId6);
    await page.locator(`[id="${latestId6}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname6);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub6Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname6 }).last();
    await expect(new6Li).toBeVisible();
    const latestSub6Id = await newSub6Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub6Id);
    await page.locator(`[id="${latestId6}"] div`).filter({ hasText: `${playwright_skillname6} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub6Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can unit testing help in detecting bugs early in the development cycle?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});
    await page.locator('#addNewTag').waitFor({state:'visible'});
    await page.locator('#addNewTag').click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(playwright_skillname7);
    await page.getByRole('button', { name: 'Save' }).click();
    const new7Li = page.locator('li.clickable div.eh4', { hasText: playwright_skillname7 }).last();
    await expect(new7Li).toBeVisible();
    const latestId7 = await new7Li.getAttribute('data-id');
    console.log('Latest data-id:', latestId7);
    await page.locator(`[id="${latestId7}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill(sub_playwright_skillname7);
    await page.getByRole('button', { name: 'Save' }).click();
    const newSub7Li = page.locator('li.clickable div.eh4', { hasText: sub_playwright_skillname7 }).last();
    await expect(new7Li).toBeVisible();
    const latestSub7Id = await newSub7Li.getAttribute('data-id');
    console.log('Latest subUnit data-id:', latestSub7Id);
    await page.locator(`[id="${latestId7}"] div`).filter({ hasText: `${playwright_skillname7} Add New` }).locator('i').first().click();
    await page.locator(`[id="${latestSub7Id}"] i`).nth(1).click();
    await page.locator('#tagName').click();
    await page.locator('#tagName').fill('Can a table in SQL have more than one primary key?');
    await page.locator('#description').click();
    await page.locator('#description').fill('abc');
    await page.locator('#category').selectOption('Skill');
    await page.click('#tagSaveBtn');
    await page.locator('#tagSaveBtn').waitFor({state:'hidden'});




    // create roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);

    const playwright_role_name1 = await page.evaluate(() => {
      let role1 = 'playwright_ceo_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleA', role1); return role1;
    });
    const playwright_role_name2 = await page.evaluate(() => {
      let role2 = 'playwright_manager_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleB', role2); return role2;
    });
    const playwright_role_name3 = await page.evaluate(() => {
      let role3 = 'playwright_executive_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleC', role3); return role3;
    });
    const playwright_role_name4 = await page.evaluate(() => {
      let role4 = 'playwright_developer_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleD', role4); return role4;
    });
    const playwright_role_name5 = await page.evaluate(() => {
      let role5 = 'playwright_intern_' + Math.floor(Math.random() * 100000); localStorage.setItem('roleE', role5); return role5;
    });

    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name1);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName1 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name2);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName2 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name3);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName3 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name4);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName4 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });
    await page.locator('.button-primary').waitFor({ state: 'visible' });
    await page.click('.button-primary');
    await page.click('#name');
    await page.fill('#name', playwright_role_name5);
    await page.click('#description');
    await page.fill('#description', '.');
    await page.click('#function');
    await page.fill('#function', '.');
    await page.click('#businessunit');
    await page.fill('#businessunit', 'development');
    await page.click('#industry');
    await page.fill('#industry', 'IT');
    await page.click('#rolegrade');
    await page.fill('#rolegrade', 'devlopment');
    await page.click('#userSelect_chosen');
    const userName5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('#userSelect_chosen .chosen-results li', { hasText: userName5 }).click();
    await page.click('#roleSaveBtn');
    await page.locator('#roleSaveBtn').waitFor({ state: 'hidden' });


    // assigne l1(manager) to users to create hierarchy
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    const user2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    await page.locator('div[role="row"]', { hasText: user2 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    const user1 = await page.evaluate(() => {return localStorage.getItem("username1");});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user1 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    await page.locator('div[role="row"]', { hasText: user3 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    await page.locator('div[role="row"]', { hasText: user4 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user2 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const user5 = await page.evaluate(() => {return localStorage.getItem("username5");});
    await page.locator('div[role="row"]', { hasText: user5 }).locator('.editlearnerLnk').click();
    await page.locator('#customFieldForm').waitFor({state : 'visible'});
    await page.selectOption('#userParentSeq', {value: await page.locator('#userParentSeq option', { hasText: user4 }).first().getAttribute('value')});
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});


    // assign skills to roles
    await page.goto('organizationRoleCards.php');
    await waitForPaceLoad(page);
    const Role = await page.evaluate(() => {return localStorage.getItem("roleE");});
    await page.locator('#roleCardsDiv .col-md-3', { hasText: Role }).locator('.viewSkillProfileLnk').click();
    await page.waitForSelector('.pace-running');
    await waitForPaceLoad(page);
    await page.locator('#addSkillBtn').click();
    await page.getByRole('checkbox').locator('div').nth(1).click();
    await page.click('#confirmSelection');
    await page.click('#saveRoleSkillBtn');
    await page.locator('#saveRoleSkillBtn').waitFor({state : 'hidden'});

    
    
    const self_userName = await page.evaluate(() => {return localStorage.getItem("username5");});
    const L1_userName = await page.evaluate(() => {return localStorage.getItem("username4");});
    const L2_userName = await page.evaluate(() => {return localStorage.getItem("username2");});
    
    // login L1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(self_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','learner logged in successfully.');


    // self user  attempt skill grading
    await page.goto('userui/dashboard/');
    await page.getByRole('link', { name: 'My Skills' }).click();
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function answerSkill(page, skillName, answer = 'No',rowIndex = 0) {
    const questionBlock = page.locator('.flex.flex-col.gap-2', {
      has: page.locator('.font-semibold.text-base', { hasText: skillName })    
    });
    await questionBlock.getByRole('button', { name: answer }).nth(rowIndex).click();
  }
  const skills = await page.locator('.flex.flex-col.gap-2 .font-semibold.text-base').allInnerTexts();
  console.log('\x1b[32m%s\x1b[0m','Skills from page:', skills);

  const answers = ['No', 'No', 'Yes', 'Yes', 'No', 'Yes', 'No'];

  for (let i = 0; i < skills.length; i++) {
    await answerSkill(page, skills[i], answers[i],0);
  }
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



    
  // login L1 user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L1_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l1 logged in successfully.');



  // give grading from l1 for self user
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function answerSkill(page, skillName, answer = 'No',rowIndex = 0) {
    const questionBlock = page.locator('.flex.flex-col.gap-2', {
      has: page.locator('.font-semibold.text-base', { hasText: skillName })    
    });
    await questionBlock.getByRole('button', { name: answer }).nth(rowIndex).click();
  }
  const L1skills = await page.locator('.flex.flex-col.gap-2 .font-semibold.text-base').allInnerTexts();
  console.log('\x1b[32m%s\x1b[0m','Skills from page:', L1skills);

  const L1answers = ['No', 'Yes', 'Yes', 'Yes', 'No', 'Yes', 'Yes'];

  for (let i = 0; i < L1skills.length; i++) {
    await answerSkill(page, L1skills[i], L1answers[i],1);
  }
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  
  // login L2 user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.locator('#basic_username').click();
    await page.locator('#basic_username').fill(L2_userName);
    await page.locator('#basic_password').click();
    await page.locator('#basic_password').fill('12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('\x1b[32m%s\x1b[0m','l2 logged in successfully.');


  // give grading from l2 for self user
    await page.goto('userui/dashboard/'); 
    await page.getByRole('link', { name: 'Team Skills' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('#rc_select_0').click().then(() => 
      page.locator('.ant-select-item-option-content').first().waitFor({state:'visible'}),
      page.locator('.ant-select-item-option-content').first().click()
    );
    await page.getByRole('button', { name: 'Start Rating' }).waitFor({state : 'visible'});
    await page.getByRole('button', { name: 'Start Rating' }).click();
    async function answerSkill(page, skillName, answer = 'No',rowIndex = 0) {
    const questionBlock = page.locator('.flex.flex-col.gap-2', {
      has: page.locator('.font-semibold.text-base', { hasText: skillName })    
    });
    await questionBlock.getByRole('button', { name: answer }).nth(rowIndex).click();
  }
  const L2skills = await page.locator('.flex.flex-col.gap-2 .font-semibold.text-base').allInnerTexts();
  console.log('\x1b[32m%s\x1b[0m','Skills from page:', L2skills);

  const L2answers = ['No', 'Yes', 'No', 'Yes', 'No', 'Yes', 'No'];

  for (let i = 0; i < L2skills.length; i++) {
    await answerSkill(page, L2skills[i], L2answers[i],2);
  }
  await page.getByRole('button', { name: 'Save' }).click();
  await page.getByRole('button', { name: 'Save' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Edit' }).click();
  await page.getByRole('button', { name: 'Edit' }).waitFor({state : 'hidden'});
  await page.getByRole('button', { name: 'Submit' }).waitFor({state : 'visible'});
  await page.getByRole('button', { name: 'Submit' }).click();
  await page.getByRole('dialog').getByRole('button', { name: 'Yes' }).click();
  await page.waitForLoadState('networkidle');
  let lastValue = null;
  let stableCount = 0;
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const span = document.querySelector('.ant-progress-text');
      return span ? span.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  const progressText = await page.evaluate(() => {
    const span = document.querySelector('.ant-progress-text');
    const value = span ? span.innerText.trim() : null;
    if (value) {
      localStorage.setItem('progressValue', value);
    }
    return value; 
  });
  console.log('\x1b[32m%s\x1b[0m',"Progress saved:", progressText);
  await page.getByRole('listitem').getByRole('img').click();
  await page.getByRole('menuitem', { name: 'Logout' }).click();
  await page.locator('#basic_username').waitFor({state : 'visible'});



  //admin  re-login call  
  await login(page);


  // compare learner health & show alert for success and failure
  await page.goto('userHealthReport.php');
  await waitForPaceLoad(page);
  const selfUserRoleName = await page.evaluate(() => {return localStorage.getItem("roleE");});
  await page.locator('#roleSeq').selectOption({ label: selfUserRoleName });
  const selfUser = await page.evaluate(() => {return localStorage.getItem("username5");});
  await page.locator('#userDD').selectOption({ label: selfUser });
  await page.locator('#cycleDD').selectOption({ index: 1 });
  await page.getByRole('button', { name: 'Show Report' }).click();
  await page.waitForSelector('.progress-container .percentage', { state: 'visible' });
  while (stableCount < 2) { 
    const currentValue = await page.evaluate(() => {
      const el = document.querySelector('.progress-container .percentage');
      return el ? el.innerText.trim() : null;
    });
    if (currentValue === lastValue && currentValue !== null) {
      stableCount++;
    } else {
      stableCount = 0;
      lastValue = currentValue;
    }
    await page.waitForTimeout(1000); 
  }
  console.log('\x1b[32m%s\x1b[0m','âœ… Progress stabilized at:', lastValue);
  await page.evaluate((value) => {localStorage.setItem("progressPercentage", value);}, lastValue);
  const useruiprogress = await page.evaluate(() => {return localStorage.getItem("progressValue");});
  if(lastValue.trim() == useruiprogress.trim()){
    page.once('dialog', async dialog => {
      console.log('\x1b[32m%s\x1b[0m','Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("User health is correct report matched with user ui progress percentage.");
    });
  }else{
    page.once('dialog', async dialog => {
      console.log('Alert message:', dialog.message());
      await new Promise(resolve => setTimeout(resolve, 5000));
      await dialog.dismiss();
    });
    await page.evaluate(() => {
      alert("user progress is incorrect and not matched with user ui progress percentage.");
    });
  }


  // delete skill mapping data (users,roles,skills,skillmaping disable in company form)
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','user deleted message');
    await tostr_detector(page);


    await page.goto('organizationRolesGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','roles deleted message');
    await tostr_detector(page);


    await page.goto('manageSkillGrid.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    console.log('\x1b[33m%s\x1b[0m','skills deleted message');
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.locator('.jqx-checkbox-default').nth(5).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('.deleteIcon');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

    await page.goto('AdminSettings.php');
    await waitForPaceLoad(page);
    await page.locator('.settings-sidebar ul.nav a[href="#skill-mapping-section"]').click();
    await page.locator('#isEnableSkillMap').waitFor({ state: 'visible' });
    await page.locator('#isEnableSkillMap').click();
    await page.locator('#createButton').click();
    await page.waitForTimeout(2000);
    await tostr_detector(page);

});

// learning plan scenarios 
test.only('learning_plan_simple_case', async ({ page }) => {
  test.setTimeout('1200000');   
  await attachNetworkLogger(page);  
  await login(page);
    //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… profile created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({ state: 'visible' });
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    await page.getByRole('button', { name: 'Save Module' }).click(); 
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… lesson module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

      // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create survey
  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const survey_name = await page.evaluate(() =>{
    let name = 'lp_survey_'  + Math.floor(Math.random() * 100000); localStorage.setItem('survey1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(survey_name);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const rating_quetion = 'rating_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ1", name);}, rating_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(rating_quetion);
  await page.getByRole('tab', { name: 'Rating', exact: true }).click();
  await page.getByRole('checkbox').check();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const likelohood_quetion = 'likelihood_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ2", name);}, likelohood_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(likelohood_quetion);
  await page.getByRole('tab', { name: 'Likelihood' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const satisfaction_quetion = 'satisfaction_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ3", name);}, satisfaction_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(satisfaction_quetion);
  await page.getByRole('tab', { name: 'Satisfaction' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const emoji_quetion = 'emoji_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ4", name);}, emoji_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(emoji_quetion);
  await page.getByRole('tab', { name: 'Emoji' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const star_rating_quetion = 'star_rating_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ5", name);}, star_rating_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(star_rating_quetion);
  await page.getByRole('tab', { name: 'Star Rating' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… survey module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ survey module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=survey');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const surveygridText = await page.locator('#contentmanageModulesGrid').innerText();
    const surveyFound = surveygridText.includes(survey_name);
    if (surveyFound) {
        console.log(`\x1b[32mâœ… Verified: Survey "${survey_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Survey "${survey_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


  // create task 
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname = await page.evaluate(() =>{
    let name = 'lp_task_link_' + Math.floor(Math.random() * 100000); localStorage.setItem('task',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('#documentTaskTypeLabel').click();
  await page.locator('#mediatype_select').click();
  await page.locator('#mediatype_select').selectOption('link');
  await page.getByRole('button', { name: 'Save Module' }).click();
  // try {
  //     await Promise.race([
  //       successToast.waitFor({ state: 'visible', timeout: 4000 }),
  //     ]);
  //     if (await successToast.isVisible()) {
  //       console.log("âœ… task module created success message showed successfully!");
  //     }
  //   } catch (e) {
  //     console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
  //   }
    await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const taskgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const taskFound = taskgridText.includes(taskname);
    if (taskFound) {
        console.log(`\x1b[32mâœ… Verified: Task "${taskname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task "${taskname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



// create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${storedProfile}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(3)');
    await page.click('.select2-selection__placeholder');
    const storedsurveyname = await page.evaluate(() => {return localStorage.getItem("survey1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedsurveyname);
    await page.locator(`.select2-results__option:has-text("${storedsurveyname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedsurveyname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(5)');
    await page.click('.select2-selection__placeholder');
    const storedtaskname = await page.evaluate(() => {return localStorage.getItem("task");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedtaskname);
    await page.locator(`.select2-results__option:has-text("${storedtaskname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedtaskname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learning plan created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({ state: 'visible' });
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_Q_Q1 = await page.evaluate(() => localStorage.getItem("QuizQ1"));
    const stored_Q_Q2 = await page.evaluate(() => localStorage.getItem("QuizQ2"));
    const stored_Q_Q3 = await page.evaluate(() => localStorage.getItem("QuizQ3"));
    const stored_Q_Q4 = await page.evaluate(() => localStorage.getItem("QuizQ4"));
    // stored question

    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q1, { useInnerText: true });
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q2, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q3, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q4, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible', timeout:2000});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    


    const stored_S_Q1 = await page.evaluate(() => localStorage.getItem("SurveyQ1"));
    const stored_S_Q2 = await page.evaluate(() => localStorage.getItem("SurveyQ2"));
    const stored_S_Q3 = await page.evaluate(() => localStorage.getItem("SurveyQ3"));
    const stored_S_Q4 = await page.evaluate(() => localStorage.getItem("SurveyQ4"));
    const stored_S_Q5 = await page.evaluate(() => localStorage.getItem("SurveyQ5"));


    const stored_survey = await page.evaluate(() => localStorage.getItem("survey1"));
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_survey });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q1, { useInnerText: true });
    await page.locator('.ant-card').nth(4).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q2, { useInnerText: true });
    await page.locator('.ant-card').nth(2).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(2).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q3, { useInnerText: true });
    await page.locator('.ant-card').nth(1).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(1).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q4, { useInnerText: true });
    await page.locator('.ant-card').nth(3).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(3).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q5, { useInnerText: true });
    await page.locator('.ant-card').nth(5).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(5).click();
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_task = await page.evaluate(() => localStorage.getItem("task"));
    const targetCard4 = page.locator('.card-module-container', { hasText: stored_task });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Write a hyperlink' }).click();
    await page.getByRole('textbox', { name: 'Write a hyperlink' }).fill('https://www.php.net/');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call 
    await login(page);

    await page.goto('ManageAdminNotifications.php');
    await waitForPaceLoad(page);
 
    await page.locator('#notificationtype').selectOption('learning_plan_completion');
    await page.locator('#contentmanageAdminNotificationsGrid').waitFor({state:'visible', timeout:3000});
 
 
    // Get username from browser localStorage
    const user_Name = await page.evaluate(() => localStorage.getItem("username"));
    console.log('username is ', user_Name);
 
    // PASS user_Name properly into evaluate
    const foundData = await page.evaluate((user_Name) => {
      const rows = document.querySelectorAll('#contenttablemanageAdminNotificationsGrid [role="row"]');
      let result = null;
 
      rows.forEach((row, index) => {
          const cells = row.querySelectorAll('[role="gridcell"]');
          if (!cells.length) return;
 
          const typeCell    = cells[1]?.innerText.trim();
          const messageCell = cells[2]?.innerText.trim();
 
          if (typeCell === "Learning Plan Completion" && messageCell.includes(user_Name)) {
              result = {
                  row: index,
                  type: typeCell,
                  message: messageCell
              };
          }
      });
 
      return result;
  }, user_Name);
 
 

    if (foundData) {
        console.log(`\x1b[32m%s\x1b[0m` ,"Matched Row:", foundData);
        await page.evaluate((rowData) => {
          alert("User completed the learning plan â†’ " + JSON.stringify(rowData));
        }, foundData);
    }

// delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});

//   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow.count());
  await targetRow.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();

  const survey = await page.evaluate(() => localStorage.getItem("survey1"));
  const targetRow2 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: survey })
  });
  await targetRow2.locator('a#decrementmodule').click();

  const task = await page.evaluate(() => localStorage.getItem("task"));
  const targetRow3 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: task })
  });
  await targetRow3.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  // try {
  //     await Promise.race([
  //       successToast.waitFor({ state: 'visible', timeout: 4000 }),
  //     ]);
  //     if (await successToast.isVisible()) {
  //       console.log("âœ… learning plan updated success message showed successfully!");
  //     }
  //   } catch (e) {
  //     console.log("âš ï¸ learning plan not updated (validation / no toastr /save button didn't trigger)");
  //   }
    await tostr_detector(page);


 //   delete modules 
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);

});
test.only('learning_plan_with_continous_module_case', async ({ page }) => {
     test.setTimeout('1200000'); 
  await attachNetworkLogger(page);  

     await login(page);
      //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… profile created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({ state: 'visible' });
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);


    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    await page.getByRole('button', { name: 'Save Module' }).click(); 
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… lesson module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);
    
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

       // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create survey
  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const survey_name = await page.evaluate(() =>{
    let name = 'lp_survey_'  + Math.floor(Math.random() * 100000); localStorage.setItem('survey1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(survey_name);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const rating_quetion = 'rating_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ1", name);}, rating_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(rating_quetion);
  await page.getByRole('tab', { name: 'Rating', exact: true }).click();
  await page.getByRole('checkbox').check();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const likelohood_quetion = 'likelihood_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ2", name);}, likelohood_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(likelohood_quetion);
  await page.getByRole('tab', { name: 'Likelihood' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const satisfaction_quetion = 'satisfaction_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ3", name);}, satisfaction_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(satisfaction_quetion);
  await page.getByRole('tab', { name: 'Satisfaction' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const emoji_quetion = 'emoji_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ4", name);}, emoji_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(emoji_quetion);
  await page.getByRole('tab', { name: 'Emoji' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const star_rating_quetion = 'star_rating_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ5", name);}, star_rating_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(star_rating_quetion);
  await page.getByRole('tab', { name: 'Star Rating' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… survey module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ survey module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=survey');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const surveygridText = await page.locator('#contentmanageModulesGrid').innerText();
    const surveyFound = surveygridText.includes(survey_name);
    if (surveyFound) {
        console.log(`\x1b[32mâœ… Verified: Survey "${survey_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Survey "${survey_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



 // create task 
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname = await page.evaluate(() =>{
    let name = 'lp_task_link_' + Math.floor(Math.random() * 100000); localStorage.setItem('task',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('#documentTaskTypeLabel').click();
  await page.locator('#mediatype_select').click();
  await page.locator('#mediatype_select').selectOption('link');
  await page.getByRole('button', { name: 'Save Module' }).click();
  // try {
  //     await Promise.race([
  //       successToast.waitFor({ state: 'visible', timeout: 4000 }),
  //     ]);
  //     if (await successToast.isVisible()) {
  //       console.log("âœ… task module created success message showed successfully!");
  //     }
  //   } catch (e) {
  //     console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
  //   }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const taskgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const taskFound = taskgridText.includes(taskname);
    if (taskFound) {
        console.log(`\x1b[32mâœ… Verified: Task "${taskname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task "${taskname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



// create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${storedProfile}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.locator('label').filter({ hasText: 'Is Continous Module' }).locator('label').click();
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(3)');
    await page.click('.select2-selection__placeholder');
    const storedsurveyname = await page.evaluate(() => {return localStorage.getItem("survey1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedsurveyname);
    await page.locator(`.select2-results__option:has-text("${storedsurveyname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedsurveyname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(5)');
    await page.click('.select2-selection__placeholder');
    const storedtaskname = await page.evaluate(() => {return localStorage.getItem("task");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedtaskname);
    await page.locator(`.select2-results__option:has-text("${storedtaskname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedtaskname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learning plan created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('learner logged in successfully.');

    const stored_Q_Q1 = await page.evaluate(() => localStorage.getItem("QuizQ1"));
    const stored_Q_Q2 = await page.evaluate(() => localStorage.getItem("QuizQ2"));
    const stored_Q_Q3 = await page.evaluate(() => localStorage.getItem("QuizQ3"));
    const stored_Q_Q4 = await page.evaluate(() => localStorage.getItem("QuizQ4"));

    const stored_S_Q1 = await page.evaluate(() => localStorage.getItem("SurveyQ1"));
    const stored_S_Q2 = await page.evaluate(() => localStorage.getItem("SurveyQ2"));
    const stored_S_Q3 = await page.evaluate(() => localStorage.getItem("SurveyQ3"));
    const stored_S_Q4 = await page.evaluate(() => localStorage.getItem("SurveyQ4"));
    const stored_S_Q5 = await page.evaluate(() => localStorage.getItem("SurveyQ5"));

    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({ state: 'visible' });
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q1, { useInnerText: true });
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q2, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q3, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q4, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible', timeout:2000});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q1, { useInnerText: true });
    await page.locator('.ant-card').nth(4).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q2, { useInnerText: true });
    await page.locator('.ant-card').nth(2).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(2).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q3, { useInnerText: true });
    await page.locator('.ant-card').nth(1).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(1).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q4, { useInnerText: true });
    await page.locator('.ant-card').nth(3).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(3).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q5, { useInnerText: true });
    await page.locator('.ant-card').nth(5).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(5).click();
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Write a hyperlink' }).click();
    await page.getByRole('textbox', { name: 'Write a hyperlink' }).fill('https://www.php.net/');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});

    // admin login call 
    await login(page);

     await page.goto('ManageAdminNotifications.php');
    await waitForPaceLoad(page);
 
    await page.locator('#notificationtype').selectOption('learning_plan_completion');
    await page.locator('#contentmanageAdminNotificationsGrid').waitFor({state:'visible', timeout:3000});
 
 
    // Get username from browser localStorage
    const user_Name = await page.evaluate(() => localStorage.getItem("username"));
    console.log('username is ', user_Name);
 
    // PASS user_Name properly into evaluate
    const foundData = await page.evaluate((user_Name) => {
      const rows = document.querySelectorAll('#contenttablemanageAdminNotificationsGrid [role="row"]');
      let result = null;
 
      rows.forEach((row, index) => {
          const cells = row.querySelectorAll('[role="gridcell"]');
          if (!cells.length) return;
 
          const typeCell    = cells[1]?.innerText.trim();
          const messageCell = cells[2]?.innerText.trim();
 
          if (typeCell === "Learning Plan Completion" && messageCell.includes(user_Name)) {
              result = {
                  row: index,
                  type: typeCell,
                  message: messageCell
              };
          }
      });
 
      return result;
  }, user_Name);

    if (foundData) {
        console.log("Matched Row:", foundData);
        await page.evaluate((rowData) => {
          alert("User completed the learning plan â†’ " + JSON.stringify(rowData));
        }, foundData);
    }

// delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});

//   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow.count());
  await targetRow.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();

  const survey = await page.evaluate(() => localStorage.getItem("survey1"));
  const targetRow2 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: survey })
  });
  await targetRow2.locator('a#decrementmodule').click();

  const task = await page.evaluate(() => localStorage.getItem("task"));
  const targetRow3 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: task })
  });
  await targetRow3.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  // try {
  //     await Promise.race([
  //       successToast.waitFor({ state: 'visible', timeout: 4000 }),
  //     ]);
  //     if (await successToast.isVisible()) {
  //       console.log("âœ… learning plan updated success message showed successfully!");
  //     }
  //   } catch (e) {
  //     console.log("âš ï¸ learning plan not updated (validation / no toastr /save button didn't trigger)");
  //   }
  await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});

 //   delete modules 
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);
  
});
test.only('learning_plan_with_lock_sequence_module_case', async ({ page }) => {
  test.setTimeout('1200000'); 
  await attachNetworkLogger(page);  

     //create user
     await login(page);
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… profile created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({ state: 'visible' });
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);


    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    await page.getByRole('button', { name: 'Save Module' }).click(); 
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… lesson module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

       // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});

    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


 // create survey
  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const survey_name = await page.evaluate(() =>{
    let name = 'lp_survey_'  + Math.floor(Math.random() * 100000); localStorage.setItem('survey1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(survey_name);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const rating_quetion = 'rating_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ1", name);}, rating_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(rating_quetion);
  await page.getByRole('tab', { name: 'Rating', exact: true }).click();
  await page.getByRole('checkbox').check();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const likelohood_quetion = 'likelihood_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ2", name);}, likelohood_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(likelohood_quetion);
  await page.getByRole('tab', { name: 'Likelihood' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const satisfaction_quetion = 'satisfaction_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ3", name);}, satisfaction_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(satisfaction_quetion);
  await page.getByRole('tab', { name: 'Satisfaction' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const emoji_quetion = 'emoji_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ4", name);}, emoji_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(emoji_quetion);
  await page.getByRole('tab', { name: 'Emoji' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const star_rating_quetion = 'star_rating_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ5", name);}, star_rating_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(star_rating_quetion);
  await page.getByRole('tab', { name: 'Star Rating' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… survey module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ survey module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=survey');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const surveygridText = await page.locator('#contentmanageModulesGrid').innerText();
    const surveyFound = surveygridText.includes(survey_name);
    if (surveyFound) {
        console.log(`\x1b[32mâœ… Verified: Survey "${survey_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Survey "${survey_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create task
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname = await page.evaluate(() =>{
    let name = 'lp_task_link_' + Math.floor(Math.random() * 100000); localStorage.setItem('task',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('#documentTaskTypeLabel').click();
  await page.locator('#mediatype_select').click();
  await page.locator('#mediatype_select').selectOption('link');
  await page.getByRole('button', { name: 'Save Module' }).click();
  await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'});
  // try {
  //     await Promise.race([
  //       successToast.waitFor({ state: 'visible', timeout: 4000 }),
  //     ]);
  //     if (await successToast.isVisible()) {
  //       console.log("âœ… task module created success message showed successfully!");
  //     }
  //   } catch (e) {
  //     console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
  //   }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const taskgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const taskFound = taskgridText.includes(taskname);
    if (taskFound) {
        console.log(`\x1b[32mâœ… Verified: Task "${taskname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task "${taskname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${storedProfile}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.locator('label').filter({ hasText: 'Lock Sequence' }).locator('label').click(); 
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(3)');
    await page.click('.select2-selection__placeholder');
    const storedsurveyname = await page.evaluate(() => {return localStorage.getItem("survey1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedsurveyname);
    await page.locator(`.select2-results__option:has-text("${storedsurveyname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedsurveyname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(5)');
    await page.click('.select2-selection__placeholder');
    const storedtaskname = await page.evaluate(() => {return localStorage.getItem("task");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedtaskname);
    await page.locator(`.select2-results__option:has-text("${storedtaskname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedtaskname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learning plan created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


     // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({ state: 'visible' });
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const quizName = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    const targetCard2 = page.locator('.card-module-container', { hasText: quizName });
    await targetCard2.hover();
    const overlay = targetCard2.locator('.timeline-disabled-card-overlay', { hasText: 'Complete previous module to unlock!' });
    if (await overlay.isVisible()) {
    console.log('âš ï¸ The module "${quizName}" you are trying to launch is locked. Please complete the previous module first to unlock it.');
    await page.evaluate((quizName) => {
        alert('âš ï¸ The module "${quizName}" is locked.\n\nTo unlock it, please complete the previous module first.');
    }, quizName);
    page.once('dialog', async dialog => {
        console.log(`\x1b[32m%s\x1b[0m`,"Dialog message shown in browser:", dialog.message());
        setTimeout(async () => {
        await dialog.dismiss();
        console.log("âš ï¸ Alert dismissed automatically after 3 seconds");
        }, 3000);
    });

    } else {
      console.log(`âœ… Launching module: ${quizName}`);
      await targetCard2.getByRole('button', { name: 'Launch' }).click();
      await page.waitForLoadState('networkidle');
    }

    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const surveyName = await page.evaluate(() => {return localStorage.getItem("survey1");});
    const targetCard = page.locator('.card-module-container', { hasText: surveyName });
    await targetCard.hover();
    const overlay1 = targetCard.locator('.timeline-disabled-card-overlay', { hasText: 'Complete previous module to unlock!' });
    if (await overlay1.isVisible()) {
    console.log('âš ï¸ The module "${surveyName}" you are trying to launch is locked. Please complete the previous module first to unlock it.');
    await page.evaluate((surveyName) => {
        alert('âš ï¸ The module "${surveyName}" is locked.\n\nTo unlock it, please complete the previous module first.');
    }, surveyName);
    page.once('dialog', async dialog => {
        console.log(`\x1b[32m%s\x1b[0m`,"Dialog message shown in browser:", dialog.message());
        setTimeout(async () => {
        await dialog.dismiss();
        console.log("âš ï¸ Alert dismissed automatically after 3 seconds");
        }, 3000);
    });

    } else {
    console.log(`âœ… Launching module: ${surveyName}`);
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    }


    const stored_Q_Q1 = await page.evaluate(() => localStorage.getItem("QuizQ1"));
    const stored_Q_Q2 = await page.evaluate(() => localStorage.getItem("QuizQ2"));
    const stored_Q_Q3 = await page.evaluate(() => localStorage.getItem("QuizQ3"));
    const stored_Q_Q4 = await page.evaluate(() => localStorage.getItem("QuizQ4"));

    const stored_S_Q1 = await page.evaluate(() => localStorage.getItem("SurveyQ1"));
    const stored_S_Q2 = await page.evaluate(() => localStorage.getItem("SurveyQ2"));
    const stored_S_Q3 = await page.evaluate(() => localStorage.getItem("SurveyQ3"));
    const stored_S_Q4 = await page.evaluate(() => localStorage.getItem("SurveyQ4"));
    const stored_S_Q5 = await page.evaluate(() => localStorage.getItem("SurveyQ5"));

    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard5 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard5.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q1, { useInnerText: true });
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q2, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q3, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q4, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible', timeout:2000});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const taskName = await page.evaluate(() => {return localStorage.getItem("task");});
    const targetCard6 = page.locator('.card-module-container', { hasText: taskName });
    await targetCard6.hover();
    const overlay2 = targetCard6.locator('.timeline-disabled-card-overlay', { hasText: 'Complete previous module to unlock!' });
    if (await overlay2.isVisible()) {
    console.log('âš ï¸ The module "${taskName}" you are trying to launch is locked. Please complete the previous module first to unlock it.');
    await page.evaluate((taskName) => {
        alert('âš ï¸ The module "${taskName}" is locked.\n\nTo unlock it, please complete the previous module first.');
    }, taskName);
    page.once('dialog', async dialog => {
        console.log("Dialog message shown in browser:", dialog.message());
        setTimeout(async () => {
        await dialog.dismiss();
        console.log("âš ï¸ Alert dismissed automatically after 3 seconds");
        }, 3000);
    });

    } else {
    console.log(`âœ… Launching module: ${taskName}`);
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    }


    const stored_survey = await page.evaluate(() => localStorage.getItem("survey1"));
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_survey });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q1, { useInnerText: true });
    await page.locator('.ant-card').nth(4).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q2, { useInnerText: true });
    await page.locator('.ant-card').nth(2).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(2).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q3, { useInnerText: true });
    await page.locator('.ant-card').nth(1).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(1).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q4, { useInnerText: true });
    await page.locator('.ant-card').nth(3).waitFor({state:'visible'});
    await page.locator('.ant-card').nth(3).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_S_Q5, { useInnerText: true });
    await page.locator('.ant-card').nth(5).waitFor({state:'visible', timeout:2000});
    await page.locator('.ant-card').nth(5).click();
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    const stored_task = await page.evaluate(() => localStorage.getItem("task"));
    const targetCard4 = page.locator('.card-module-container', { hasText: stored_task });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Write a hyperlink' }).click();
    await page.getByRole('textbox', { name: 'Write a hyperlink' }).fill('https://www.php.net/');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


   
    // admin login call 
    await login(page);

     await page.goto('ManageAdminNotifications.php');
    await waitForPaceLoad(page);
 
    await page.locator('#notificationtype').selectOption('learning_plan_completion');
    await page.locator('#contentmanageAdminNotificationsGrid').waitFor({state:'visible', timeout:3000});
 
 
    // Get username from browser localStorage
    const user_Name = await page.evaluate(() => localStorage.getItem("username"));
    console.log('username is ', user_Name);
 
    // PASS user_Name properly into evaluate
    const foundData = await page.evaluate((user_Name) => {
      const rows = document.querySelectorAll('#contenttablemanageAdminNotificationsGrid [role="row"]');
      let result = null;
 
      rows.forEach((row, index) => {
          const cells = row.querySelectorAll('[role="gridcell"]');
          if (!cells.length) return;
 
          const typeCell    = cells[1]?.innerText.trim();
          const messageCell = cells[2]?.innerText.trim();
 
          if (typeCell === "Learning Plan Completion" && messageCell.includes(user_Name)) {
              result = {
                  row: index,
                  type: typeCell,
                  message: messageCell
              };
          }
      });
 
      return result;
  }, user_Name);

    if (foundData) {
        console.log("Matched Row:", foundData);
        await page.evaluate((rowData) => {
            alert( "User completed the learning plan â†’ " + JSON.stringify(rowData));
        }, foundData);
    }


// delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


//   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow.count());
  await targetRow.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();

  const survey = await page.evaluate(() => localStorage.getItem("survey1"));
  const targetRow2 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: survey })
  });
  await targetRow2.locator('a#decrementmodule').click();

  const task = await page.evaluate(() => localStorage.getItem("task"));
  const targetRow3 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: task })
  });
  await targetRow3.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  // try {
  //     await Promise.race([
  //       successToast.waitFor({ state: 'visible', timeout: 4000 }),
  //     ]);
  //     if (await successToast.isVisible()) {
  //       console.log("âœ… learning plan updated success message showed successfully!");
  //     }
  //   } catch (e) {
  //     console.log("âš ï¸ learning plan not updated (validation / no toastr /save button didn't trigger)");
  //   }
  await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});

 //   delete modules 
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);

});
test.only('learning_plan_with_leaderboard_enabled_case', async ({ page }) => {
    test.setTimeout('1200000'); 
    await attachNetworkLogger(page);  

     //create user
     await login(page);
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username3 = await page.evaluate(() => {
      let name = 'playwright_user_3_' + Math.floor(Math.random() * 100000); localStorage.setItem('username3', name); return name;
    });
    await page.fill('#username', username3);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username3);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveNewBtn');
    await page.waitForTimeout(2000);
    await page.click('#username');
    const username4 = await page.evaluate(() => {
      let name = 'playwright_user_4_' + Math.floor(Math.random() * 100000); localStorage.setItem('username4', name); return name;
    });
    await page.fill('#username', username4);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username4);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const gridText = await page.locator('#contentlearnersGrid').innerText();
    const usersToCheck = [
      username,
      username2,
      username3,
      username4
    ];
    for (const usernames of usersToCheck) {
      if (gridText.includes(usernames)) {
        console.log(`\x1b[32mâœ… Verified: User "${usernames}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${usernames}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… profile created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.locator('.jqx-checkbox-default').nth(3).click();
    await page.locator('.jqx-checkbox-default').nth(4).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);


// create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    await page.getByRole('button', { name: 'Save Module' }).click(); 
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… lesson module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



         // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});

    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    
    // create learning plan
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.locator('#gamification label').nth(3).click();
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.pause();
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learning plan created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


      // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');




    const stored_Q_Q1 = await page.evaluate(() => localStorage.getItem("QuizQ1"));
    const stored_Q_Q2 = await page.evaluate(() => localStorage.getItem("QuizQ2"));
    const stored_Q_Q3 = await page.evaluate(() => localStorage.getItem("QuizQ3"));
    const stored_Q_Q4 = await page.evaluate(() => localStorage.getItem("QuizQ4"));
    const storedLP1 = await page.evaluate(() => localStorage.getItem("LP1"));
    // stored question

     // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    await page.waitForLoadState('networkidle');
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard5 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard5.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q1, { useInnerText: true });
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q2, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q3, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q4, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible', timeout:2000});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    
    // check leaderboard postion 
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).waitFor({state: 'visible'});
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedLP1);
    await page.locator(`text=${storedLP1}`).waitFor({ state: 'visible' })
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).press('Enter');
    await page.locator('.leaderboard-card', { hasText: storedLP1 }).getByRole('button', { name: 'View' }).click();
    await page.waitForLoadState('networkidle');
    const userCards1 = page.locator('.flex.flex-row.justify-between.items-center.rounded-xl');
    const count1 = await userCards1.count();
    let leaderboardData1 = [];
    for (let i = 0; i < count1; i++) {
      const card = userCards1.nth(i);
      const username = (await card.locator('div > div > div').first().innerText()).trim();
      const score = parseInt((await card.locator('.text-sm').innerText()).trim(), 10);
      const rank = parseInt((await card.locator('.font-color-1.font-semibold').innerText()).trim(), 10);
      leaderboardData1.push({ username, score, rank });
    }
    await page.evaluate((data) => {
      localStorage.setItem('userData', JSON.stringify(data));
    }, leaderboardData1);

    console.log(`\x1b[32m%s\x1b[0m` ,"Leaderboard User Data from userui/leaderboard:", leaderboardData1)

    await page.getByRole('listitem').getByRole('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});
    
    
    // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    await page.waitForLoadState('networkidle');
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    const stored_quiz1 = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard6 = page.locator('.card-module-container', { hasText: stored_quiz1 });
    await targetCard6.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q1, { useInnerText: true });
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q2, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q3, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(2) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q4, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible', timeout:2000});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    

    // check leaderboard postion 
     await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).waitFor({state: 'visible'});
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedLP1);
    await page.locator(`text=${storedLP1}`).waitFor({ state: 'visible' })
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).press('Enter');
    await page.locator('.leaderboard-card', { hasText: storedLP1 }).getByRole('button', { name: 'View' }).click();
    await page.waitForLoadState('networkidle');

    const userCards2 = page.locator('.flex.flex-row.justify-between.items-center.rounded-xl');
    const count2 = await userCards2.count();
    let leaderboardData2 = [];
    for (let i = 0; i < count2; i++) {
      const card = userCards2.nth(i);
      const username = (await card.locator('div > div > div').first().innerText()).trim();
      const score = parseInt((await card.locator('.text-sm').innerText()).trim(), 10);
      const rank = parseInt((await card.locator('.font-color-1.font-semibold').innerText()).trim(), 10);
      leaderboardData2.push({ username, score, rank });
    }
    await page.evaluate((data) => {
      localStorage.setItem('userData', JSON.stringify(data));
    }, leaderboardData2);

    console.log(`\x1b[32m%s\x1b[0m` ,"Leaderboard User Data from userui/leaderboard:", leaderboardData2);

    await page.getByRole('listitem').getByRole('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    
    // login user 3
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName3 = await page.evaluate(() => {return localStorage.getItem("username3");});
    console.log(userName3);
    await page.fill('#basic_username', userName3);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    await page.waitForLoadState('networkidle');
    const targetCard4 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    const stored_quiz2 = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard7 = page.locator('.card-module-container', { hasText: stored_quiz2 });
    await targetCard7.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q1, { useInnerText: true });
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q2, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q3, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(2) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q4, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible', timeout:2000});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    
    // check leaderboard postion 
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).waitFor({state: 'visible'});
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedLP1);
    await page.locator(`text=${storedLP1}`).waitFor({ state: 'visible' })
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).press('Enter');
    await page.locator('.leaderboard-card', { hasText: storedLP1 }).getByRole('button', { name: 'View' }).click();
    await page.waitForLoadState('networkidle');

    const userCards3 = page.locator('.flex.flex-row.justify-between.items-center.rounded-xl');
    const count3 = await userCards3.count();
    let leaderboardData3 = [];
    for (let i = 0; i < count3; i++) {
      const card = userCards3.nth(i);
      const username = (await card.locator('div > div > div').first().innerText()).trim();
      const score = parseInt((await card.locator('.text-sm').innerText()).trim(), 10);
      const rank = parseInt((await card.locator('.font-color-1.font-semibold').innerText()).trim(), 10);
      leaderboardData3.push({ username, score, rank });
    }
    await page.evaluate((data) => {
      localStorage.setItem('userData', JSON.stringify(data));
    }, leaderboardData3);

    console.log(`\x1b[32m%s\x1b[0m`,"Leaderboard User Data from userui/leaderboard:", leaderboardData3);
    await page.getByRole('listitem').getByRole('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 4
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName4 = await page.evaluate(() => {return localStorage.getItem("username4");});
    console.log(userName4);
    await page.fill('#basic_username', userName4);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    await page.waitForLoadState('networkidle');
    const targetCard = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz3 = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard8 = page.locator('.card-module-container', { hasText: stored_quiz3 });
    await targetCard8.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q1, { useInnerText: true });
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q2, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q3, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible'});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForLoadState('networkidle');
    await expect(page.locator('.question-card .ant-card-head-title div')).toHaveText(stored_Q_Q4, { useInnerText: true });
    await page.locator('.ant-space-item:nth-child(1) .ant-radio-input').waitFor({state:'visible', timeout:2000});
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    
    // check leaderboard postion 
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).waitFor({state: 'visible'});
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedLP1);
    await page.locator(`text=${storedLP1}`).waitFor({ state: 'visible' })
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).press('Enter');
    await page.locator('.leaderboard-card', { hasText: storedLP1 }).getByRole('button', { name: 'View' }).click();
    await page.waitForLoadState('networkidle');
    const userCards4 = page.locator('.flex.flex-row.justify-between.items-center.rounded-xl');
    const count4 = await userCards4.count();
    let leaderboardData4 = [];
    for (let i = 0; i < count4; i++) {
      const card = userCards4.nth(i);
      const username = (await card.locator('div > div > div').first().innerText()).trim();
      const score = parseInt((await card.locator('.text-sm').innerText()).trim(), 10);
      const rank = parseInt((await card.locator('.font-color-1.font-semibold').innerText()).trim(), 10);
      leaderboardData4.push({ username, score, rank });
    }
    await page.evaluate((data) => {
      localStorage.setItem('userData', JSON.stringify(data));
    }, leaderboardData4);

    console.log(`\x1b[32m%s\x1b[0m`,"Leaderboard User Data from userui/leaderboard:", leaderboardData4)
    await page.getByRole('listitem').getByRole('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // login admin call
    await login(page);

    // check leaderbord data 

    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    const lp = await page.evaluate(() => localStorage.getItem("LP1"));
    console.log('learning plan : ', lp);
    const targetRow = page.locator('#contentlearningPlanGrid [role="row"]', {
          has: page.locator('[role="gridcell"]', { hasText: lp })
    });
    console.log("Row count:", await targetRow.count());
    await targetRow.locator('a.showleaderboardlink').click();

    const leaderboardData = await page.evaluate(() => {
      const rows = Array.from(document.querySelectorAll('#contenttablejqxgridLB [role="row"]'));
      return rows.map(row => {
        const cells = Array.from(row.querySelectorAll('[role="gridcell"]'));
        return cells.map(cell => cell.innerText.trim());
      }).filter(r => r.some(cell => cell)); 
    });
    console.log("Leaderboard Data:", leaderboardData);

    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    console.log('learning plan : ', lp);
    const targetRow2 = page.locator('#contentleaderboardGrid [role="row"]', {
          has: page.locator('[role="gridcell"]', { hasText: lp })
      });
    console.log("Row count:", await targetRow2.count());
    await targetRow2.locator('a.showLeaderboardLink').click();
    await page.waitForLoadState('networkidle');
    const tableLocator = page.locator('table.m-auto');
    const leaderboard_Data = await page.evaluate(() => {
    const rows = Array.from(document.querySelectorAll('table.m-auto tbody tr'));
    return rows.map(row => {
        const cells = row.querySelectorAll('td');
        return {
            image: cells[0].querySelector('img')?.src || '',
            username: cells[1].innerText.trim(),
            place: cells[2].innerText.trim(),
            score: parseInt(cells[3].innerText.trim(), 10)
        };
    });
  });

  console.log("Leaderboard Data:", leaderboard_Data);
  const firstPlaceUser = leaderboard_Data.find(u => u.place === "1");
  if (firstPlaceUser) {
      console.log("1st Place User:", firstPlaceUser.username);
      await page.evaluate((name) => alert(`1st Place: ${name}`), firstPlaceUser.username);
  }


// delete user
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.locator('.jqx-checkbox-default').nth(4).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


//   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  console.log('learning plan : ', lp);
  const target_Row = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await target_Row.count());
  await target_Row.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});


 //   delete modules 
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);

});
test.only('learning_plan_with_delayed_activation_case', async ({ page }) => {
  test.setTimeout('1200000');
  await attachNetworkLogger(page);  
  await login(page);
   //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
     await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… profile created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

     // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    await page.getByRole('button', { name: 'Save Module' }).click(); 
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… lesson module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


      // create quiz 1
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await page.click('#name');
    const lpQuizName1= 'lp_Quiz_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz1", name);}, lpQuizName1);
    await page.fill('#name', lpQuizName1);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q1", name);}, lpQuizques1);

    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q2", name);}, lpQuizques2);

    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q3", name);}, lpQuizques3);

    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});

    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName1);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz1 "${lpQuizName1}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz1"${lpQuizName1}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

     // create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await page.click('#name');
    const lpQuizName2= 'lp_Quiz_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz2", name);}, lpQuizName2);
    await page.fill('#name', lpQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno1 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno1.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q1", name);}, lpques1);
    await page.fill('#questionname ', lpques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q2", name);}, lpques2);
    await page.fill('#questionname', lpques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const lpques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q3", name);}, lpques3);

    await page.fill('#questionname', lpques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno5 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno5.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q4", name);}, lpques4);
    await page.fill('#questionname', lpques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz2gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz2Found = quiz2gridText.includes(lpQuizName2);
    if (quiz2Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz2 "${lpQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz2 "${lpQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


     // create quiz 3
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await page.click('#name');
    const lpQuizName3= 'lp_Quiz_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz3", name);}, lpQuizName3);
    await page.fill('#name', lpQuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno6 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno6.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lp_ques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz3_q1", name);}, lp_ques1);
    await page.fill('#questionname ', lp_ques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno7 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno7.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lp_ques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz3_q2", name);}, lp_ques2);
    await page.fill('#questionname', lp_ques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const lp_ques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz3_q3", name);}, lp_ques3);
    await page.fill('#questionname', lp_ques3);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno8 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno8.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lp_ques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz3_q4", name);}, lp_ques4);
    await page.fill('#questionname', lp_ques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.getByRole('button', { name: 'Add Points' }).click();
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).waitFor({ state: 'visible' });
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).click();
    await page.getByPlaceholder('Ex:').waitFor({ state: 'visible' });
    await page.getByPlaceholder('Ex:').click();
    await page.getByPlaceholder('Ex:').fill('80');
    await page.getByText('Completion', { exact: true }).click();
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz3gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz3Found = quiz3gridText.includes(lpQuizName3);
    if (quiz3Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz3 "${lpQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz3"${lpQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

     // create quiz 4
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await page.click('#name');
    const lpQuizName4= 'lp_Quiz_4_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz4", name);}, lpQuizName4);
    await page.fill('#name', lpQuizName4);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno9 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno9.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const ques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz4_q1", name);}, ques1);
    await page.fill('#questionname ', ques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno10 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno10.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const ques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz4_q2", name);}, ques2);
    await page.fill('#questionname', ques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz4_q3", name);}, ques3);
    await page.fill('#questionname', ques3);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno11 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno11.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const ques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz4_q4", name);}, ques4);
    await page.fill('#questionname', ques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.getByRole('button', { name: 'Add Points' }).click();
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).waitFor({ state: 'visible' });
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).click();
    await page.getByPlaceholder('Ex:').waitFor({ state: 'visible' });
    await page.getByPlaceholder('Ex:').click();
    await page.getByPlaceholder('Ex:').fill('30');
    await page.getByText('Completion', { exact: true }).click();
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz4gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz4Found = quiz4gridText.includes(lpQuizName4);
    if (quiz4Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz3 "${lpQuizName4}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz3"${lpQuizName4}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    //  create task 
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const taskname = await page.evaluate(() =>{
      let name = 'lp_task_link_' + Math.floor(Math.random() * 100000); localStorage.setItem('task',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
    await page.locator('#documentTaskTypeLabel').click();
    await page.locator('#mediatype_select').click();
    await page.locator('#mediatype_select').selectOption('link');
    await page.getByRole('button', { name: 'Save Module' }).click();
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'});
  // try {
  //     await Promise.race([
  //       successToast.waitFor({ state: 'visible', timeout: 4000 }),
  //     ]);
  //     if (await successToast.isVisible()) {
  //       console.log("âœ… task module created success message showed successfully!");
  //     }
  //   } catch (e) {
  //     console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
  //   }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const taskgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const taskFound = taskgridText.includes(taskname);
    if (taskFound) {
        console.log(`\x1b[32mâœ… Verified: Task "${taskname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task "${taskname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

   // create survey
  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const survey_name = await page.evaluate(() =>{
    let name = 'lp_survey_'  + Math.floor(Math.random() * 100000); localStorage.setItem('survey1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(survey_name);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const rating_quetion = 'rating_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("Survey_q1", name);}, rating_quetion);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ1", name);}, rating_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(rating_quetion);
  await page.getByRole('tab', { name: 'Rating', exact: true }).click();
  await page.getByRole('checkbox').check();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const likelohood_quetion = 'likelihood_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("Survey_q2", name);}, likelohood_quetion);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ2", name);}, likelohood_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(likelohood_quetion);
  await page.getByRole('tab', { name: 'Likelihood' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const satisfaction_quetion = 'satisfaction_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("Survey_q3", name);}, satisfaction_quetion);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ3", name);}, satisfaction_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(satisfaction_quetion);
  await page.getByRole('tab', { name: 'Satisfaction' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const emoji_quetion = 'emoji_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("Survey_q4", name);}, emoji_quetion);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ4", name);}, emoji_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(emoji_quetion);
  await page.getByRole('tab', { name: 'Emoji' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const star_rating_quetion = 'star_rating_ques_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("Survey_q5", name);}, star_rating_quetion);
  await page.evaluate((name) => {localStorage.setItem("SurveyQ5", name);}, star_rating_quetion);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(star_rating_quetion);
  await page.getByRole('tab', { name: 'Star Rating' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.locator('#saveQuestionSpan').waitFor({ state: 'hidden' });
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… survey module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ survey module not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=survey');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const surveygridText = await page.locator('#contentmanageModulesGrid').innerText();
    const surveyFound = surveygridText.includes(survey_name);
    if (surveyFound) {
        console.log(`\x1b[32mâœ… Verified: Survey "${survey_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Survey "${survey_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

  // create learning plan
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    console.log('lesson added with immediate delay');

    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(3)');
    await page.click('.select2-selection__placeholder');
    const storedsurvey = await page.evaluate(() => {return localStorage.getItem("survey1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedsurvey);
    await page.locator(`.select2-results__option:has-text("${storedsurvey}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedsurvey}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    const surveydataid = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    const survmodclass= `.delayed_activation_controller${surveydataid}`;
    console.log("data id : ",surveydataid);
    console.log("mod class : ",survmodclass);
    await page.locator(`select.module_select.actTypeLnk.optdiv${survmodclass}`).selectOption({ label: 'After' });
    const inputtxtid =`#delayedactivationfrequency${surveydataid}`;
    console.log("textareaid : ",inputtxtid);
    await page.locator(inputtxtid).click();
    await page.locator(inputtxtid).fill('1');
    console.log('survey added with after minutes delay');




    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquiz1 = await page.evaluate(() => {return localStorage.getItem("lpQuiz1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquiz1);
    await page.locator(`.select2-results__option:has-text("${storedquiz1}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquiz1}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    const quizdataid = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    const quizmodclass= `.delayed_activation_controller${quizdataid}`;
    console.log("data id : ",quizdataid);
    console.log("mod class : ",quizmodclass);
    await page.locator(`select.module_select.actTypeLnk.optdiv${quizmodclass}`).selectOption({ label: 'on date' });
    const ondateinputtxt = `#delayedactivationondate${quizdataid}`;
    console.log("ondate input id : ",ondateinputtxt);
    await page.locator(ondateinputtxt).click();
    const input = page.locator(ondateinputtxt);
    await input.waitFor({ state: 'visible' });
    // remove readonly and type value
    await input.evaluate(el => el.removeAttribute('readonly'));
    const now = new Date();
    now.setMinutes(now.getMinutes() + 5);
    const formatted =
      now.getFullYear() + "-" +
      ("0" + (now.getMonth() + 1)).slice(-2) + "-" +
      ("0" + now.getDate()).slice(-2) + " " +
      ("0" + now.getHours()).slice(-2) + ":" +
      ("0" + now.getMinutes()).slice(-2);
    await input.fill(formatted);
    console.log('quiz added with on date delay');


    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquiz2 = await page.evaluate(() => {return localStorage.getItem("lpQuiz2");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquiz2);
    await page.locator(`.select2-results__option:has-text("${storedquiz2}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquiz2}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    const quizdataid2 = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    const quizmodclass2 = `.delayed_activation_controller${quizdataid2}`;
    console.log("data id : ",quizdataid2);
    console.log("mod class : ",quizmodclass2);
    await page.locator(`select.module_select.actTypeLnk.optdiv${quizmodclass2}`).selectOption({ label: 'On conditional' });
    const conditionid =`#delayedactivationcriteria${quizdataid2}`;
    console.log('criteria id:',conditionid);
    const type1= `#conditional${quizdataid2}`;
    console.log('type: ',type1);
    await page.locator(conditionid).selectOption({ label: 'Score' });
    await page.locator(type1).selectOption('greaterthanorequal');
    // await page.locator('select.module_select.conditional[name="delayedactivationcriteriatype[]"]').selectOption({ label: '>=' });
    const conditonpercentage  = `#delayedactivationonpercentage${quizdataid2}`;
    console.log(conditonpercentage);
    await page.locator(conditonpercentage).click();
    await page.locator(conditonpercentage).fill('50');
    console.log('quiz added with score greater than condition delay');


    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquiz3 = await page.evaluate(() => {return localStorage.getItem("lpQuiz3");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquiz3);
    await page.locator(`.select2-results__option:has-text("${storedquiz3}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquiz3}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    const quizdataid3 = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    const quizmodclass3 = `.delayed_activation_controller${quizdataid3}`;
    console.log("data id : ",quizdataid3);
    console.log("mod class : ",quizmodclass3);
    await page.locator(`select.module_select.actTypeLnk.optdiv${quizmodclass3}`).selectOption({ label: 'On conditional' });
    const conditionid3 =`#delayedactivationcriteria${quizdataid3}`;
    console.log('criteria id:',conditionid3);
    const type3= `#conditional${quizdataid3}`;
    console.log('type: ',type3);
    await page.locator(conditionid3).selectOption({ label: 'Score' });
    await page.locator(type3).selectOption('lessthan');
    const conditonpercentage2  = `#delayedactivationonpercentage${quizdataid3}`;
    console.log(conditonpercentage2);
    await page.locator(conditonpercentage2).click();
    await page.locator(conditonpercentage2).fill('50');
    console.log('quiz added with score less than condition delay');


    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquiz4 = await page.evaluate(() => {return localStorage.getItem("lpQuiz4");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquiz4);
    await page.locator(`.select2-results__option:has-text("${storedquiz4}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquiz4}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    const quizdataid4 = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    const quizmodclass4 = `.delayed_activation_controller${quizdataid4}`;
    console.log("data id : ",quizdataid4);
    console.log("mod class : ",quizmodclass4);
    await page.locator(`select.module_select.actTypeLnk.optdiv${quizmodclass4}`).selectOption({ label: 'On conditional' });
    const conditionid4 =`#delayedactivationcriteria${quizdataid4}`;
    console.log('criteria id:',conditionid4);
     const type4= `#conditional${quizdataid4}`;
    console.log('type: ',type4);
    await page.locator(conditionid4).selectOption({ label: 'Points' });
    await page.locator(type4).selectOption('greaterthanorequal');
    const conditonpercentage4  = `#delayedactivationonpercentage${quizdataid4}`;
    console.log(conditonpercentage4);
    await page.locator(conditonpercentage4).click();
    await page.locator(conditonpercentage4).fill('50');
    console.log('quiz added with points greater than condition delay');


    
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(5)');
    await page.click('.select2-selection__placeholder');
    const storedtask = await page.evaluate(() => {return localStorage.getItem("task");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedtask);
    await page.locator(`.select2-results__option:has-text("${storedtask}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedtask}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    const quizdataid5 = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    const quizmodclass5 = `.delayed_activation_controller${quizdataid5}`;
    console.log("data id : ",quizdataid5);
    console.log("mod class : ",quizmodclass5);
    await page.locator(`select.module_select.actTypeLnk.optdiv${quizmodclass5}`).selectOption({ label: 'On conditional' });
    const conditionid5 =`#delayedactivationcriteria${quizdataid5}`;
    console.log('criteria id:',conditionid5);
    const type5= `#conditional${quizdataid5}`;
    console.log('type: ',type5);
    await page.locator(conditionid5).selectOption({ label: 'Points' });
    await page.locator(type5).selectOption('lessthan');
    const conditonpercentage5  = `#delayedactivationonpercentage${quizdataid5}`;
    console.log(conditonpercentage5);
    await page.locator(conditonpercentage5).click();
    await page.locator(conditonpercentage5).fill('50');
    console.log('task added with points less than condition delay');

    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learning plan created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    // }
  await tostr_detector(page);

    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

     // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
     await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const surveyName = await page.evaluate(() => {return localStorage.getItem("survey1");});
    const targetCard2 = page.locator('.card-module-container', { hasText: surveyName });
    await targetCard2.hover();
    const overlay = targetCard2.locator('.timeline-disabled-card-overlay', { hasText: 'Accessible after 1 minutes of completion of the previous module' });
    if (await overlay.isVisible()) {
      console.log(`\x1b[32m âš ï¸ The module "${surveyName}" you are trying to launch is  available after 1 minute of completing the previous module ,  complete it first. \x1b[0m`);
      await page.evaluate((surveyName) => {
          alert(`âš ï¸ The module "${surveyName}" is not accessible yet .\n\nIt will acessible after 1 minute of competion of previous module., please complete the previous module first.`);
      }, surveyName);
      page.once('dialog', async dialog => {
          console.log("Dialog message shown in browser:", dialog.message());
          setTimeout(async () => {
          await dialog.dismiss();
          console.log("âš ï¸ Alert dismissed automatically after 3 seconds");
          }, 3000);
      });
    }
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    await page.evaluate(() => {
      const timerDiv = document.createElement('div');
      timerDiv.id = 'custom-timer';
      // Position: centered at the top
      timerDiv.style.position = 'fixed';
      timerDiv.style.top = '10px';
      timerDiv.style.left = '50%';
      timerDiv.style.transform = 'translateX(-50%)';
      // Style: no background, black bold text
      timerDiv.style.background = 'transparent';
      timerDiv.style.color = 'black';
      timerDiv.style.fontWeight = 'bold';
      timerDiv.style.fontSize = '18px';
      timerDiv.style.padding = '10px 20px';
      timerDiv.style.zIndex = '9999';
      timerDiv.innerText = 'Reloading in 60s';
      document.body.appendChild(timerDiv);

      let seconds = 60;
      const interval = setInterval(() => {
        seconds--;
        timerDiv.innerText = `Reloading in ${seconds}s`;
        if (seconds <= 0) {
          clearInterval(interval);
        }
      }, 1000);
    });

    // Wait 1 minute 
    await page.waitForTimeout(60 * 1000);
    await page.reload();

    await page.waitForLoadState('networkidle');

    const stored_S_Q1 = await page.evaluate(() => localStorage.getItem("Survey_q1"));
    const stored_S_Q2 = await page.evaluate(() => localStorage.getItem("Survey_q2"));
    const stored_S_Q3 = await page.evaluate(() => localStorage.getItem("Survey_q3"));
    const stored_S_Q4 = await page.evaluate(() => localStorage.getItem("Survey_q4"));
    const stored_S_Q5 = await page.evaluate(() => localStorage.getItem("Survey_q5"));





    const quizName2 = await page.evaluate(() => localStorage.getItem("lpQuiz1"));
    const target_Card2 = page.locator('.card-module-container', { hasText: quizName2 });
    await target_Card2.hover();
    const overlay2 = target_Card2.locator('.timeline-disabled-card-overlay');
    await overlay2.waitFor({ state: 'visible', timeout: 2000 });
    const overlayText = await overlay2.innerText();
    const regex = /available on\s+(\d{1,2}\/\d{1,2}\/\d{4}\s+\d{1,2}:\d{2}\s?(am|pm))/i;
    const match = overlayText.match(regex);
    if (match) {
        const dateTimeText = match[1]; 
        console.log(`âš ï¸ Module "${quizName2}" will be available on: ${dateTimeText}`);
        const [day, month, year, hourMinute, ampm] = dateTimeText.match(/(\d{1,2})\/(\d{1,2})\/(\d{4}) (\d{1,2}:\d{2}) (\w{2})/).slice(1);
        let [hours, minutes] = hourMinute.split(':').map(Number);
        if (ampm.toLowerCase() === 'pm' && hours < 12) hours += 12;
        if (ampm.toLowerCase() === 'am' && hours === 12) hours = 0;
        const moduleDate = new Date(Number(year), Number(month)-1, Number(day), hours, Number(minutes));
        console.log(`\x1b[32m%s\x1b[0m`,'Parsed module availability time:', moduleDate);
        await page.evaluate(({ quizName2, dateTimeText }) => {
          alert(`\x1b[32mâš ï¸ The module "${quizName2}" is not accessible yet.\n\nIt will be available on: ${dateTimeText}\nPlease complete the previous module first.\x1b[0m`);
        }, { quizName2, dateTimeText });

        page.once('dialog', async dialog => {
            console.log("Dialog message shown in browser:", dialog.message());
            setTimeout(async () => {
                await dialog.dismiss();
                console.log("âš ï¸ Alert dismissed automatically after 3 seconds");
            }, 3000);
        });
    }
    const stored_survey = await page.evaluate(() => localStorage.getItem("survey1"));
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_survey });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('.ant-card').nth(4).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(4000);
    await page.locator('.ant-card').nth(2).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(4000);
    await page.locator('.ant-card').nth(1).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(4000);
    await page.locator('.ant-card').nth(3).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(4000);
    await page.locator('.ant-card').nth(5).click();
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


 
    const quizname = await page.evaluate(() => localStorage.getItem("lpQuiz2"));
    const targetCard4 = page.locator('.card-module-container', { hasText: quizname });
    await targetCard4.hover();
    const overlay1 = targetCard4.locator('.timeline-disabled-card-overlay', { hasText: 'Accessible only if the scores are greater than or equal to 50% in the previous module' });
    if (await overlay1.isVisible()) {
      console.log(`\x1b[32mâš ï¸ The module "${quizname}" you are trying to launch is  available if scores are greater than 50% in previous module  ,  complete it first. \x1b[0m`);
      await page.evaluate((quizname) => {
          alert(`âš ï¸ The module "${quizname}" is not accessible yet .\n\nIt will available if scores is greater than 50% in privious module., please complete the previous module first.`);
      }, quizname);
      page.once('dialog', async dialog => {
          console.log("Dialog message shown in browser:", dialog.message());
          setTimeout(async () => {
          await dialog.dismiss();
          console.log("âš ï¸ Alert dismissed automatically after 3 seconds");
          }, 3000);
      });
    }

  

    await page.evaluate(() => {
      const timerDiv = document.createElement('div');
      timerDiv.id = 'custom-timer';
      // Position: centered at the top
      timerDiv.style.position = 'fixed';
      timerDiv.style.top = '10px';
      timerDiv.style.left = '50%';
      timerDiv.style.transform = 'translateX(-50%)';
      // Style: no background, black bold text
      timerDiv.style.background = 'transparent';
      timerDiv.style.color = 'black';
      timerDiv.style.fontWeight = 'bold';
      timerDiv.style.fontSize = '18px';
      timerDiv.style.padding = '10px 20px';
      timerDiv.style.zIndex = '9999';
      timerDiv.innerText = 'Reloading in 60s';
      document.body.appendChild(timerDiv);

      let seconds = 180;
      const interval = setInterval(() => {
        seconds--;
        timerDiv.innerText = `Reloading in ${seconds}s`;
        if (seconds <= 0) {
          clearInterval(interval);
        }
      }, 1000);
    });

    await page.waitForTimeout(180 * 1000);
    await page.reload();
    await page.waitForLoadState('networkidle');


  const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz1"));
  const targetCard5 = page.locator('.card-module-container', { hasText: stored_quiz });
  await targetCard5.getByRole('button', { name: 'Launch' }).click();
  await page.waitForLoadState('networkidle');
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(3000);
  await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
  await page.click('.primary');
  await page.waitForTimeout(4000);
  await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(4000);
  await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
  await page.click('.ant-btn:nth-child(3) > span');
  await page.getByRole('button', { name: 'Finish' }).click();
  await page.waitForLoadState('networkidle');

 
  const quizname3=await page.evaluate(() => localStorage.getItem("lpQuiz3"));
    const targetCard7 = page.locator('.card-module-container', { hasText: quizname3 });
    await targetCard7.hover();
    const overlay4 = targetCard7.locator('.timeline-disabled-card-overlay', { hasText: 'Available only if the scores are less than 50% in the previous module' });
    if (await overlay4.isVisible()) {
      console.log(`\x1b[32mâš ï¸ The module "${quizname3}" you are trying to launch is  available if scores are less than 50% in previous module  ,  complete it first.\x1b[0m`);
      await page.evaluate((quizname3) => {
          alert(`âš ï¸ The module "${quizname3}" is not accessible yet .\n\nIt will available if scores is less than 50% in privious module., please complete the previous module first.`);
      }, quizname3);
      page.once('dialog', async dialog => {
          console.log("Dialog message shown in browser:", dialog.message());
          setTimeout(async () => {
          await dialog.dismiss();
          console.log("âš ï¸ Alert dismissed automatically after 3 seconds");
          }, 3000);
      });
    }



  const stored_quiz2 = await page.evaluate(() => localStorage.getItem("lpQuiz2"));
  const targetCard6 = page.locator('.card-module-container', { hasText: stored_quiz2 });
  await targetCard6.getByRole('button', { name: 'Launch' }).click();
  await page.waitForLoadState('networkidle');
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(3000);
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary');
  await page.waitForTimeout(4000);
  await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(4000);
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.getByRole('button', { name: 'Finish' }).click();
  await page.waitForLoadState('networkidle');


  const quizname4 = await page.evaluate(() => localStorage.getItem("lpQuiz4"));
    const targetCard9 = page.locator('.card-module-container', { hasText: quizname4 });
    await targetCard9.hover();
    const overlay5 = targetCard9.locator('.timeline-disabled-card-overlay', { hasText: 'Accessible only if the points are greater than or equal to 50 in the previous module' });
    if (await overlay5.isVisible()) {
      console.log(`\x1b[32mâš ï¸ The module "${quizname4}" you are trying to launch is  available if points are greater than 50% in previous module  ,  complete it first.\x1b[0m `);
      await page.evaluate((quizname4) => {
          alert(`âš ï¸ The module "${quizname4}" is not accessible yet .\n\nIt will available if points is greater than 50% in privious module., please complete the previous module first.`);
      }, quizname4);
      page.once('dialog', async dialog => {
          console.log("Dialog message shown in browser:", dialog.message());
          setTimeout(async () => {
          await dialog.dismiss();
          console.log("âš ï¸ Alert dismissed automatically after 3 seconds");
          }, 3000);
      });
    }


  
  const targetCard8 = page.locator('.card-module-container', { hasText: quizname3 });
  await targetCard8.getByRole('button', { name: 'Launch' }).click();
  await page.waitForLoadState('networkidle');
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(3000);
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary');
  await page.waitForTimeout(3000);
  await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(3000);
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.getByRole('button', { name: 'Finish' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.waitForLoadState('networkidle');



    const task = await page.evaluate(() => localStorage.getItem("task"));
    const targetCard12 = page.locator('.card-module-container', { hasText: task });
    await targetCard12.hover();
    const overlay7 = targetCard9.locator('.timeline-disabled-card-overlay', { hasText: 'Accessible only if the points are greater than or equal to 50 in the previous module' });
    if (await overlay7.isVisible()) {
      console.log(`\x1b[32mâš ï¸ The module "${task}" you are trying to launch is  available if points are less than 50% in previous module  ,  complete it first.\x1b[0m `);
      await page.evaluate((task) => {
          alert(`âš ï¸ The module "${task}" is not accessible yet .\n\nIt will available if points is less than 50% in privious module., please complete the previous module first.`);
      }, task);
      page.once('dialog', async dialog => {
          console.log("Dialog message shown in browser:", dialog.message());
          setTimeout(async () => {
          await dialog.dismiss();
          console.log("âš ï¸ Alert dismissed automatically after 3 seconds");
          }, 3000);
      });
    }


  const targetCard10 = page.locator('.card-module-container', { hasText: quizname4 });
  await targetCard10.getByRole('button', { name: 'Launch' }).click();
  await page.waitForLoadState('networkidle');
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(3000);
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary');
  await page.waitForTimeout(4000);
  await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(4000);
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.getByRole('button', { name: 'Finish' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.waitForLoadState('networkidle');



  const targetCard11 = page.locator('.card-module-container', { hasText: task });
  await targetCard11.getByRole('button', { name: 'Launch' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('textbox', { name: 'Write a hyperlink' }).click();
  await page.getByRole('textbox', { name: 'Write a hyperlink' }).fill('https://www.php.net/');
  await page.getByRole('button', { name: 'Finish' }).click();
  await page.waitForLoadState('networkidle');
  await page.getByRole('banner').locator('img').click();
  await page.getByText('Logout').click();
  await page.locator('#basic_username').waitFor({state : 'visible'});


  // admin login call 
  await login(page);

   await page.goto('ManageAdminNotifications.php');
    await waitForPaceLoad(page);
 
    await page.locator('#notificationtype').selectOption('learning_plan_completion');
    await page.locator('#contentmanageAdminNotificationsGrid').waitFor({state:'visible', timeout:3000});
 
 
    // Get username from browser localStorage
    const user_Name = await page.evaluate(() => localStorage.getItem("username"));
    console.log('username is ', user_Name);
 
    // PASS user_Name properly into evaluate
    const foundData = await page.evaluate((user_Name) => {
      const rows = document.querySelectorAll('#contenttablemanageAdminNotificationsGrid [role="row"]');
      let result = null;
 
      rows.forEach((row, index) => {
          const cells = row.querySelectorAll('[role="gridcell"]');
          if (!cells.length) return;
 
          const typeCell    = cells[1]?.innerText.trim();
          const messageCell = cells[2]?.innerText.trim();
 
          if (typeCell === "Learning Plan Completion" && messageCell.includes(user_Name)) {
              result = {
                  row: index,
                  type: typeCell,
                  message: messageCell
              };
          }
      });
 
      return result;
  }, user_Name);

    if (foundData) {
        console.log(`\x1b[32m%s\x1b[0m`,"Matched Row:", foundData);
        await page.evaluate((rowData) => {
            alert("User completed the learning plan â†’ " + JSON.stringify(rowData));
        }, foundData);
    }


// delete user
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});

//   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow.count());
  await targetRow.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz1"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();

  const quiz2 = await page.evaluate(() => localStorage.getItem("lpQuiz2"));
  const targetRow2 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz2 })
  });
  await targetRow2.locator('a#decrementmodule').click();

  const quiz3 = await page.evaluate(() => localStorage.getItem("lpQuiz3"));
  const targetRow3 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz3 })
  });
  await targetRow3.locator('a#decrementmodule').click();

  const quiz4 = await page.evaluate(() => localStorage.getItem("lpQuiz4"));
  const targetRow4 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz4 })
  });
  await targetRow4.locator('a#decrementmodule').click();


  const survey = await page.evaluate(() => localStorage.getItem("survey1"));
  const targetRow5 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: survey })
  });
  await targetRow5.locator('a#decrementmodule').click();

  const tasks = await page.evaluate(() => localStorage.getItem("task"));
  const targetRow6 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: tasks })
  });
  await targetRow6.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  // try {
  //     await Promise.race([
  //       successToast.waitFor({ state: 'visible', timeout: 4000 }),
  //     ]);
  //     if (await successToast.isVisible()) {
  //       console.log("âœ… learning plan updated success message showed successfully!");
  //     }
  //   } catch (e) {
  //     console.log("âš ï¸ learning plan not updated (validation / no toastr /save button didn't trigger)");
  //   }
  await tostr_detector(page);



 //   delete modules 
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.locator('.jqx-checkbox-default').nth(4).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);

});
test('learning_plan_with_de_activation_case', async ({ page }) => {
  test.setTimeout('1200000');
  await attachNetworkLogger(page);  
  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… profile created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

     // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    await page.getByRole('button', { name: 'Save Module' }).click(); 
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… lesson module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

     // create quiz 1
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await page.click('#name');
    const lpQuizName1= 'lp_Quiz_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName1);
    await page.fill('#name', lpQuizName1);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q1", name);}, lpQuizques1);

    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q2", name);}, lpQuizques2);

    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q3", name);}, lpQuizques3);

    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state:'hidden'});

    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName1);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName1}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz"${lpQuizName1}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create learning plan
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    console.log('lesson module added in learningplan.');

    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquiz1 = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquiz1);
    await page.locator(`.select2-results__option:has-text("${storedquiz1}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquiz1}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    console.log('quiz module added in learningplan.');
    const quizdataid = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    const quizmodclass= `.deactivation_controller${quizdataid}`;
    console.log("data id : ",quizdataid);
    console.log("mod class : ",quizmodclass);
    await page.locator(`select.module_select.deactTypeLnk.optdiv${quizmodclass}`).selectOption({ label: 'On date' });
    const ondateinputtxt = `#deactivationondate${quizdataid}`;
    console.log("ondate input id : ",ondateinputtxt);
    await page.locator(ondateinputtxt).click();
    const input = page.locator(ondateinputtxt);
    await input.waitFor({ state: 'visible' });
    // remove readonly and type value
    await input.evaluate(el => el.removeAttribute('readonly'));
    const now = new Date();
    now.setMinutes(now.getMinutes() + 4);
    const formatted =
      now.getFullYear() + "-" +
      ("0" + (now.getMonth() + 1)).slice(-2) + "-" +
      ("0" + now.getDate()).slice(-2) + " " +
      ("0" + now.getHours()).slice(-2) + ":" +
      ("0" + now.getMinutes()).slice(-2);
    await input.fill(formatted);

    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learning plan created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


     // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');



    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard = page.locator('.card-module-container', { hasText: stored_quiz });
    async function checkExpired() {
      await targetCard.hover();
      const expiryText = await targetCard.innerText();
      const expiredMatch = expiryText.match(/Expired Today on\s+([A-Za-z]{3}\s\d{1,2})/i);
      if (expiredMatch) {
        console.log(`\x1b[32m ${stored_quiz} module is expired because of deactivated set in module. Found expiry: ${expiredMatch[1]}\x1b[0m`);
        return true;
      }
      return false;
    }
    const launch = targetCard.getByRole('button', { name: 'Launch' });
    if (await launch.count() > 0) {
      console.log(`\x1b[32m ${stored_quiz} module is currently in launch mode.\x1b[0m`);
       await page.evaluate(() => {
        let seconds = 180;
        let div = document.getElementById("reload-timer");
        if (!div) {
          div = document.createElement("div");
          div.id = 'reload-timer';
          div.style.position = 'fixed';
          div.style.top = '10px';
          div.style.left = '50%';
          div.style.transform = 'translateX(-50%)';
          div.style.background = 'transparent';
          div.style.color = 'black';
          div.style.fontWeight = 'bold';
          div.style.fontSize = '18px';
          div.style.padding = '10px 20px';
          div.style.zIndex = '9999';
          document.body.appendChild(div);
        }
        div.textContent = `Reloading in ${seconds}s`;

        const interval = setInterval(() => {
          seconds--;
          div.textContent = `Reloading in ${seconds}s`;
          if (seconds <= 0) {
            clearInterval(interval);
          }
        }, 1000);
      });
      console.log(`\x1b[32m%s\x1b[0m`,"Started timer...");
      console.log(`\x1b[32m%s\x1b[0m`,"wait for 180 second...");
      await page.waitForTimeout(3 * 60 * 1000);
      console.log(`\x1b[32m%s\x1b[0m`,"wait finish reloading the page...");
      await page.reload();

      if (await checkExpired()) {
      } else {
        console.log(`${stored_quiz} still not expired after reload. Starting 1-minute timer...`);

        await page.evaluate(() => {
        let seconds = 60;
        let div = document.getElementById("reload-timer");
        if (!div) {
          div = document.createElement('div');
          div.id = 'reload-timer';
          div.style.position = 'fixed';
          div.style.top = '10px';
          div.style.left = '50%';
          div.style.transform = 'translateX(-50%)';
          div.style.background = 'transparent';
          div.style.color = 'black';
          div.style.fontWeight = 'bold';
          div.style.fontSize = '18px';
          div.style.padding = '10px 20px';
          div.style.zIndex = '9999';
          document.body.appendChild(div);
        }
        div.textContent = `Reloading in ${seconds}s`;

        const interval = setInterval(() => {
          seconds--;
          div.textContent = `Reloading in ${seconds}s`;
          if (seconds <= 0) {
            clearInterval(interval);
          }
        }, 1000);
      });
        console.log(`\x1b[32m%s\x1b[0m`,"Started timer...");
        console.log(`\x1b[32m%s\x1b[0m`,"wait for 60 second...");
        await page.waitForTimeout(60 * 1000);
        console.log(`\x1b[32m%s\x1b[0m`,"wait finish reloading the page...");
        await page.reload();
        if (await checkExpired()) {
          console.log(`\x1b[32m ${stored_quiz} is expired after extra 1 minute wait.\x1b[0m`);
        } else {
          console.log(`${stored_quiz} still not expired after extra 1 minute.`);
        }
      }
    } else {
      if (!(await checkExpired())) {
        console.log(`\x1b[31m No Launch button and no expiry message found for ${stored_quiz}.\x1b[0m`);
      }
    }

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check report
    await page.goto('adminUserReporting.php');
    await waitForPaceLoad(page);
    await page.locator('#select2-usersComboBox-container').click();
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.select2-search__field').fill(user_Name);
    await page.locator('.select2-results__option', { hasText: user_Name }).click();
    await page.getByRole('button', { name: 'Show Report' }).click();
    await page.waitForSelector('#contentjqxgrid', { state: 'visible' });
    const storedmodule = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    const targetRow = page.locator('#contenttablejqxgrid [role="row"]', {
      has: page.locator('[role="gridcell"]', { hasText: storedmodule })
    });
    const completedOnCell = targetRow.locator('[role="gridcell"][columnindex="8"]');
    const completedOnTitle = await completedOnCell.getAttribute("title");
    if (!completedOnTitle) {
      console.log(`\x1b[32m User has NOT completed the module '${storedmodule}' before deactivation date.\x1b[0m`);
    } else {
      console.log(`\x1b[31m User completed the module '${storedmodule}' on: ${completedOnTitle}\x1b[0m`);
    }



    // / delete user
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});

//   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow2 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
  });
  console.log("Row count:", await targetRow2.count());
  await targetRow2.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});



  //   delete modules 
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


});

test('learning_plan_with_proctoring_enabled_in_module', async ({ page }) => {
  test.setTimeout('1200000');
  await attachNetworkLogger(page);  
  await login(page);
//create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
     await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… profile created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);
 
    // create quiz 1
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await page.click('#name');
    const lpQuizName1= 'lp_Quiz_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz1", name);}, lpQuizName1);
    await page.fill('#name', lpQuizName1);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName1);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName1}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz"${lpQuizName1}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



       // create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await page.click('#name');
    const lpQuizName2= 'lp_Quiz_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz2", name);}, lpQuizName2);
    await page.fill('#name', lpQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuiz2ques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q1", name);}, lpQuiz2ques1);
    await page.fill('#questionname ', lpQuiz2ques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno1 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno1.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuiz2ques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q2", name);}, lpQuiz2ques2);
    await page.fill('#questionname', lpQuiz2ques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const lpQuiz2ques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q3", name);}, lpQuiz2ques3);
    await page.fill('#questionname', lpQuiz2ques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuiz2ques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q4", name);}, lpQuiz2ques4);
    await page.fill('#questionname', lpQuiz2ques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');

    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz2gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz2Found = quiz2gridText.includes(lpQuizName2);
    if (quiz2Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz2 "${lpQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz2 "${lpQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create lp for proctoring
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquiz1 = await page.evaluate(() => {return localStorage.getItem("lpQuiz1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquiz1);
    await page.locator(`.select2-results__option:has-text("${storedquiz1}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquiz1}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    console.log('quiz1 module added in learningplan.');
    const quiz1dataid = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    console.log('quiz 1 data id for proctoring: ',quiz1dataid);
    const latestModule1 = page.locator(`.modulediv_each[data-id="${quiz1dataid}"]`);
    await latestModule1.locator('.checkblock', { hasText: 'Proctoring' }).click();
    const videoid = `#isgrabuservideo${quiz1dataid}`;
    console.log(' quiz 1 proctoring video id: ',videoid);
    await page.locator(videoid).click();
    const imageid = `#isgrabuserimage${quiz1dataid}`;
    console.log(' quiz 1 proctoring image id: ',imageid);
    await page.locator(imageid).click();
    await latestModule1.locator('#isproctoring').click();
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquiz2 = await page.evaluate(() => {return localStorage.getItem("lpQuiz2");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquiz2);
    await page.locator(`.select2-results__option:has-text("${storedquiz2}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquiz2}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    console.log('quiz 2 module added in learningplan.');
    const quiz2dataid = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    console.log('quiz 2 data id for proctoring: ',quiz2dataid);
    const latestModule = page.locator(`.modulediv_each[data-id="${quiz2dataid}"]`);
    await latestModule.locator('.checkblock', { hasText: 'Proctoring' }).click();
    const imageid2 = `#isgrabuserimage${quiz2dataid}`;
    console.log(' quiz 2 proctoring image id: ',imageid2);
    await page.locator(imageid2).click();
    const tablockid  = `#istablock${quiz2dataid}`;
    console.log(' quiz 2 proctoring tab lock id: ',tablockid);
    await page.locator(tablockid).click();
    await latestModule.locator('#isproctoring').click();
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learning plan created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


     // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);

    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz1"));
    const targetCard = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard.getByRole('button', { name: 'Launch' }).click();
    await page.getByRole('checkbox', { name: 'I Understand' }).waitFor({state:'visible'});
    await page.getByRole('checkbox', { name: 'I Understand' }).check();
    await page.getByRole('button', { name: 'Begin Exam' }).click();
    await page.getByRole('button', { name: 'Begin Exam' }).waitFor({state:'hidden'});
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    const stored_quiz2 = await page.evaluate(() => localStorage.getItem("lpQuiz2"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz2 });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('checkbox', { name: 'I Understand' }).waitFor({state:'visible'});
    await page.getByRole('checkbox', { name: 'I Understand' }).check();
    await page.getByRole('button', { name: 'Begin Exam' }).click();
    await page.getByRole('button', { name: 'Begin Exam' }).waitFor({state:'hidden'});
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.evaluate(() => {
      Object.defineProperty(document, 'visibilityState', { get: () => 'hidden', configurable: true });
      Object.defineProperty(document, 'hidden', { get: () => true, configurable: true });
      document.dispatchEvent(new Event('visibilitychange'));
      window.dispatchEvent(new Event('blur'));
    });
    console.log(`\x1b[33m%s\x1b[0m`,'Page blurred for 4 seconds');
    await page.waitForTimeout(4000);
    // Simulate regaining focus
    await page.evaluate(() => {
      Object.defineProperty(document, 'visibilityState', { get: () => 'visible', configurable: true });
      Object.defineProperty(document, 'hidden', { get: () => false, configurable: true });
      document.dispatchEvent(new Event('visibilitychange'));
      window.dispatchEvent(new Event('focus'));
    });
    console.log('Page focused again');

    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});


    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    
    await page.evaluate(() => {
      Object.defineProperty(document, 'visibilityState', { get: () => 'hidden', configurable: true });
      Object.defineProperty(document, 'hidden', { get: () => true, configurable: true });
      document.dispatchEvent(new Event('visibilitychange'));
      window.dispatchEvent(new Event('blur'));
    });
    console.log(`\x1b[33m%s\x1b[0m`,'Page blurred for 4 seconds');
    // Wait 4 seconds to simulate being away
    await page.waitForTimeout(4000);
    // Simulate regaining focus
    await page.evaluate(() => {
      Object.defineProperty(document, 'visibilityState', { get: () => 'visible', configurable: true });
      Object.defineProperty(document, 'hidden', { get: () => false, configurable: true });
      document.dispatchEvent(new Event('visibilitychange'));
      window.dispatchEvent(new Event('focus'));
    });
    console.log('Page focused again');


    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});

    await page.evaluate(() => {
      Object.defineProperty(document, 'visibilityState', { get: () => 'hidden', configurable: true });
      Object.defineProperty(document, 'hidden', { get: () => true, configurable: true });
      document.dispatchEvent(new Event('visibilitychange'));
      window.dispatchEvent(new Event('blur'));
    });
    console.log('Page blurred for 4 seconds');
    // Wait 4 seconds to simulate being away
    await page.waitForTimeout(4000);
    // Simulate regaining focus
    await page.evaluate(() => {
      Object.defineProperty(document, 'visibilityState', { get: () => 'visible', configurable: true });
      Object.defineProperty(document, 'hidden', { get: () => false, configurable: true });
      document.dispatchEvent(new Event('visibilitychange'));
      window.dispatchEvent(new Event('focus'));
    });
    console.log('Page focused again');


    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});

    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    

    await page.evaluate(() => {
      Object.defineProperty(document, 'visibilityState', { get: () => 'hidden', configurable: true });
      Object.defineProperty(document, 'hidden', { get: () => true, configurable: true });
      document.dispatchEvent(new Event('visibilitychange'));
      window.dispatchEvent(new Event('blur'));
    });
    console.log('Page blurred for 4 seconds');

    await page.waitForTimeout(4000);
    
    const alertLocator = page.locator('.ant-alert-message', { 
      hasText: 'You have exited from the training due to repeated tab changes' 
    });

    // Check if it exists
    if (await alertLocator.count() > 0) {
      const alertText = await alertLocator.textContent();
      console.log('Alert detected:', alertText.trim());
      console.log(`\x1b[33m%s\x1b[0m`,'Module is marked as completed due to multiple tab changes.');
    }
    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});

    // admin login call 
    await login(page);

    
    // check report
    await page.goto('adminUserReporting.php');
    await waitForPaceLoad(page);
    await page.locator('#select2-usersComboBox-container').click();
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.select2-search__field').fill(user_Name);
    await page.locator('.select2-results__option', { hasText: user_Name }).click();
    await page.getByRole('button', { name: 'Show Report' }).click();
    await page.waitForSelector('#contentjqxgrid', { state: 'visible' });
    const storedmodule1 = await page.evaluate(() => {return localStorage.getItem("lpQuiz1");});
    const targetRow2 = page.locator('#contenttablejqxgrid [role="row"]', {
      has: page.locator('[role="gridcell"]', { hasText: storedmodule1 })
    });
    await targetRow2.locator('a.showDetailLnk[title="Show details"]').click();
    console.log(`Clicked "Show details" for module: ${storedmodule1}`);
    const modalLocator = page.locator('.modal-content');
    const videoLink = page.locator('a.getUserSnapshotsLink', { hasText: 'Click here to see Learner Videos.' });
    await videoLink.waitFor({ state: 'visible', timeout: 5000 });
    await videoLink.click();
    console.log('Clicked on "Click here to see Learner Videos." link');
    await page.waitForTimeout(3000);
    const videos = modalLocator.locator('video');
    const videoCount = await videos.count();
    if (videoCount > 0) {
      console.log(`Video exists: ${videoCount} video(s) found in the popup.`);
    } else {
      console.log('No videos found in the popup.');
    }
    await page.locator('button.btn.btn-white[data-dismiss="modal"]', { hasText: 'Close' }).click();
    const imageLink = page.locator('a.getUserSnapshotsLink', { hasText: 'Click here to see Learner Images.' });
    await imageLink.waitFor({ state: 'visible', timeout: 5000 });
    await imageLink.click();
    console.log('Clicked on "Click here to see Learner Images." link');
    await page.waitForTimeout(3000);
    const images = modalLocator.locator('img');
    const imageCount = await images.count();

    if (imageCount > 0) {
      console.log(`Image exists: ${imageCount} image(s) found in the popup.`);
    } else {
      console.log('No images found in the popup.');
    }
    await page.locator('button.btn.btn-white[data-dismiss="modal"]', { hasText: 'Close' }).click();
    await page.locator('#contenttablejqxgrid').waitFor({state:'visible'});


    const storedmodule2 = await page.evaluate(() => {return localStorage.getItem("lpQuiz2");});
    const targetRow = page.locator('#contenttablejqxgrid [role="row"]', {
      has: page.locator('[role="gridcell"]', { hasText: storedmodule2 })
    });
    await targetRow.locator('a.showDetailLnk[title="Show details"]').click();
    console.log(`Clicked "Show details" for module: ${storedmodule2}`);
    await page.waitForTimeout(4000);

    const answerLabels = page.locator('table.table tbody tr td label.answerlbl');

    const count = await answerLabels.count();
    let disqualifiedFound = false;

    for (let i = 0; i < count; i++) {
      const rawText = await answerLabels.nth(i).innerText();
      console.log(`Label ${i + 1}: "${rawText}"`);
      if (rawText.trim().toLowerCase().includes('disqualified')) {
        disqualifiedFound = true;
        console.log(`âœ… Disqualified answer found in table #${i + 1}`);
        console.log( `User was Disqualified due to multiple tab changes (cheating detection).`);
      }
    }

    if (!disqualifiedFound) {
      console.log('âŒ No disqualified answers found.');
    }

    const imageLink1 = page.locator('a.getUserSnapshotsLink', { hasText: 'Click here to see Learner Images.' });
    await imageLink1.waitFor({ state: 'visible', timeout: 5000 });
    await imageLink1.click();
    console.log('Clicked on "Click here to see Learner Images." link');
    await page.waitForTimeout(3000);
    const images1 = modalLocator.locator('img');
    const imageCount1 = await images1.count();

    if (imageCount1 > 0) {
      console.log(`Image exists: ${imageCount1} image(s) found in the popup.`);
    } else {
      console.log('No images found in the popup.');
    }
    await page.locator('button.btn.btn-white[data-dismiss="modal"]', { hasText: 'Close' }).click();
    await page.locator('button.btn.btn-white[data-dismiss="modal"]', { hasText: 'Close' }).waitFor({state:'hidden'});




    // / delete user
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


//   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz2"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});


  //   delete modules 
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


});

test.only('learning_plan_with_timelimit_in_module', async ({ page }) => {
  test.setTimeout('1200000');
  await attachNetworkLogger(page);  
  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… profile created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
     await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);


      // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await page.click('#name');
    const lpQuizName1= 'lp_Quiz_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz1", name);}, lpQuizName1);
    await page.fill('#name', lpQuizName1);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1_q4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName1);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz1 "${lpQuizName1}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz1 "${lpQuizName1}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



  // create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await page.click('#name');
    const lpQuizName2= 'lp_Quiz_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz2", name);}, lpQuizName2);
    await page.fill('#name', lpQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuiz2ques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q1", name);}, lpQuiz2ques1);
    await page.fill('#questionname ', lpQuiz2ques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno1 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno1.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuiz2ques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q2", name);}, lpQuiz2ques2);
    await page.fill('#questionname', lpQuiz2ques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const lpQuiz2ques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q3", name);}, lpQuiz2ques3);
    await page.fill('#questionname', lpQuiz2ques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuiz2ques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz2_q4", name);}, lpQuiz2ques4);
    await page.fill('#questionname', lpQuiz2ques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');

    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz2gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz2Found = quiz2gridText.includes(lpQuizName2);
    if (quiz2Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz2 "${lpQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz2 "${lpQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }





    // create learning plan
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquiz1 = await page.evaluate(() => {return localStorage.getItem("lpQuiz1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquiz1);
    await page.locator(`.select2-results__option:has-text("${storedquiz1}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquiz1}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    console.log('quiz 1 module added in learningplan.');
    const quizdataid = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    const latestModule1 = page.locator(`.modulediv_each[data-id="${quizdataid}"]`);
    console.log('quiz data-id:',quizdataid);
    await page.getByText('Time Limit', { exact: true }).click();
    const inputtimelimitcheckid =`#time${quizdataid}`;
    console.log('time limit input area id :',inputtimelimitcheckid);
    await page.locator(inputtimelimitcheckid).click();
    await page.locator(inputtimelimitcheckid).fill('1');
    await latestModule1.locator('#istimeLimit').click();

    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquiz2 = await page.evaluate(() => {return localStorage.getItem("lpQuiz2");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquiz2);
    await page.locator(`.select2-results__option:has-text("${storedquiz2}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquiz2}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    console.log('quiz 2 module added in learningplan.');
    const quizdataid2 = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    const latestModule2 = page.locator(`.modulediv_each[data-id="${quizdataid2}"]`);
    console.log('quiz data-id:',quizdataid2);
    await page.getByText('Time Limit', { exact: true }).click();
    const inputtimelimitcheckid2 =`#time${quizdataid2}`;
    console.log('time limit input area id :',inputtimelimitcheckid2);
    await page.locator(inputtimelimitcheckid2).click();
    await page.locator(inputtimelimitcheckid2).fill('1');
    await latestModule2.locator('#istimeLimit').click();
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learning plan created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz1"));
    const targetCard = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    const stored_quiz2 = await page.evaluate(() => localStorage.getItem("lpQuiz2"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz2 });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.locator('.ant-alert-message', { hasText: 'Your training session has ended due to time constraints.' }).waitFor({state:'visible'});
    const alertLocator = page.locator('.ant-alert-message', { 
      hasText: 'Your training session has ended due to time constraints.' 
    });

    // Check if it exists
    if (await alertLocator.count() > 0) {
      const alertText = await alertLocator.textContent();
      console.log(`\x1b[32m%s\x1b[0m`,'Alert detected:', alertText.trim());
      console.log(`\x1b[32m%s\x1b[0m`,'Module is marked as completed due to time constraint as module is not completed within alloted time limit.');
    }
    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // admin login call 
    await login(page);

    
    // check report
    await page.goto('adminUserReporting.php');
    await waitForPaceLoad(page);
    await page.locator('#select2-usersComboBox-container').click();
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.select2-search__field').fill(user_Name);
    await page.locator('.select2-results__option', { hasText: user_Name }).click();
    await page.getByRole('button', { name: 'Show Report' }).click();
    await page.waitForSelector('#contentjqxgrid', { state: 'visible' });
    const storedmodule1 = await page.evaluate(() => {return localStorage.getItem("lpQuiz1");});
    const targetRow2 = page.locator('#contenttablejqxgrid [role="row"]', {
      has: page.locator('[role="gridcell"]', { hasText: storedmodule1 })
    });
    await targetRow2.locator('a.showDetailLnk[title="Show details"]').click();
    console.log(`Clicked "Show details" for module: ${storedmodule1}`);
    await page.waitForTimeout(2000); 
    const timeAllowedText = await page.locator('text=Time Allowed').locator('xpath=following-sibling::td').innerText();
    const totalTimeText = await page.locator('text=Total Time').locator('xpath=following-sibling::td').innerText();

    function parseTime(str) {
      const match = str.match(/(\d+):(\d+)/); // matches MM:SS
      if (!match) return 0;
      const minutes = parseInt(match[1], 10);
      const seconds = parseInt(match[2], 10);
      return minutes * 60 + seconds;
    }
    function checkCompletion(timeAllowedText, totalTimeText) {
      const timeAllowedSeconds = parseInt(timeAllowedText) * 60; 
      const totalTimeSeconds = parseTime(totalTimeText);

      if (totalTimeSeconds <= timeAllowedSeconds) {
        console.log(`\x1b[31mâœ… User completed module within given time (${totalTimeText})\x1b[0m`);
      } else {
        console.log(`\x1b[32mâš ï¸ User module completion marked completed due to time constraint (${totalTimeText})\x1b[0m`);
      }
    }
    await page.waitForTimeout(3000); 
    checkCompletion(timeAllowedText, totalTimeText);


    const storedmodule2 = await page.evaluate(() => {return localStorage.getItem("lpQuiz2");});
    const targetRow3 = page.locator('#contenttablejqxgrid [role="row"]', {
      has: page.locator('[role="gridcell"]', { hasText: storedmodule2 })
    });
    await targetRow3.locator('a.showDetailLnk[title="Show details"]').click();
    console.log(`Clicked "Show details" for module: ${storedmodule2}`);
    await page.waitForTimeout(3000); 
    checkCompletion(timeAllowedText, totalTimeText);
    

     // / delete user
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


//   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow4 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow4.count());
  await targetRow4.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz2"));
  const targetRow5 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow5.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});


  //   delete modules 
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
   await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


});
test.only('learning_plan_with_multi_attempt_in_module', async ({ page }) => {
    test.setTimeout('1200000');
      await attachNetworkLogger(page);  

    await login(page);
//create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
   await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… profile created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

    // create quiz 3
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const QuizName3= 'Quiz_reattempt_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz1", name);}, QuizName3);
    await page.fill('#name',QuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '20');
    await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
    await page.click('#questionname');
    const ques1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques1);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'we');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'ew');
    await page.click('#quizQuestionOption2 .col-md-5');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#questionname');
    const ques2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques2);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) #Layer_1');
    await page.click('#questionname');
    const ques3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques3);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'dg');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'erfer');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option3').waitFor({state:'visible'});
    await page.click('#option3');
    await page.fill('#option3', 'erf');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option4').waitFor({state:'visible'});
    await page.click('#option4');
    await page.fill('#option4', 'ergfer');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab > div');
    await page.click('#questionname');
    const ques4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques4);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'erger');
    await page.waitForTimeout(2000);
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'erger');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno.click();
    await page.fill('#totalMarks', '10');
    await page.click('#totalMarks');
    await page.click('#questionname');
    const ques5= 'Quiz_QUE5_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques5);
    await page.click('.py-2:nth-child(4)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(QuizName3);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${QuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${QuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create learning plan
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);

    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquiz1 = await page.evaluate(() => {return localStorage.getItem("Quiz1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquiz1);
    await page.locator(`.select2-results__option:has-text("${storedquiz1}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquiz1}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    console.log('quiz  module added in learningplan.');
    const quizdataid = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
    console.log('quiz data-id:',quizdataid);
    await page.getByText(' Multi Attempts', { exact: true }).click();
    await page.locator('#isMultipleReattempts').click();
    const inputmultiattempt = `#reattempts${quizdataid}`;
    console.log('multi attempt input area id:',inputmultiattempt);
    await page.locator(inputmultiattempt).click();
    await page.locator(inputmultiattempt).fill('3');
    await page.locator('#isMarksLessThan').click();
    const inputmultiattemptpercen = `#reattemptmarkslessthanpercent${quizdataid}`;
    console.log('multi attempt percentage input area id:',inputmultiattemptpercen);
    await page.locator(inputmultiattemptpercen).click();
    await page.locator(inputmultiattemptpercen).fill('80');
    await page.locator('#ismulti').click();
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learning plan created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


   // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_quiz = await page.evaluate(() => localStorage.getItem("Quiz1"));
    const targetCard = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Relaunch' }).waitFor({state:'visible', timeout:2000});
    await page.getByRole('button', { name: 'Relaunch' }).click();
    await page.getByRole('button', { name: 'Yes' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Relaunch' }).waitFor({state:'visible', timeout:2000});
    await page.getByRole('button', { name: 'Relaunch' }).click();
    await page.getByRole('button', { name: 'Yes' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Relaunch' }).waitFor({state:'visible', timeout:2000});
    await page.getByRole('button', { name: 'Relaunch' }).click();
    await page.getByRole('button', { name: 'Yes' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    
    await page.getByRole('button', { name: 'Review' }).waitFor({ state: 'visible' });
    const reviewButton = page.getByRole('button', { name: 'Review' });
    if (await reviewButton.isVisible()) {

      await page.evaluate(() => {
        alert("You have reached the limit of allowed reattempts for this module. Your module is submitted. Now you can only review it.");
      });
      console.log("Review mode only: limit of reattempts reached.");
    } else {
      console.log("Review button not found, proceeding with normal flow.");
    }
    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});



      // admin login call 
    await login(page);

    
    // check report
    await page.goto('adminUserReporting.php');
    await waitForPaceLoad(page);
    await page.locator('#select2-usersComboBox-container').click();
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.select2-search__field').fill(user_Name);
    await page.locator('.select2-results__option', { hasText: user_Name }).click();
    await page.getByRole('button', { name: 'Show Report' }).click();
    await page.waitForSelector('#contentjqxgrid', { state: 'visible' });
    const modulename = await page.evaluate(() => localStorage.getItem("Quiz1"));
    const targetRow = page.locator('#contenttablejqxgrid [role="row"]', {
      has: page.locator('[role="gridcell"]', { hasText: modulename })
    });
    const reattemptText = await targetRow.locator('[role="gridcell"]').nth(7).innerText();
    const reattempt = parseInt(reattemptText.trim(), 10);
    if (reattempt === 0) {
      console.log("User completed in one go");
    } else if (reattempt > 0 && reattempt <= 3) {
      console.log(`User reattempted the module ${reattempt} time(s)`);
    } else {
      console.log(`Unexpected reattempt value: ${reattempt}`);
    }


    // / delete user
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


});

// quick assign modules scenarios

// quick assign lesson type module 
test.only('quick_assign_lesson_module', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  // create user
    await login(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);;
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lesson_1_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    await page.getByRole('button', { name: 'Save Module' }).click(); 
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… lesson module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    
     // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    

    // attempt quiz module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulelesson = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulelesson);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log(`\x1b[32m%s\x1b[0m`,'Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log(`\x1b[33m%s\x1b[0m`,'Alert dismissed after 4 seconds');
    });


    const found = await page.evaluate((username) => {
        const storedModule = localStorage.getItem("lesson1");
        if (!storedModule) return false;

        const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
        let match = false;

        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('[role="gridcell"]');
            if (!cells.length) return;

            const userCell    = cells[1]?.innerText.trim();
            const detailCell  = cells[3]?.innerText.trim();
            const logTypeCell = cells[4]?.innerText.trim();
            const dateCell    = cells[5]?.innerText.trim();

            if (userCell === username && detailCell.includes(storedModule)) {
                const rowData = { row: index, user: userCell, detail: detailCell, logType: logTypeCell, date: dateCell };
                console.log(`\x1b[32m%s\x1b[0m`,"Matched Row:", rowData);
                alert("Row Found â†’ " + JSON.stringify(rowData));
                match = true;
            }
        });

        return match;
    }, uName);

    console.log(`\x1b[32m%s\x1b[0m`,"Found status:", found);



  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=lesson');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


});
test('quick_assign_lesson_media_module', async ({ page }) => {
    test.setTimeout('1200000');
    await attachNetworkLogger(page);  

    // create user
    await login(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lesson_1_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.getByRole('tab', { name: 'Media' }).click();
    await page.click('#questionname');
    const QUE1 = "youtube_ques_"  + Math.floor(Math.random() * 100000);
    await page.fill('#questionname',QUE1);
    await page.getByText('Youtube URL').click();
    await page.click('#vembedCode');
    await page.fill('#vembedCode', 'https://youtu.be/2s6mIboARCM?si=mdodOqmtEXNH-2Px');
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.locator('#addQuesBtn').waitFor({state:'visible'});
    await page.click('#addQuesBtn');
    await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
    await page.locator('#content').getByRole('list').getByText('New').click();
    await page.getByRole('button', { name: 'New Lesson' }).click();
    await page.getByRole('tab', { name: 'Media' }).waitFor({state:'visible'});
    await page.waitForTimeout(2000);
    await page.getByRole('tab', { name: 'Media' }).click();
    await page.click('#questionname');
    const QUE2 = "embeded_code_"  + Math.floor(Math.random() * 100000);
    await page.fill('#questionname',QUE2);
    await page.getByText('Embed Code').click();
    await page.locator('#vembedCode').click();
    await page.locator('#vembedCode').fill('<iframe width="560" height="315" src="https://www.youtube.com/embed/D4DXbRsQAOA?si=j8VEzqIluzSXhs-2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>');
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.locator('#addQuesBtn').waitFor({state:'visible'});
    await page.click('#addQuesBtn');
    await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
    await page.locator('#content').getByRole('list').getByText('New').click();
    await page.getByRole('button', { name: 'New Lesson' }).click();
    await page.waitForTimeout(2000);
    await page.getByRole('tab', { name: 'Media' }).click();
    await page.click('#questionname');
    const QUE3 = "media_upload_"  + Math.floor(Math.random() * 100000);
    await page.fill('#questionname',QUE3);
    await page.getByText('Upload Video').click();
    await page.setInputFiles('input.dz-hidden-input', 'C:/Users/sss/Videos/Captures/sa.mp4');
    await page.waitForSelector('.modal-content #exampleModal', { state: 'hidden' });
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout:4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… media uploaded success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ media not uploaded (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    await page.getByRole('button', { name: 'Save Module' }).click(); 
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m%s\x1b[0m`,"âœ… lesson module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log(`\x1b[31m%s\x1b[0m`,"âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

       // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    

    // attempt quiz module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulelesson = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulelesson);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


       // admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log(`\x1b[32m%s\x1b[0m`,'Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log(`\x1b[33m%s\x1b[0m`,'Alert dismissed after 4 seconds');
    });


    const found = await page.evaluate((username) => {
        const storedModule = localStorage.getItem("lesson1");
        if (!storedModule) return false;

        const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
        let match = false;

        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('[role="gridcell"]');
            if (!cells.length) return;

            const userCell    = cells[1]?.innerText.trim();
            const detailCell  = cells[3]?.innerText.trim();
            const logTypeCell = cells[4]?.innerText.trim();
            const dateCell    = cells[5]?.innerText.trim();

            if (userCell === username && detailCell.includes(storedModule)) {
                const rowData = { row: index, user: userCell, detail: detailCell, logType: logTypeCell, date: dateCell };
                console.log("Matched Row:", rowData);
                alert("Row Found â†’ " + JSON.stringify(rowData));
                match = true;
            }
        });

        return match;
    }, uName);

    console.log(`\x1b[32m%s\x1b[0m`,"Found status:", found);



  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=lesson');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

});  
test('quick_assign_lesson_doc_module', async ({ page }) => {
  test.setTimeout('1200000');     

    await attachNetworkLogger(page);  

  await login(page);
    // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lesson_1_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.getByRole('tab', { name: 'Doc.' }).click();
    const QUE = "doc_lesson_"  + Math.floor(Math.random() * 100000);
    await page.fill('#questionname',QUE);
    await page.getByText('Click Here to Upload').click();
    await page.setInputFiles('input.dz-hidden-input', 'C:/Users/sss/Videos/Captures/javanotes5.pdf');
    await page.waitForSelector('.modal-content #exampleModal', { state: 'hidden' });
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout:4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… document uploaded success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ document not uploaded (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    await page.getByRole('button', { name: 'Save Module' }).click(); 
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log(`\x1b[32m%s\x1b[0m`,"âœ… lesson module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log(`\x1b[31m%s\x1b[0m`,"âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



       // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    

    // attempt lesson module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulelesson = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulelesson);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


       // admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log( 'Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log( 'Alert dismissed after 4 seconds');
    });

    const found = await page.evaluate((username) => {
        const storedModule = localStorage.getItem("lesson1");
        if (!storedModule) return false;

        const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
        let match = false;

        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('[role="gridcell"]');
            if (!cells.length) return;

            const userCell    = cells[1]?.innerText.trim();
            const detailCell  = cells[3]?.innerText.trim();
            const logTypeCell = cells[4]?.innerText.trim();
            const dateCell    = cells[5]?.innerText.trim();

            if (userCell === username && detailCell.includes(storedModule)) {
                const rowData = { row: index, user: userCell, detail: detailCell, logType: logTypeCell, date: dateCell };
                console.log("Matched Row:", rowData);
                alert("Row Found â†’ " + JSON.stringify(rowData));
                match = true;
            }
        });

        return match;
    }, uName);

    console.log(`\x1b[32m%s\x1b[0m`,"Found status:", found);



  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=lesson');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


});
// quick assign quizz type module 
test('quick_assign_quiz_module', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
     const badgeQuizName= 'Badge_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("quick_quiz_1", name);}, badgeQuizName);
    await page.fill('#name', badgeQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(badgeQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    

    // attempt quiz module
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz = await page.evaluate(() => {return localStorage.getItem("quick_quiz_1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


       // admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log(`\x1b[32m%s\x1b[0m`,'Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log(`\x1b[32m%s\x1b[0m`, 'Alert dismissed after 4 seconds');
    });


    const found = await page.evaluate((username) => {
        const storedModule = localStorage.getItem("quick_quiz_1");
        if (!storedModule) return false;

        const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
        let match = false;

        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('[role="gridcell"]');
            if (!cells.length) return;

            const userCell    = cells[1]?.innerText.trim();
            const detailCell  = cells[3]?.innerText.trim();
            const logTypeCell = cells[4]?.innerText.trim();
            const dateCell    = cells[5]?.innerText.trim();

            if (userCell === username && detailCell.includes(storedModule)) {
                const rowData = { row: index, user: userCell, detail: detailCell, logType: logTypeCell, date: dateCell };
                console.log("Matched Row:", rowData);
                alert("Row Found â†’ " + JSON.stringify(rowData));
                match = true;
            }
        });

        return match;
    }, uName);

    console.log(`\x1b[32m%s\x1b[0m`,"Found status:", found);



  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);




});
test.only('quick_assign_quiz_module_with_time_limit', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  


  await login(page);
    // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    

     // create quiz 1
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName= 'quick_Quiz_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("quick_quiz_1", name);}, badgeQuizName);
    await page.fill('#name', badgeQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('#time');
    await page.fill('#time', '1');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(badgeQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz 1 "${badgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz 1 "${badgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName2= 'quick_Quiz_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz_module_2", name);}, badgeQuizName2);
    await page.fill('#name', badgeQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    const UserName = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(UserName);
    await page.locator(`.select2-results__option:has-text("${UserName}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${UserName}")`);
    await page.click('#time');
    await page.fill('#time', '1');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const Quizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, Quizques1);
    await page.fill('#questionname ', Quizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const Quizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, Quizques2);
    await page.fill('#questionname', Quizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const Quizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, Quizques3);
    await page.fill('#questionname', Quizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const Quizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, Quizques4);
    await page.fill('#questionname', Quizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz2gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz2Found = quiz2gridText.includes(badgeQuizName2);
    if (quiz2Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

     // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    

    // attempt  module for badge scenario 8
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz = await page.evaluate(() => {return localStorage.getItem("quick_quiz_1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    await page.getByRole('textbox', { name: 'Search Module' }).waitFor({state:'visible'});
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz2 = await page.evaluate(() => {return localStorage.getItem("Quiz_module_2");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz2);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Review' }).nth(1).waitFor({ state: 'visible' });
    const reviewButton = page.getByRole('button', { name: 'Review' }).nth(1);
    if (await reviewButton.isVisible()) {

      await page.evaluate(() => {
        alert("You have not able to complete module in alloted time because of that module is markerd completed.");
      });
      console.log( `\x1b[32m%s\x1b[0m`,"Review mode only: not able to complete module in alloted time limit. ");
    } else {
      console.log(`\x1b[31m%s\x1b[0m`,"Review button not found, proceeding with normal flow.");
    }


     // admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log('Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log('Alert dismissed after 4 seconds');
    });
    const found = await page.evaluate((username) => {
        const storedModules = [
            localStorage.getItem("quick_quiz_1"),
            localStorage.getItem("Quiz_module_2")
        ].filter(Boolean); // remove nulls if not set

        if (!storedModules.length) return false;

        const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
        let matches = [];

        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('[role="gridcell"]');
            if (!cells.length) return;

            const userCell    = cells[1]?.innerText.trim();
            const detailCell  = cells[3]?.innerText.trim();
            const logTypeCell = cells[4]?.innerText.trim();
            const dateCell    = cells[5]?.innerText.trim();

            if (userCell === username) {
                storedModules.forEach(moduleName => {
                    if (detailCell.includes(moduleName)) {
                        const rowData = {
                            row: index,
                            user: userCell,
                            module: moduleName,
                            detail: detailCell,
                            logType: logTypeCell,
                            date: dateCell
                        };
                        console.log("Matched Row:", rowData);
                        matches.push(rowData);
                    }
                });
            }
        });

        if (matches.length) {
            alert("Rows Found â†’ " + JSON.stringify(matches));
            return matches;
        }
      return false;
    }, uName);

console.log("Found status:", found);


  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);



});
test('quick_assign_quiz_module_with_multi_attempt', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
// create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    // const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… learner created  success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



// create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const QuizName3= 'Quiz_reattempt_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz3", name);}, QuizName3);
    await page.fill('#name',QuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '20');
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.locator('#isMultipleReattempts').check();
    await page.locator('#reattempts').click();
    await page.locator('#reattempts').fill('3');
    await page.locator('#isMarksLessThan').check();
    await page.locator('#reattemptmarkslessthanpercent').click();
    await page.locator('#reattemptmarkslessthanpercent').fill('80');
    await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
    await page.click('#questionname');
    const ques1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques1);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'we');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'ew');
    await page.click('#quizQuestionOption2 .col-md-5');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(4) #Layer_1');
    await page.locator('#questionname').waitFor({ state: 'visible'});
    await page.click('#questionname');
    const ques2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques2);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) #Layer_1');
    await page.locator('#questionname').waitFor({ state: 'visible'});
    await page.click('#questionname');
    const ques3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques3);
    await page.click('#option1');
    await page.fill('#option1', 'dg');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erfer');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option3');
    await page.fill('#option3', 'erf');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option4');
    await page.fill('#option4', 'ergfer');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab > div');
    await page.locator('#questionname').waitFor({ state: 'visible'});
    await page.click('#questionname');
    const ques4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques4);
    await page.click('#option1');
    await page.fill('#option1', 'erger');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erger');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(4) #Layer_1');
    await page.click('#questionname');
    const ques5= 'Quiz_QUE5_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques5);
    await page.fill('#totalMarks', '10');
    await page.click('#totalMarks');
    await page.click('.py-2:nth-child(4)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    // try {
    //   await Promise.race([
    //     successToast.waitFor({ state: 'visible', timeout: 4000 }),
    //   ]);
    //   if (await successToast.isVisible()) {
    //     console.log("âœ… quiz module created success message showed successfully!");
    //   }
    // } catch (e) {
    //   console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    // }
    await tostr_detector(page);

    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(QuizName3);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${QuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${QuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    } 

     // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz3 = await page.evaluate(() => {return localStorage.getItem("Quiz3");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz3);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    await page.getByRole('button', { name: 'Relaunch' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Relaunch' }).click();
    await page.getByRole('button', { name: 'Yes' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    await page.getByRole('button', { name: 'Relaunch' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Relaunch' }).click();
    await page.getByRole('button', { name: 'Yes' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    await page.getByRole('button', { name: 'Relaunch' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Relaunch' }).click();
    await page.getByRole('button', { name: 'Yes' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Review' }).waitFor({state:'visible'});
    const reviewButton = page.getByRole('button', { name: 'Review' });
    if (await reviewButton.isVisible()) {

      await page.evaluate(() => {
        alert("You have reached the limit of allowed reattempts for this module. Your module is submitted. Now you can only review it.");
      });
      console.log("Review mode only: limit of reattempts reached.");
    } else {
      console.log("Review button not found, proceeding with normal flow.");
    }


    
     // admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log('Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log('Alert dismissed after 4 seconds');
    });
    const found = await page.evaluate((username) => {
        const storedModule = localStorage.getItem("Quiz3");
        if (!storedModule) return false;

        const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
        let match = false;

        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('[role="gridcell"]');
            if (!cells.length) return;

            const userCell    = cells[1]?.innerText.trim();
            const detailCell  = cells[3]?.innerText.trim();
            const logTypeCell = cells[4]?.innerText.trim();
            const dateCell    = cells[5]?.innerText.trim();

            if (userCell === username && detailCell.includes(storedModule)) {
                const rowData = { row: index, user: userCell, detail: detailCell, logType: logTypeCell, date: dateCell };
                console.log("Matched Row:", rowData);
                alert("Row Found â†’ " + JSON.stringify(rowData));
                match = true;
            }
        });

        return match;
    }, uName);

    console.log("Found status:", found);

 // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);



  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

});
test('quick_assign_quiz_module_with_leaderboard_enabled', async ({ page }) => {
   test.setTimeout('1200000');
    await attachNetworkLogger(page);  

   await login(page);
   // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const QuizName3= 'Quiz_reattempt_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz3", name);}, QuizName3);
    await page.fill('#name',QuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '20');
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
    await page.click('#questionname');
    const ques1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques1);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'we');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'ew');
    await page.click('#quizQuestionOption2 .col-md-5');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(4) #Layer_1');
    await page.locator('#questionname').waitFor({ state: 'visible'});
    await page.click('#questionname');
    const ques2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques2);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) #Layer_1');
    await page.locator('#questionname').waitFor({ state: 'visible'});
    await page.click('#questionname');
    const ques3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques3);
    await page.click('#option1');
    await page.fill('#option1', 'dg');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erfer');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option3');
    await page.fill('#option3', 'erf');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option4');
    await page.fill('#option4', 'ergfer');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab > div');
    await page.locator('#questionname').waitFor({ state: 'visible'});
    await page.click('#questionname');
    const ques4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques4);
    await page.click('#option1');
    await page.fill('#option1', 'erger');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erger');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(4) #Layer_1');
    await page.click('#questionname');
    const ques5= 'Quiz_QUE5_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques5);
    await page.fill('#totalMarks', '10');
    await page.click('#totalMarks');
    await page.click('.py-2:nth-child(4)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.click('#isShowLeaderboard');
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(QuizName3);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${QuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${QuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    } 

    
     // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz3 = await page.evaluate(() => {return localStorage.getItem("Quiz3");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz3);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
  

    // check leaderboard postion 
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).waitFor({state: 'visible'});
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedmodulename = await page.evaluate(() => {return localStorage.getItem("Quiz3");});
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedmodulename);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).press('Enter');
    await page.locator('.leaderboard-card', { hasText: storedmodulename }).getByRole('button', { name: 'View' }).click();
    await page.waitForLoadState('networkidle');
    const userCard = page.locator('.flex.flex-row.justify-between.items-center.rounded-xl');
      const UName = await userCard.locator('div > div > div').first().innerText();
      const score = await userCard.locator('div > div > div.text-sm').innerText();
      const rank = await userCard.locator('div.font-color-1.font-semibold').innerText();
      const userData = {
        username: UName.trim(),
        score: parseInt(score.trim(), 10),
        rank: parseInt(rank.trim(), 10),
      };
      await page.evaluate((data) => {
        localStorage.setItem('userData', JSON.stringify(data));
      }, userData);
      console.log("leaderbord User Data from userui/leaderboard :", userData);

    await page.getByRole('listitem').getByRole('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});



    // admin login call
    await login(page);


    // check leaderboard data of user and compare with userui leaderboard data 
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedmodule = await page.evaluate(() => {return localStorage.getItem("Quiz3");});
    await page.locator('div[role="row"]', { hasText: storedmodule }).locator('.showLeaderboardLink').click();
    await page.waitForLoadState('networkidle');

    const userUIData = await page.evaluate(() => {
      const data = localStorage.getItem('userData'); return data ? JSON.parse(data) : null;
    });
    const learnerData = await page.evaluate(() => {
      const row = document.querySelector('table.m-auto.p-20.width-70 tbody tr');
      if (!row) return null;

      const username = row.querySelector('td:nth-child(2)')?.innerText.trim();
      const score = row.querySelector('td:nth-child(4)')?.innerText.trim();
      const rank = row.querySelector('td:nth-child(3)')?.innerText.trim();

      return {
        username,
        score: score ? parseInt(score, 10) : null,
        rank: rank ? parseInt(rank, 10) : null,
      };
    });

    if (!learnerData) {
    console.log("âŒ No learner leaderboard data on the page");
    } else {
    console.log("ðŸ‘¤ Learner Data from leaderboard:", learnerData);

    const matched = (
    learnerData.username === userUIData.username &&
    learnerData.score === userUIData.score &&
    learnerData.rank === userUIData.rank
    );

    const message = matched
    ? "âœ… User rank is correct (matches for admin and user)"
    : "âŒ Mismatch detected between userData and leaderboard";

    console.log(message);
    await page.evaluate((msg) => alert(msg), message);
    }

    

  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);



}); 
test('quick_assign_quiz_module_with_pass_percentage_&_end_creen', async ({ page }) => {
  test.setTimeout('1200000'); 
    await attachNetworkLogger(page);  
  
  await login(page);
  //  create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    

// create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const QuizName3= 'Quiz_reattempt_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("Quiz3", name);}, QuizName3);
    await page.fill('#name',QuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '20');
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('#passpercent');
    await page.fill('#passpercent','30');
    await page.getByText('Enable End Screen To show').click();
    await page.locator('#isEndScreen').click();
    await page.locator('#endScreenSuccessMsg').click();
    await page.locator('#endScreenSuccessMsg').fill('congratulations!ðŸŽ‰ðŸŽ‰ you just break the door for next step towords success by passing the module.');
    await page.locator('#endScreenFailMsg').click();
    await page.locator('#endScreenFailMsg').fill('you just done a amazing job. Keep practice a little more and you will be a show breaker soon ðŸ˜Š.');
    await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
    await page.click('#questionname');
    const ques1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques1);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'we');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'ew');
    await page.click('#quizQuestionOption2 .col-md-5');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(4) #Layer_1');
    await page.locator('#questionname').waitFor({ state: 'visible'});
    await page.click('#questionname');
    const ques2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques2);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) #Layer_1');
    await page.locator('#questionname').waitFor({ state: 'visible'});
    await page.click('#questionname');
    const ques3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques3);
    await page.click('#option1');
    await page.fill('#option1', 'dg');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erfer');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option3');
    await page.fill('#option3', 'erf');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option4');
    await page.fill('#option4', 'ergfer');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab > div');
    await page.locator('#questionname').waitFor({ state: 'visible'});
    await page.click('#questionname');
    const ques4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques4);
    await page.click('#option1');
    await page.fill('#option1', 'erger');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erger');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(4) #Layer_1');
    await page.click('#questionname');
    const ques5= 'Quiz_QUE5_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques5);
    await page.fill('#totalMarks', '10');
    await page.click('#totalMarks');
    await page.click('.py-2:nth-child(4)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(QuizName3);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${QuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${QuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    } 

    // create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName2= 'Badge_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("quick_quiz_2", name);}, badgeQuizName2);
    await page.fill('#name', badgeQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('#passpercent');
    await page.fill('#passpercent','80');
    await page.getByText('Enable End Screen To show').click();
    await page.locator('#isEndScreen').click();
    await page.locator('#endScreenSuccessMsg').click();
    await page.locator('#endScreenSuccessMsg').fill('congratulations!ðŸŽ‰ðŸŽ‰ you just break the door for next step towords success by passing the module.');
    await page.locator('#endScreenFailMsg').click();
    await page.locator('#endScreenFailMsg').fill('you just done a amazing job. Keep practice a little more and you will be a show breaker soon ðŸ˜Š.');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const Quizques1= 'Badge_Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname ', Quizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const Quizques2= 'Badge_Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', Quizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.click('#quesTitle0 .gap-4');
    await page.waitForTimeout(4000);
    await page.click('#questionname');
    const Quizques3= 'Badge_Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', Quizques3);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    await page.waitForTimeout(2000); 
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const Quizques4= 'Badge_Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', Quizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz2gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz2Found = quiz2gridText.includes(badgeQuizName2);
    if (quiz2Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    } 
    
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    

    // attempt quiz module
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz = await page.evaluate(() => {return localStorage.getItem("Quiz3");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
  
    const modalLocator = page.locator('div[role="dialog"][aria-modal="true"]');
    await modalLocator.waitFor({ state: 'visible', timeout: 5000 });

    const modalText = await modalLocator.locator('.ant-modal-body .ant-typography').innerText();

    if (modalText.toLowerCase().includes('congratulations!')) {
        console.log(`\x1b[32m "âœ… Success: End Screen showed successfully" \x1b[0m`);
    } else if(modalText.toLowerCase().includes('you just done a amazing job.')){
        
        console.log(`\x1b[32m "âœ… Failure: End Screen showed successfully" \x1b[0m`);
    }else{
      console.log(`\x1b[31m "âŒ Failure: Profile did not show" \x1b[0m`);
    }
    await page.getByRole('button', { name: 'OK' }).click();
    await page.waitForLoadState('networkidle');

    

    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz2 = await page.evaluate(() => {return localStorage.getItem("quick_quiz_2");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz2);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    if (modalText.toLowerCase().includes('congratulations!')) {
        console.log(`\x1b[32m "âœ… Success: End Screen showed successfully" \x1b[0m`);
    } else if(modalText.toLowerCase().includes('you just done a amazing job.')){
        
        console.log(`\x1b[32m "âœ… Failure: End Screen showed successfully" \x1b[0m`);
    }else{
      console.log(`\x1b[31m "âŒ Failure: Profile did not show" \x1b[0m`);
    }
    await page.getByRole('button', { name: 'OK' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('listitem').getByRole('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});



    // admin login call
    await login(page);

    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

});
// quick assign survey type module 
test('quick_assign_survey_module_with_likert_questions', async ({ page }) => {
  test.setTimeout('1200000'); 
    await attachNetworkLogger(page);  

  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create survey
  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const survey_name = await page.evaluate(() =>{
    let name = 'survey_likert_'  + Math.floor(Math.random() * 100000); localStorage.setItem('survey1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(survey_name);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const rating_quetion = 'rating_ques_' + Math.floor(Math.random() * 100000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(rating_quetion);
  await page.waitForTimeout(1000);
  await page.getByRole('tab', { name: 'Rating', exact: true }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('checkbox').check();
  await page.waitForTimeout(1000);
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const likelohood_quetion = 'likelihood_ques_' + Math.floor(Math.random() * 100000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(likelohood_quetion);
  await page.getByRole('tab', { name: 'Likelihood' }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('checkbox').check();
  await page.waitForTimeout(1000);
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const satisfaction_quetion = 'satisfaction_ques_' + Math.floor(Math.random() * 100000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(satisfaction_quetion);
  await page.waitForTimeout(1000);
  await page.getByRole('tab', { name: 'Satisfaction' }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('checkbox').check();
  await page.waitForTimeout(1000);
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const emoji_quetion = 'emoji_ques_' + Math.floor(Math.random() * 100000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(emoji_quetion);
  await page.waitForTimeout(1000);
  await page.getByRole('tab', { name: 'Emoji' }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('checkbox').check();
  await page.waitForTimeout(1000);
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const star_rating_quetion = 'star_rating_ques_' + Math.floor(Math.random() * 100000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(star_rating_quetion);
  await page.waitForTimeout(1000);
  await page.getByRole('tab', { name: 'Star Rating' }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('checkbox').check();
  await page.waitForTimeout(1000);
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… survey module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ survey module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=survey');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const surveygridText = await page.locator('#contentmanageModulesGrid').innerText();
    const surveyFound = surveygridText.includes(survey_name);
    if (surveyFound) {
        console.log(`\x1b[32mâœ… Verified: Survey "${survey_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Survey "${survey_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz3 = await page.evaluate(() => {return localStorage.getItem("survey1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz3);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('.ant-card').nth(4).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.locator('.ant-card').nth(2).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.locator('.ant-card').nth(1).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.locator('.ant-card').nth(3).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.locator('.ant-card').nth(5).click();
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



// admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log('Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log('Alert dismissed after 4 seconds');
    });


    const found = await page.evaluate((username) => {
        const storedModule = localStorage.getItem("survey1");
        if (!storedModule) return false;

        const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
        let match = false;

        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('[role="gridcell"]');
            if (!cells.length) return;

            const userCell    = cells[1]?.innerText.trim();
            const detailCell  = cells[3]?.innerText.trim();
            const logTypeCell = cells[4]?.innerText.trim();
            const dateCell    = cells[5]?.innerText.trim();

            if (userCell === username && detailCell.includes(storedModule)) {
                const rowData = { row: index, user: userCell, detail: detailCell, logType: logTypeCell, date: dateCell };
                console.log("Matched Row:", rowData);
                alert("Row Found â†’ " + JSON.stringify(rowData));
                match = true;
            }
        });

        return match;
    }, uName);

    console.log("Found status:", found);



  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


});
test('quick_assign_survey_module_with_other_questions', async ({ page }) => {
  test.setTimeout('1200000'); 
    await attachNetworkLogger(page);  

  await login(page);
    //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create survey
  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const survey_name = await page.evaluate(() =>{
    let name = 'survey_likert_'  + Math.floor(Math.random() * 100000); localStorage.setItem('survey1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(survey_name);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.getByRole('tab', { name: 'Essay Question' }).click();
  await page.locator('#questionname').click();
  const QUE1 = ' essay type question for survey' + Math.floor(Math.random() * 100000);
  await page.locator('#questionname').fill(QUE1);
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.click('#addQuesBtn');
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('tab', { name: 'Single Selection' }).waitFor({state:'visible'});
  await page.getByRole('tab', { name: 'Single Selection' }).click();
  await page.locator('#questionname').click();
  const QUE2 = ' single selection type question for survey' + Math.floor(Math.random() * 100000);
  await page.locator('#questionname').fill(QUE2);
  await page.locator('#option1').click();
  await page.locator('#option1').fill('A');
  await page.locator('#addQuizQuestionOptionButton').click();
  await page.locator('#option2').click();
  await page.locator('#option2').fill('B');
  await page.locator('#addQuizQuestionOptionButton').click();
  await page.locator('#option3').click();
  await page.locator('#option3').fill('C');
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.click('#addQuesBtn');
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('tab', { name: 'Multi Selection' }).waitFor({state:'visible'});
  await page.getByRole('tab', { name: 'Multi Selection' }).click();
  await page.locator('#questionname').click();
  const QUE3 = ' multi selection type question for survey' + Math.floor(Math.random() * 100000);
  await page.locator('#questionname').fill(QUE3);
  await page.locator('#option1').waitFor({state:'visible'});
  await page.locator('#option1').click();
  await page.locator('#option1').fill('A');
  await page.locator('#addQuizQuestionOptionButton').click();
  await page.locator('#option2').waitFor({state:'visible'});
  await page.locator('#option2').click();
  await page.locator('#option2').fill('B');
  await page.locator('#addQuizQuestionOptionButton').click();
  await page.locator('#option3').waitFor({state:'visible'});
  await page.locator('#option3').click();
  await page.locator('#option3').fill('C');
  await page.locator('#addQuizQuestionOptionButton').click();
  await page.locator('#option4').waitFor({state:'visible'});
  await page.locator('#option4').click();
  await page.locator('#option4').fill('D');
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.click('#addQuesBtn');
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('tab', { name: 'Estimate Percentage' }).waitFor({state:'visible'});
  await page.getByRole('tab', { name: 'Estimate Percentage' }).click();
  await page.locator('#questionname').click();
  const QUE4 = ' estimate percentage type question for survey' + Math.floor(Math.random() * 100000);
  await page.locator('#questionname').fill(QUE4);
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.click('#addQuesBtn');
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('tab', { name: 'Yes No' }).waitFor({state:'visible'});
  await page.getByRole('tab', { name: 'Yes No' }).click();
  await page.locator('#questionname').click();
  const QUE5 = 'yes no type question for survey' + Math.floor(Math.random() * 100000);
  await page.locator('#questionname').fill(QUE5);
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.click('#addQuesBtn');
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.waitForTimeout(1000);
  await page.getByRole('tab', { name: 'Sequencing' }).waitFor({state:'visible'});
  await page.getByRole('tab', { name: 'Sequencing' }).click();
  await page.locator('#questionname').click();
  const QUE6 = 'sequencing type question for survey' + Math.floor(Math.random() * 100000);
  await page.locator('#questionname').fill(QUE6);
  await page.locator('#option1').waitFor({state:'visible'});
  await page.locator('#option1').click();
  await page.locator('#option1').fill('bA');
  await page.locator('#addQuizQuestionOptionButton').click();
  await page.locator('#option2').waitFor({state:'visible'});
  await page.locator('#option2').click();
  await page.locator('#option2').fill('AB');
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… survey module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ survey module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=survey');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const surveygridText = await page.locator('#contentmanageModulesGrid').innerText();
    const surveyFound = surveygridText.includes(survey_name);
    if (surveyFound) {
        console.log(`\x1b[32mâœ… Verified: Survey "${survey_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Survey "${survey_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


   // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz3 = await page.evaluate(() => {return localStorage.getItem("survey1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz3);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'essay type question for' }).click();
    await page.getByRole('textbox', { name: 'essay type question for' }).fill(' answer for essay type question.');
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.locator('.ant-slider-rail').click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



  // admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log('Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log('Alert dismissed after 4 seconds');
    });


    const found = await page.evaluate((username) => {
        const storedModule = localStorage.getItem("survey1");
        if (!storedModule) return false;

        const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
        let match = false;

        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('[role="gridcell"]');
            if (!cells.length) return;

            const userCell    = cells[1]?.innerText.trim();
            const detailCell  = cells[3]?.innerText.trim();
            const logTypeCell = cells[4]?.innerText.trim();
            const dateCell    = cells[5]?.innerText.trim();

            if (userCell === username && detailCell.includes(storedModule)) {
                const rowData = { row: index, user: userCell, detail: detailCell, logType: logTypeCell, date: dateCell };
                console.log("Matched Row:", rowData);
                alert("Row Found â†’ " + JSON.stringify(rowData));
                match = true;
            }
        });

        return match;
    }, uName);

    console.log("Found status:", found);



  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

});
// quick assign with task type module
test('quick_assign_task_module_with_quick_reporting', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
    //create user
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#username');
  const username = await page.evaluate(() => {
    let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
  });
  await page.fill('#username', username);
  await page.click('#password');
  await page.fill('#password', '12345678');
  await page.click('#name');
  await page.fill('#name', username);
  await page.click('#emailid');
  await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

  
  // create task module with quick reporting yes/no
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname1 = await page.evaluate(() =>{
    let name = 'task_yes_no_'  + Math.floor(Math.random() * 100000); localStorage.setItem('task1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname1);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#quickReportingTaskTypeLabel').click();
  await page.locator('#responsetype').click();
  await page.locator('#responsetype').selectOption('yes_no');
  await page.getByRole('button', { name: 'Save Module' }).click();
  try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const taskgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const taskFound = taskgridText.includes(taskname1);
    if (taskFound) {
        console.log(`\x1b[32mâœ… Verified: Task with quick reporting of yes/no type "${taskname1}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with quick reporting of yes/no type "${taskname1}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


  //  create task module with quick reporting number
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname2 = await page.evaluate(() =>{
    let name = 'task_number_'  + Math.floor(Math.random() * 100000); localStorage.setItem('task2',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname2);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#quickReportingTaskTypeLabel').click();
  await page.locator('#responsetype').click();
  await page.locator('#responsetype').selectOption('number');
  await page.getByRole('button', { name: 'Save Module' }).click();
  try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const task2gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const task2Found = task2gridText.includes(taskname2);
    if (task2Found) {
        console.log(`\x1b[32mâœ… Verified: Task with quick reporting of number type "${taskname2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with quick reporting of number type "${taskname2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

  //  create task module with quick reporting date
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname3 = await page.evaluate(() =>{
    let name = 'task_date_'  + Math.floor(Math.random() * 100000); localStorage.setItem('task3',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname3);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#quickReportingTaskTypeLabel').click();
  await page.locator('#responsetype').click();
  await page.locator('#responsetype').selectOption('date');
  await page.getByRole('button', { name: 'Save Module' }).click();
  try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const task3gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const task3Found = task3gridText.includes(taskname3);
    if (task3Found) {
        console.log(`\x1b[32mâœ… Verified: Task with quick reporting of date type "${taskname3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with quick reporting of date type "${taskname3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


 //  create task module with quick reporting text
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname4 = await page.evaluate(() =>{
    let name = 'task_text_'  + Math.floor(Math.random() * 100000); localStorage.setItem('task4',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname4);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#quickReportingTaskTypeLabel').click();
  await page.locator('#responsetype').click();
  await page.locator('#responsetype').selectOption('text');
  await page.getByRole('button', { name: 'Save Module' }).click();
  try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const task4gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const task4Found = task4gridText.includes(taskname4);
    if (task4Found) {
        console.log(`\x1b[32mâœ… Verified: Task with quick reporting of text type "${taskname4}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with quick reporting of text type "${taskname4}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


  // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).waitFor({state:'visible'});
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask1 = await page.evaluate(() => {return localStorage.getItem("task1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask1);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).waitFor({state:'visible'});
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask2 = await page.evaluate(() => {return localStorage.getItem("task2");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask2);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('spinbutton').click();
    await page.getByRole('spinbutton').fill('5');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).waitFor({state:'visible'});
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask3 = await page.evaluate(() => {return localStorage.getItem("task3");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask3);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Select date' }).click();
    await page.getByText('18').click();
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).waitFor({state:'visible'});
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask4 = await page.evaluate(() => {return localStorage.getItem("task4");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask4);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Write text' }).click();
    await page.getByRole('textbox', { name: 'Write text' }).fill('this is a text');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('listitem').getByRole('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log('Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log('Alert dismissed after 4 seconds');
    });
    const found = await page.evaluate((username) => {
    const storedModules = [
        localStorage.getItem("task1"),
        localStorage.getItem("task2"),
        localStorage.getItem("task3"),
        localStorage.getItem("task4"),
    ].filter(Boolean); 

    if (!storedModules.length) return false;

    const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
    let match = false;

    rows.forEach((row, index) => {
        const cells = row.querySelectorAll('[role="gridcell"]');
        if (!cells.length) return;

        const userCell    = cells[1]?.innerText.trim();
        const detailCell  = cells[3]?.innerText.trim();
        const logTypeCell = cells[4]?.innerText.trim();
        const dateCell    = cells[5]?.innerText.trim();

        if (userCell === username && storedModules.some(task => detailCell.includes(task))) {
            const rowData = { 
                row: index, 
                user: userCell, 
                detail: detailCell, 
                logType: logTypeCell, 
                date: dateCell 
            };
            console.log("Matched Row:", rowData);
            alert("Row Found â†’ " + JSON.stringify(rowData));
            match = true;
        }
    });

    return match;
}, uName);

console.log("Found status:", found);



  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


});
test('quick_assign_task_module_with_survey', async ({ page }) => {
  test.setTimeout('1200000'); 
    await attachNetworkLogger(page);  

   await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create survey
  await page.goto('showModulesGrid.php?type=survey');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const survey_name = await page.evaluate(() =>{
    let name = 'survey_likert_' + Math.floor(Math.random() * 100000); localStorage.setItem('survey1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(survey_name);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const rating_quetion = 'rating_ques_' + Math.floor(Math.random() * 100000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(rating_quetion);
  await page.getByRole('tab', { name: 'Rating', exact: true }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const likelohood_quetion = 'likelihood_ques_' + Math.floor(Math.random() * 100000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(likelohood_quetion);
  await page.getByRole('tab', { name: 'Likelihood' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const satisfaction_quetion = 'satisfaction_ques_' + Math.floor(Math.random() * 100000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(satisfaction_quetion);
  await page.getByRole('tab', { name: 'Satisfaction' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const emoji_quetion = 'emoji_ques_' + Math.floor(Math.random() * 100000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(emoji_quetion);
  await page.getByRole('tab', { name: 'Emoji' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'Add Question' }).click();
  await page.locator('#content').getByRole('list').getByText('New').waitFor({state:'visible'});
  await page.locator('#content').getByRole('list').getByText('New').click();
  await page.getByRole('button', { name: 'New Survey' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'New Survey' }).click();
  await page.waitForTimeout(2000);
  await page.getByRole('tab', { name: 'Likert Scale' }).click();
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).click();
  const star_rating_quetion = 'star_rating_ques_' + Math.floor(Math.random() * 100000);
  await page.getByRole('textbox', { name: 'Question Enter question Name' }).fill(star_rating_quetion);
  await page.getByRole('tab', { name: 'Star Rating' }).click();
  await page.getByRole('button', { name: 'Save Question' }).click();
  await page.getByRole('button', { name: 'Save Question' }).waitFor({state:'hidden'});
  await page.getByRole('button', { name: 'Add Question' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'Save Module' }).click();
   try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… survey module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ survey module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=survey');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const surveygridText = await page.locator('#contentmanageModulesGrid').innerText();
    const surveyFound = surveygridText.includes(survey_name);
    if (surveyFound) {
        console.log(`\x1b[32mâœ… Verified: Survey "${survey_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Survey "${survey_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

  // create task with survey
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname1 = await page.evaluate(() =>{
    let name = 'task_survey_'  + Math.floor(Math.random() * 100000); localStorage.setItem('task1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname1);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#surveyTaskTypeLabel').click();
  await page.locator('#surveyseq').click();
  const surveyname = await page.evaluate(() => {return localStorage.getItem("survey1");});
  await page.selectOption('#surveyseq', { label: surveyname });
  await page.getByRole('button', { name: 'Save Module' }).click();
  try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const taskgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const taskFound = taskgridText.includes(taskname1);
    if (taskFound) {
        console.log(`\x1b[32mâœ… Verified: Task with survey "${taskname1}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with survey "${taskname1}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

  // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask1 = await page.evaluate(() => {return localStorage.getItem("task1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask1);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.locator('.ant-card').nth(4).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.locator('.ant-card').nth(2).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.locator('.ant-card').nth(1).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.locator('.ant-card').nth(3).click();
    await page.getByRole('button', { name: 'Next' }).click();
    await page.waitForTimeout(2000);
    await page.locator('.ant-card').nth(5).click();
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



  // admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log('Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log('Alert dismissed after 4 seconds');
    });

    const found = await page.evaluate((username) => {
        const storedModule = localStorage.getItem("task1");
        if (!storedModule) return false;

        const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
        let match = false;

        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('[role="gridcell"]');
            if (!cells.length) return;

            const userCell    = cells[1]?.innerText.trim();
            const detailCell  = cells[3]?.innerText.trim();
            const logTypeCell = cells[4]?.innerText.trim();
            const dateCell    = cells[5]?.innerText.trim();

            if (userCell === username && detailCell.includes(storedModule)) {
                const rowData = { row: index, user: userCell, detail: detailCell, logType: logTypeCell, date: dateCell };
                console.log("Matched Row:", rowData);
                alert("Row Found â†’ " + JSON.stringify(rowData));
                match = true;
            }
        });

        return match;
    }, uName);

    console.log("Found status:", found);


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


});
test('quick_assign_task_module_with_media_upload', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);    
    //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create task module with media upload
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname1 = await page.evaluate(() =>{
    let name = 'task_doc_upload_'  + Math.floor(Math.random() * 100000); localStorage.setItem('task1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname1);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#documentTaskTypeLabel').click();
  await page.locator('#mediatype_select').click();
  await page.locator('#mediatype_select').selectOption('document');
  await page.getByRole('button', { name: 'Save Module' }).click();
  try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const taskgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const taskFound = taskgridText.includes(taskname1);
    if (taskFound) {
        console.log(`\x1b[32mâœ… Verified: Task with media upload of ducument type "${taskname1}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with media upload of ducument type "${taskname1}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname2 = await page.evaluate(() =>{
    let name = 'task_video_upload_' + Math.floor(Math.random() * 100000); localStorage.setItem('task2',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname2);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#documentTaskTypeLabel').click();
  await page.locator('#mediatype_select').click();
  await page.locator('#mediatype_select').selectOption('video');
  await page.getByRole('button', { name: 'Save Module' }).click();
  try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const task2gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const task2Found = task2gridText.includes(taskname2);
    if (task2Found) {
        console.log(`\x1b[32mâœ… Verified: Task with media upload of video type "${taskname2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with media upload of video type "${taskname2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }




  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname3 = await page.evaluate(() =>{
    let name = 'task_audio_upload_' + Math.floor(Math.random() * 100000); localStorage.setItem('task3',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname3);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#documentTaskTypeLabel').click();
  await page.locator('#mediatype_select').click();
  await page.locator('#mediatype_select').selectOption('audio');
  await page.getByRole('button', { name: 'Save Module' }).click();
  try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const task3gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const task3Found = task3gridText.includes(taskname3);
    if (task3Found) {
        console.log(`\x1b[32mâœ… Verified: Task with media upload of audio type "${taskname3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with media upload of audio type "${taskname3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname4 = await page.evaluate(() =>{
    let name = 'task_img_upload_'+ Math.floor(Math.random() * 100000); localStorage.setItem('task4',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname4);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#documentTaskTypeLabel').click();
  await page.locator('#mediatype_select').click();
  await page.locator('#mediatype_select').selectOption('image');
  await page.getByRole('button', { name: 'Save Module' }).click();
  try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const task4gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const task4Found = task4gridText.includes(taskname4);
    if (task4Found) {
        console.log(`\x1b[32mâœ… Verified: Task with media upload of image type "${taskname4}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with media upload of image type "${taskname4}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

  
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname5 = await page.evaluate(() =>{
    let name = 'task_link_upload_' + Math.floor(Math.random() * 100000); localStorage.setItem('task5',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname5);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#documentTaskTypeLabel').click();
  await page.locator('#mediatype_select').click();
  await page.locator('#mediatype_select').selectOption('link');
  await page.getByRole('button', { name: 'Save Module' }).click();
try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const task5gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const task5Found = task5gridText.includes(taskname5);
    if (task5Found) {
        console.log(`\x1b[32mâœ… Verified: Task with media upload of text type "${taskname5}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with media upload of text type "${taskname5}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

   // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    

    // attempt module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask1 = await page.evaluate(() => {return localStorage.getItem("task1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask1);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    const fileInput = page.locator('input[type="file"]');
    await fileInput.setInputFiles('C:/Users/sss/Videos/Captures/javanotes5.pdf');
    await page.waitForSelector('.ant-upload-list-item-name[title="javanotes5.pdf"]', {timeout: 4000});
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask2 = await page.evaluate(() => {return localStorage.getItem("task2");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask2);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await fileInput.setInputFiles('C:/Users/sss/Videos/Captures/sa.mp4');
    await page.waitForSelector('.ant-upload-list-item-name[title="sa.mp4"]', {timeout: 4000});
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask3 = await page.evaluate(() => {return localStorage.getItem("task3");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask3);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await fileInput.setInputFiles('C:/Users/sss/Videos/Captures/play.mp3');
    await page.waitForSelector('.ant-upload-list-item-name[title="play.mp3"]', {timeout: 4000});
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask4 = await page.evaluate(() => {return localStorage.getItem("task4");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask4);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await fileInput.setInputFiles('C:/Users/sss/Videos/Captures/smile.jpg');
    await page.waitForSelector('.ant-upload-list-item-name[title="smile.jpg"]', {timeout: 4000});
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask5 = await page.evaluate(() => {return localStorage.getItem("task5");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask5);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Write a hyperlink' }).click();
    await page.getByRole('textbox', { name: 'Write a hyperlink' }).fill('https://www.php.net/');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    await page.getByRole('listitem').getByRole('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});



    // admin login call
    await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contenttableuserlogsGrid [role="row"]');
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log('Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log('Alert dismissed after 4 seconds');
    });


    const found = await page.evaluate((username) => {
    const storedModules = [
        localStorage.getItem("task1"),
        localStorage.getItem("task2"),
        localStorage.getItem("task3"),
        localStorage.getItem("task4"),
        localStorage.getItem("task5"),
    ].filter(Boolean); 

    if (!storedModules.length) return false;

    const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
    let match = false;

    rows.forEach((row, index) => {
        const cells = row.querySelectorAll('[role="gridcell"]');
        if (!cells.length) return;

        const userCell    = cells[1]?.innerText.trim();
        const detailCell  = cells[3]?.innerText.trim();
        const logTypeCell = cells[4]?.innerText.trim();
        const dateCell    = cells[5]?.innerText.trim();

        if (userCell === username && storedModules.some(task => detailCell.includes(task))) {
            const rowData = { 
                row: index, 
                user: userCell, 
                detail: detailCell, 
                logType: logTypeCell, 
                date: dateCell 
            };
            console.log("Matched Row:", rowData);
            alert("Row Found â†’ " + JSON.stringify(rowData));
            match = true;
        }
    });

    return match;
}, uName);

console.log("Found status:", found);



  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);



  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.locator('.jqx-checkbox-default').nth(4).click();
  await page.locator('.jqx-checkbox-default').nth(5).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

});
// not working file approval as on task report in grid no data 
test('quick_assign_task_module_with_media_upload_file_approval_score', async ({ page }) => {
  test.setTimeout('1200000');   
    await attachNetworkLogger(page);  
  
  await login(page);
    //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create task module with media upload
  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.getByRole('button', { name: 'Add New' }).click();
  await waitForPaceLoad(page);
  await page.getByRole('textbox', { name: 'Module Name' }).click();
  const taskname1 = await page.evaluate(() =>{
    let name = 'task_doc_upload_'  + Math.floor(Math.random() * 100000); localStorage.setItem('task1',name); return name;
  });
  await page.getByRole('textbox', { name: 'Module Name' }).fill(taskname1);
  await page.getByPlaceholder('Enter approx time(in minutes)').click();
  await page.getByPlaceholder('Enter approx time(in minutes)').fill('20');
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.locator('#documentTaskTypeLabel').click();
  await page.locator('#mediatype_select').click();
  await page.locator('#mediatype_select').selectOption('document');
  await page.locator('#isenableapproval').click();
  await page.locator('#isGradable').click();
  await page.locator('#taskMaxScore').click();
  await page.locator('#taskMaxScore').fill('30');
  await page.getByRole('button', { name: 'Save Module' }).click();
  try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… task module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ task module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=task');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const taskgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const taskFound = taskgridText.includes(taskname1);
    if (taskFound) {
        console.log(`\x1b[32mâœ… Verified: Task with media upload of ducument type "${taskname1}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Task with media upload of ducument type "${taskname1}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

  
   // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt module 
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedtask1 = await page.evaluate(() => {return localStorage.getItem("task1");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedtask1);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    const fileInput = page.locator('input[type="file"]');
    await fileInput.setInputFiles('C:/Users/sss/Videos/Captures/javanotes5.pdf');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.waitForTimeout(2000);
    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});
        

    // admin login call
    await login(page);
     await page.pause();
    // accept the uploaded file 
    await page.goto('adminTaskReporting.php');
    await waitForPaceLoad(page);
    await page.locator('#learningPlanComboBox').click();
    await page.selectOption('#learningPlanComboBox' ,{label : 'Default Learning Plan'});
    await page.locator('#moduleComboBox').click();
    const taskname = await page.evaluate(() => {return localStorage.getItem("task1");});
    console.log(taskname);
    await page.selectOption('#moduleComboBox' ,{label : taskname});
    await page.getByRole('button', { name: 'Report' }).click();
    await page.waitForTimeout(2000);
    await page.getByText('Show Report').click();
    await page.getByTitle('Approve').click();
    await page.locator('#score').click();
    await page.locator('#score').fill('35');
    await page.getByRole('button', { name: 'Approve' }).click();
    const toastLocator = page.locator('.ant-message, .toast, .ant-notification'); 
    await toastLocator.first().waitFor({ state: 'visible', timeout: 5000 });
    const toastText = (await toastLocator.innerText()).toLowerCase().trim();
    if (toastText.includes('score') && toastText.includes('greater') && toastText.includes('max')) {
        console.log("âœ… max score condition worked correct");
    } else {
        console.log("âŒ max score condition not worked");
        console.log("Toast message shown:", toastText);
    }

    await page.locator('#score').click();
    await page.locator('#score').fill('20');
    await page.getByRole('button', { name: 'Approve' }).click();
    await toastLocator.first().waitFor({ state: 'visible', timeout: 5000 });
    if (toastText.toLowerCase().includes('success')) {
        console.log("âœ… marks are alloted to user");
    } else {
        console.log("âŒ approval failed, toast message:", toastText);
    }

    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    await page.goto('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    await page.locator('.ant-card', { hasText: 'Scores' }).click();
    const popup = page.locator('.ant-modal-content');
    await popup.waitFor({ state: 'visible', timeout: 5000 });
    console.log("âœ… Popup opened after clicking Scores card");
    const task_name = await page.evaluate( ()=> localStorage.getItem('task1'));
    const moduleRow = popup.locator('div.flex.justify-between', { hasText: task_name });
    await moduleRow.waitFor({ state: 'visible', timeout: 3000 });
    const score = await moduleRow.locator('div.font-bold').innerText();
    if (score.trim() === '20') {
        console.log("âœ… scores are allotted");
        await page.evaluate(() => alert("scores are allotted")); 
    } else {
        console.log(`âŒ Module found but score is ${score}, expected 30`);
    }


    //  admin login call 
     await login(page);


    // check user logs that user finished  module or not 
    await page.goto('adminShowUserLogs.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contenttableuserlogsGrid [role="row"]');
    const uName = await page.evaluate(() => localStorage.getItem("username"));
    page.on('dialog', async dialog => {
    console.log('Alert shown:', dialog.message());
    await new Promise(resolve => setTimeout(resolve, 4000));
    await dialog.dismiss();
    console.log('Alert dismissed after 4 seconds');
    });


    const found = await page.evaluate((username) => {
        const storedModule = localStorage.getItem("task1");
        if (!storedModule) return false;

        const rows = document.querySelectorAll('#contenttableuserlogsGrid [role="row"]');
        let match = false;

        rows.forEach((row, index) => {
            const cells = row.querySelectorAll('[role="gridcell"]');
            if (!cells.length) return;

            const userCell    = cells[1]?.innerText.trim();
            const detailCell  = cells[3]?.innerText.trim();
            const logTypeCell = cells[4]?.innerText.trim();
            const dateCell    = cells[5]?.innerText.trim();

            if (userCell === username && detailCell.includes(storedModule)) {
                const rowData = { row: index, user: userCell, detail: detailCell, logType: logTypeCell, date: dateCell };
                console.log("Matched Row:", rowData);
                alert("Row Found â†’ " + JSON.stringify(rowData));
                match = true;
            }
        });

        return match;
    }, uName);

    console.log("Found status:", found);



  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=task');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  // await page.locator('.jqx-checkbox-default').nth(2).click();
  // await page.locator('.jqx-checkbox-default').nth(3).click();
  // await page.locator('.jqx-checkbox-default').nth(4).click();
  // await page.locator('.jqx-checkbox-default').nth(5).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


});

// quick assign with event type module 
test('quick_assign_module_with_event_manadatory', async ({ page }) => {
   test.setTimeout('1200000'); 
    await attachNetworkLogger(page);  

   await login(page);
   //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create mandatory event
    await page.goto('manageCT.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.locator('#title').click();
    const eventname1 = await page.evaluate(() => {
      let name = 'mandatory_eve_' + Math.floor(Math.random() * 100000); localStorage.setItem('eve1', name); return name;
    });
    await page.locator('#title').fill(eventname1);
    await page.locator('#eventtype').selectOption('classroom');
    const optionValue = await page.locator('#facilitator option', { hasText: 'Admin' }).getAttribute('value');
    await page.locator('#facilitator').selectOption(optionValue);
    await page.getByText('Mandatory').click();
    await page.locator('#meta-tabContent-event label').filter({ hasText: 'Feedback' }).locator('label').click();
    await page.waitForTimeout(1000);
    await page.locator('.simple-switch-outter.unchecked').first().click();
    await page.waitForTimeout(1000);
    await page.locator('label').filter({ hasText: 'Set Marks' }).locator('label').click();
    await page.locator('#eventGamification span').click();
    await page.locator('#pointsOnAttendance').click();
    await page.locator('#pointsOnAttendance').fill('50');
    await page.locator('#meta-tabContent-event div').filter({ hasText: 'Quick Assign Bypass learning' }).locator('label').nth(1).click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.locator('#eventsaveBtn').click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… event module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ event module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#eventsaveBtn').waitFor({state:'hidden'});
    await page.goto('manageCT.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageEventsGrid');
    const eventgridText = await page.locator('#contentmanageEventsGrid').innerText();
    const eventFound = eventgridText.includes(eventname1);
    if (eventFound) {
        console.log(`\x1b[32mâœ… Verified: Event "${eventname1}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Event "${eventname1}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    
    // check event module assigned to user 
    // await page.goto('userui/modules/');
    // await page.waitForLoadState('networkidle');
    
    // await page.getByRole('textbox', { name: 'Search Module' }).click();
    // const eve_name = await page.evaluate(() => {return localStorage.getItem("eve1");});
    // await page.getByRole('textbox', { name: 'Search Module' }).fill(eve_name);
    // await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    // await page.waitForTimeout(2000);
    // const card = page.locator('.ant-card', { hasText: eve_name });
    // if (await card.count() > 0) {
    //   const status = card.locator(':text("approved")');
    //   if (await status.count() > 0) {
    //     console.log("âœ… quick assign mandatory event is allotted successfully to user");
    //     await page.evaluate(() => alert("quick assign mandatory event is allotted successfully to user"));
    //   } else {
    //     console.log("âš ï¸ Card found but not approved yet");
    //   }
    // } else {
    //   console.log("âŒ Card  not found");
    // }


    // check event alloted in grid view
    await page.goto('userui/modules/'); 
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const eve_name = await page.evaluate(() => localStorage.getItem("eve1"));
    await page.getByRole('textbox', { name: 'Search Module' }).fill(eve_name);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    const row = page.locator('tr', { hasText: eve_name });
    if (await row.count() > 0) {
      const status = row.locator('td', { hasText: 'Approved' });
      if (await status.count() > 0) {
        console.log(`\x1b[32m%s\x1b[0m`,"âœ… quick assign mandatory event is allotted successfully to user");
        await page.evaluate(() => alert("quick assign mandatory event is allotted successfully to user"));
      } else {
        console.log(`\x1b[33m%s\x1b[0m`,"âš ï¸ Module found but not approved yet");
      }

    } else {
      console.log(`\x1b[31m%s\x1b[0m`,"âŒ Module not found in grid view");
    }
    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});



    // admin login call 
    await login(page);

    // mark attendence and scores event
    await page.goto('manageCT.php');
    await waitForPaceLoad(page);
    const evename = await page.evaluate(() => {return localStorage.getItem("eve1");});
    const targetRow = page.locator('#contenttablemanageEventsGrid [role="row"]',{ has: page.locator('div.activeTitleClass', { hasText: evename }) });
    await targetRow.locator('a.eventNominatonLnk i.fa-info').click();
    await page.getByRole('link', { name: 'Set Marks' }).click();
    await page.locator('#attendanceStatus').selectOption('present');
    await page.getByRole('textbox', { name: 'Marks' }).click();
    await page.getByRole('textbox', { name: 'Marks' }).fill('20');
    await page.getByRole('button', { name: 'Save' }).click();
    await page.getByRole('button', { name: 'Save' }).waitFor({state:'hidden'});
    console.log("marks and score assigned");



     // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // check marks alloted 
    await page.goto('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    await page.locator('.ant-card', { hasText: 'Scores' }).click();
    const popup = page.locator('.ant-modal-content');
    await popup.waitFor({ state: 'visible', timeout: 5000 });
    console.log("âœ… Popup opened after clicking Scores card");
    const event_name = await page.evaluate( ()=> {return localStorage.getItem('eve1');});
    const moduleRow = popup.locator('div.flex.justify-between', { hasText: event_name });
    await moduleRow.waitFor({ state: 'visible', timeout: 10000 });
    const score = await moduleRow.locator('div.font-bold').innerText();
    if (score.trim() === '20') {
        console.log("âœ… scores are allotted");
        await page.evaluate(() => alert("scores are allotted")); 
    } else {
        console.log(`âŒ Module found but score is ${score}, expected 30`);
    }


    //  admin login call 
     await login(page);
     

  // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


  await page.goto('manageCT.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);

});
test('quick_assign_module_with_event_self_nomination', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create self nomination event
    await page.goto('manageCT.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.locator('#title').click();
    const eventname1 = await page.evaluate(() => {
      let name = 'self_nominative_eve_' + Math.floor(Math.random() * 100000); localStorage.setItem('eve2', name); return name;
    });
    await page.locator('#title').fill(eventname1);

    const now = new Date();
    now.setMinutes(now.getMinutes() + 10);
    const formattedTime = now.toLocaleTimeString('en-US', {
      hour: '2-digit',
      minute: '2-digit',
      hour12: true
    }).toLowerCase();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const dd = String(now.getDate()).padStart(2, '0');
    const hh = String(now.getHours()).padStart(2, '0');
    const min = String(now.getMinutes()).padStart(2, '0');
    const ss = String(now.getSeconds()).padStart(2, '0');
    const formattedDateTime = `${yyyy}-${mm}-${dd} ${hh}:${min}:${ss}`;
    await page.locator('#startDate').evaluate((el, value) => el.value = value, formattedDateTime);
    await page.locator('#fromTime').evaluate((el, text) => el.textContent = text, formattedTime);

    await page.locator('#eventtype').selectOption('classroom');
    const optionValue = await page.locator('#facilitator option', { hasText: 'Admin' }).getAttribute('value');
    await page.locator('#facilitator').selectOption(optionValue);
    await page.getByText('Self-nomination').click();
    await page.locator('#meta-tabContent-event label').filter({ hasText: 'Feedback' }).locator('label').click();
    await page.waitForTimeout(1000);
    await page.locator('.simple-switch-outter.unchecked').first().click();
    await page.waitForTimeout(1000);
    await page.locator('label').filter({ hasText: 'Set Marks' }).locator('label').click();
    await page.locator('#eventGamification span').click();
    await page.locator('#pointsOnAttendance').click();
    await page.locator('#pointsOnAttendance').fill('50');
    await page.locator('#meta-tabContent-event div').filter({ hasText: 'Quick Assign Bypass learning' }).locator('label').nth(1).click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.locator('#eventsaveBtn').click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… event module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ event module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#eventsaveBtn').waitFor({state:'hidden'});
    await page.goto('manageCT.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageEventsGrid');
    const eventgridText = await page.locator('#contentmanageEventsGrid').innerText();
    const eventFound = eventgridText.includes(eventname1);
    if (eventFound) {
        console.log(`\x1b[32mâœ… Verified: Event "${eventname1}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Event "${eventname1}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    const card = page.locator('.ant-card', { hasText: 'Upcoming Events' });
    const eve_name = await page.evaluate(() => {return localStorage.getItem("eve2");});
    const taargetRow = card.locator('tr', { hasText: eve_name });
    await taargetRow.getByRole('button', { name: 'Nominate' }).click();
    await page.getByRole('button', { name: 'Yes' }).click();
    console.log("user nominated for self nominative event.")
    await page.getByRole('listitem').getByRole('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // approve nominated user , mark attendence and allot marks.
    await page.goto('manageCT.php');
    await waitForPaceLoad(page);
    const evename = await page.evaluate(() => {return localStorage.getItem("eve2");});
    const targetRow = page.locator('#contenttablemanageEventsGrid [role="row"]',{ has: page.locator('div.activeTitleClass', { hasText: evename }) });
    await targetRow.locator('a.eventNominatonLnk i.fa-info').click();
    await page.getByRole('link', { name: 'Views' }).click();
    await page.locator('#status').selectOption('approve');
    await page.getByRole('button', { name: 'Save' }).click();
    await page.getByRole('button', { name: 'Save' }).waitFor({state:'hidden'});
    await page.getByRole('link', { name: 'Set Marks' }).click();
    await page.locator('#attendanceStatus').selectOption('present');
    await page.getByRole('textbox', { name: 'Marks' }).click();
    await page.getByRole('textbox', { name: 'Marks' }).fill('20');
    await page.getByRole('button', { name: 'Save' }).click();
    await page.getByRole('button', { name: 'Save' }).waitFor({state:'hidden'});


    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // // check event module assigned to user 
    // await page.goto('userui/modules/');
    // await page.waitForLoadState('networkidle');
    // await page.getByRole('textbox', { name: 'Search Module' }).click();
    // await page.getByRole('textbox', { name: 'Search Module' }).fill(eve_name);
    // await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    // await page.waitForTimeout(2000);
    // if (await card.count() > 0) {
    //   const status = card.locator(':text("approved")');
    //   if (await status.count() > 0) {
    //     console.log("âœ… quick assign mandatory event is allotted successfully to user");
    //     await page.evaluate(() => alert("quick assign mandatory event is allotted successfully to user"));
    //   } else {
    //     console.log("âš ï¸ Card found but not approved yet");
    //   }
    // } else {
    //   console.log("âŒ Card  not found");
    // }
    // await page.waitForTimeout(3000);



     // check event alloted in grid view
    await page.goto('userui/modules/'); 
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    await page.getByRole('textbox', { name: 'Search Module' }).fill(eve_name);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.waitForTimeout(2000);
    const row = page.locator('tr', { hasText: eve_name });
    if (await row.count() > 0) {
      const status = row.locator('td', { hasText: 'Approved' });
      if (await status.count() > 0) {
        console.log(`\x1b[32m%s\x1b[0m`,"âœ… quick assign mandatory event is allotted successfully to user");
        await page.evaluate(() => alert("quick assign mandatory event is allotted successfully to user"));
      } else {
        console.log(`\x1b[33m%s\x1b[0m`,"âš ï¸ Module found but not approved yet");
      }

    } else {
      console.log(`\x1b[31m%s\x1b[0m`,"âŒ Module not found in grid view");
    }




    // check marks alloted 
    await page.goto('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    await page.locator('.ant-card', { hasText: 'Scores' }).click();
    const popup = page.locator('.ant-modal-content');
    await popup.waitFor({ state: 'visible', timeout: 5000 });
    console.log("âœ… Popup opened after clicking Scores card");
    const event_name = await page.evaluate( ()=> {return localStorage.getItem('eve2');});
    const moduleRow = popup.locator('div.flex.justify-between', { hasText: event_name });
    await moduleRow.waitFor({ state: 'visible', timeout: 10000 });
    const score = await moduleRow.locator('div.font-bold').innerText();
    if (score.trim() === '20') {
        console.log("âœ… scores are allotted");
        await page.evaluate(() => alert("scores are allotted")); 
    } else {
        console.log(`âŒ Module found but score is ${score}, expected 30`);
    }
    await page.getByRole('button', { name: 'Close' }).click();
    await page.getByRole('listitem').getByRole('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    //  admin login call 
     await login(page);
     

    // delete user,module
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await tostr_detector(page);


    await page.goto('manageCT.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#deleteContainer');
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});

// gamification scenarios

// leaderboard scenarios
test('leaderboard_with_all_in_lp_profile_module_measured_by_points', async ({ page }) => {
  test.setTimeout('1200000');   
    await attachNetworkLogger(page);  

  await login(page);

    //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText1 = await page.locator('#contentlearnersGrid').innerText();
    const user2Found1 = user2gridText1.includes(username2);
    if (user2Found1) {
        console.log(`\x1b[32mâœ… Verified: User "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({ state: 'visible' });
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({ state: 'hidden' });
    const gamificationSection = page.locator('h6:has-text("Gamification Configuration")').locator('..');
    await gamificationSection.locator('button.addpointsbtn[title="Add Points"]').click();
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).click();
    await page.locator('input[name="points[]"]').click();
    await page.locator('input[name="points[]"]').fill('50');
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

      
   // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });;
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({ state: 'visible' });;
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.locator('#addPointsBtn').click();
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).click();
    await page.locator('input[name="points[]"]').click();
    await page.locator('input[name="points[]"]').fill('50');
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({ state: 'visible' });
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
   try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.user').click();
    await page.locator('#leaderBoardType').selectOption('Points');
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state : 'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state : 'hidden'});


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    await page.waitForLoadState('networkidle');
    // await page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg').waitFor({state : 'visible'});
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const points = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Points: ${points}, Position: ${position} \x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log( `\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state : 'hidden'});


    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const points = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m  User: ${username}, Points: ${points}, Position: ${position} \x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();

    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });

    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const points = (await row.locator('td').nth(3).innerText()).trim();

    console.log(`User: ${username}, Points: ${points}, Position: ${position}`);

    if (position === "1") {
        rank1Users.push({ username, points });
    }
    }

    if (rank1Users.length > 0) {
    console.log(`\x1b[32m%s\x1b[0m`,"ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Points: ${u.points}`);
    });
    } else {
    console.log(`\x1b[33m%s\x1b[0m`, "No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});



  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


 
});
test('leaderboard_with_all_in_lp_profile_module_measured_by_scores', async ({ page }) => {
  test.setTimeout('1200000');   
    await attachNetworkLogger(page);  

  await login(page);
    //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText1 = await page.locator('#contentlearnersGrid').innerText();
    const user2Found1 = user2gridText1.includes(username2);
    if (user2Found1) {
        console.log(`\x1b[32mâœ… Verified: User2 "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User2 "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({ state: 'hidden' });
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


     // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });;
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
   try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.user').click();
    await page.locator('#leaderBoardType').selectOption('Score');
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Scores = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m  User: ${username}, Scores: ${Scores}, Position: ${position} \x1b[0m`);
    }

    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const points = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m  User: ${username}, Points: ${points}, Position: ${position} \x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });

    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const Score = (await row.locator('td').nth(3).innerText()).trim();

    console.log(`User: ${username}, Scores: ${Score}, Position: ${position}`);

    if (position === "1") {
        rank1Users.push({ username, Score });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Scores: ${u.Score}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});



  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


});
test.only('leaderboard_with_all_in_lp_profile_selected_module_measured_by_scores', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  
  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText1 = await page.locator('#contentlearnersGrid').innerText();
    const user2Found1 = user2gridText1.includes(username2);
    if (user2Found1) {
        console.log(`\x1b[32mâœ… Verified: User2 "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User2 "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);


    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



     
     // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });;
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.user').click();
    await page.waitForSelector('#modulesDD_chosen a', { state: 'visible' });
    await page.locator('#modulesDD_chosen a').click();
    await page.locator('#modulesDD_chosen').getByRole('textbox').click();
    const storedquiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    await page.locator('#modulesDD_chosen').getByRole('textbox').fill(storedquiz);
    await page.locator('#modulesDD_chosen').getByText(storedquiz).click();
    await page.locator('#leaderBoardType').selectOption('Score');
    await page.click('#saveBtn');
   try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);

    
    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');



    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Scores = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Scores: ${Scores}, Position: ${position} \x1b[0m`);
    }

    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');



    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Score = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Score: ${Score}, Position: ${position} \x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });

    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const Score = (await row.locator('td').nth(3).innerText()).trim();

    console.log(`User: ${username}, Scores: ${Score}, Position: ${position}`);

    if (position === "1") {
        rank1Users.push({ username, Score });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Scores: ${u.Score}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});



  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


});
test('leaderboard_with_all_in_lp_module_selected_profile_measured_by_scores', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText1 = await page.locator('#contentlearnersGrid').innerText();
    const user2Found1 = user2gridText1.includes(username2);
    if (user2Found1) {
        console.log(`\x1b[32mâœ… Verified: User "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
     await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);

    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
      let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


     // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });;
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.user').click();
    await page.waitForSelector('#profilesDD_chosen a', { state: 'visible' });
    await page.locator('#profilesDD_chosen a').click();
    await page.locator('#profilesDD_chosen').getByRole('textbox').click();
    const storedprofile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.locator('#profilesDD_chosen').getByRole('textbox').fill(storedprofile);
    await page.locator('#profilesDD_chosen').getByText(storedprofile).click();
    await page.locator('#leaderBoardType').selectOption('Score');
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);

    
    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Scores = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`User: ${username}, Scores: ${Scores}, Position: ${position}`);
    }

    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');



    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Score = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`User: ${username}, Score: ${Score}, Position: ${position}`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const Score = (await row.locator('td').nth(3).innerText()).trim();

    console.log(`User: ${username}, Scores: ${Score}, Position: ${position}`);

    if (position === "1") {
        rank1Users.push({ username, Score });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Scores: ${u.Score}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


});
test('leaderboard_with_all_in_profile_module_selected_lp_measured_by_scores', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText1 = await page.locator('#contentlearnersGrid').innerText();
    const user2Found1 = user2gridText1.includes(username2);
    if (user2Found1) {
        console.log(`\x1b[32mâœ… Verified: User "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);

    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

     await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });;
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.user').click();
    await page.waitForSelector('#learningPlanDD_chosen a', { state: 'visible' });
    await page.locator('#learningPlanDD_chosen a').click();
    await page.locator('#learningPlanDD_chosen').getByRole('textbox').click();
    const storedlp = await page.evaluate(() => localStorage.getItem("LP1"));
    await page.locator('#learningPlanDD_chosen').getByRole('textbox').fill(storedlp);
    await page.locator('#learningPlanDD_chosen').getByText(storedlp).click();
    await page.locator('#leaderBoardType').selectOption('Score');
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);

    
    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Scores = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Scores: ${Scores}, Position: ${position}\x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');;


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Score = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Score: ${Score}, Position: ${position} \x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    await page.waitForTimeout(3000);
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });

    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const Score = (await row.locator('td').nth(3).innerText()).trim();

    console.log(`User: ${username}, Scores: ${Score}, Position: ${position}`);

    if (position === "1") {
        rank1Users.push({ username, Score });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Scores: ${u.Score}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


});
test('leaderboard_with_selected_profile_module_lp_measured_by_scores', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    await page.goto('manageLearners.php');
    await page.waitForSelector('#contentlearnersGrid .jqx-grid-content .jqx-grid-cell', { state: 'visible' });
    await page.waitForTimeout(3000);
    await page.getByRole('button', { name: 'Add New' }).click();
    await page.waitForTimeout(4000);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
    const userFound1 = usergridText1.includes(username2);
    if (userFound1) {
        console.log(`\x1b[32mâœ… Verified: User "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#setProfileBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);

    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

      // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});;
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.user').click();
    await page.locator('#profilesDD_chosen a').click();
    await waitForPaceLoad(page);
    await page.locator('#profilesDD_chosen').getByRole('textbox').click();
    const storedprofile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.locator('#profilesDD_chosen').getByRole('textbox').fill(storedprofile);
    await page.locator(`#profilesDD_chosen .chosen-results li:has-text("${storedprofile}")`).waitFor({state:'visible'});
    await page.locator(`#profilesDD_chosen .chosen-results li:has-text("${storedprofile}")`).click();
    await waitForPaceLoad(page);
    await page.locator('#learningPlanDD_chosen a').click();
    await waitForPaceLoad(page);
    await page.locator('#learningPlanDD_chosen').getByRole('textbox').click();
    const storedlp = await page.evaluate(() => localStorage.getItem("LP1"));
    await page.locator('#learningPlanDD_chosen').getByRole('textbox').fill(storedlp);
    await page.locator(`#learningPlanDD_chosen .chosen-results li:has-text("${storedlp}")`).waitFor({state:'visible'});
    await page.locator(`#learningPlanDD_chosen .chosen-results li:has-text("${storedlp}")`).click();
    await waitForPaceLoad(page);
    await page.locator('#modulesDD_chosen a').click();
    await waitForPaceLoad(page);
    await page.locator('#modulesDD_chosen').getByRole('textbox').click();
    const storedquiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    await page.locator('#modulesDD_chosen').getByRole('textbox').fill(storedquiz);
    await page.locator(`#modulesDD_chosen .chosen-results li:has-text("${storedquiz}")`).waitFor({state:'visible'});
    await page.locator(`#modulesDD_chosen .chosen-results li:has-text("${storedquiz}")`).click();
    await waitForPaceLoad(page);
    await page.locator('#leaderBoardType').selectOption('Score');
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);

    
    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});;
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Scores = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m  User: ${username}, Scores: ${Scores}, Position: ${position} \x1b[0m`);
    }

    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');;


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});;
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const score = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, score: ${score}, Position: ${position} \x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });

    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const Score = (await row.locator('td').nth(3).innerText()).trim();

    console.log( `\x1b[33m User: ${username}, Scores: ${Score}, Position: ${position} \x1b[0m`);

    if (position === "1") {
        rank1Users.push({ username, Score });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Scores: ${u.Score}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);



  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


});
test('leaderboard_with_all_in_lp_profile_module_measured_by_points_group_by_profile', async ({ page }) => {
  test.setTimeout('1200000');  
    await attachNetworkLogger(page);  

  await login(page);
    //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText = await page.locator('#contentlearnersGrid').innerText();
    const user2Found = user2gridText.includes(username2);
    if (user2Found) {
        console.log(`\x1b[32mâœ… Verified: User "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#setProfileBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);

    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    const gamificationSection = page.locator('h6:has-text("Gamification Configuration")').locator('..');
    await gamificationSection.locator('button.addpointsbtn[title="Add Points"]').click();
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).click();
    await page.locator('input[name="points[]"]').click();
    await page.locator('input[name="points[]"]').fill('50');
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


      // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.locator('#addPointsBtn').click();
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).click();
    await page.locator('input[name="points[]"]').click();
    await page.locator('input[name="points[]"]').fill('50');
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.learningProfile').click();
    await page.locator('#leaderBoardType').selectOption('Points');
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const points = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Points: ${points}, Position: ${position} \x1b[0m`);
    }

    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');




    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'OK' }).click();
    await page.waitForLoadState('networkidle');



    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const points = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Points: ${points}, Position: ${position} \x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });

    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const points = (await row.locator('td').nth(3).innerText()).trim();

    console.log(`\x1b[33m User: ${username}, Points: ${points}, Position: ${position} \x1b[0m`);

    if (position === "1") {
        rank1Users.push({ username, points });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holder:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Points: ${u.points}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});



  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});
test('leaderboard_with_all_in_lp_profile_module_measured_by_scores_group_by_profile', async ({ page }) => {
  test.setTimeout('1200000');   
    await attachNetworkLogger(page);  

  await login(page);
    //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText = await page.locator('#contentlearnersGrid').innerText();
    const user2Found = user2gridText.includes(username2);
    if (user2Found) {
        console.log(`\x1b[32mâœ… Verified: User "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#setProfileBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);


    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


      
      // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.learningProfile').click();
    await page.locator('#leaderBoardType').selectOption('Score');
    await page.click('#saveBtn');
   try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Scores = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Scores: ${Scores}, Position: ${position}\x1b[0m`);
    }

    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const points = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Points: ${points}, Position: ${position} \x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });

    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const Score = (await row.locator('td').nth(3).innerText()).trim();
 
    console.log(`\x1b[33m User: ${username}, Scores: ${Score}, Position: ${position} \x1b[0m`);

    if (position === "1") {
        rank1Users.push({ username, Score });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Scores: ${u.Score}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});



  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});
test('leaderboard_with_all_in_lp_profile_selected_module_measured_by_scores_group_by_profile', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }




    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText = await page.locator('#contentlearnersGrid').innerText();
    const user2Found = user2gridText.includes(username2);
    if (user2Found) {
        console.log(`\x1b[32mâœ… Verified: User "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#setProfileBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);



    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



      // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.learningProfile').click();
    await page.locator('#modulesDD_chosen a').click();
    await waitForPaceLoad(page);
    await page.locator('#modulesDD_chosen').getByRole('textbox').click();
    const storedquiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    await page.locator('#modulesDD_chosen').getByRole('textbox').fill(storedquiz);
    await page.locator('#modulesDD_chosen').getByText(storedquiz).click();
    await page.locator('#leaderBoardType').selectOption('Score');
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);

    
    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Scores = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Scores: ${Scores}, Position: ${position} \x1b[0m`);
    }

    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Score = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Score: ${Score}, Position: ${position} \x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });

    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const Score = (await row.locator('td').nth(3).innerText()).trim();

    console.log(`\x1b[33m User: ${username}, Scores: ${Score}, Position: ${position}\x1b[0m`);

    if (position === "1") {
        rank1Users.push({ username, Score });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Scores: ${u.Score}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});



  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});
test('leaderboard_with_all_in_lp_module_selected_profile_measured_by_scores_group_by_profile', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText = await page.locator('#contentlearnersGrid').innerText();
    const user2Found = user2gridText.includes(username2);
    if (user2Found) {
        console.log(`\x1b[32mâœ… Verified: User "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#setProfileBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);



    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
   await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


     
      // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor;
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.learningProfile').click();
    await page.locator('#profilesDD_chosen a').click();
    await waitForPaceLoad(page);
    await page.locator('#profilesDD_chosen').getByRole('textbox').click();
    const storedprofile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.locator('#profilesDD_chosen').getByRole('textbox').fill(storedprofile);
    await page.locator('#profilesDD_chosen').getByText(storedprofile).click();
    await waitForPaceLoad(page);
    await page.locator('#leaderBoardType').selectOption('Score');
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);

    
    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Scores = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`User: ${username}, Scores: ${Scores}, Position: ${position}`);
    }

    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Score = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`User: ${username}, Score: ${Score}, Position: ${position}`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });

    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const Score = (await row.locator('td').nth(3).innerText()).trim();

    console.log(`User: ${username}, Scores: ${Score}, Position: ${position}`);

    if (position === "1") {
        rank1Users.push({ username, Score });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Scores: ${u.Score}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});
test('leaderboard_with_all_in_profile_module_selected_lp_measured_by_scores_group_by_profile', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText = await page.locator('#contentlearnersGrid').innerText();
    const user2Found = user2gridText.includes(username2);
    if (user2Found) {
        console.log(`\x1b[32mâœ… Verified: User "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#setProfileBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);

    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



      // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.learningProfile').click();
    await page.locator('#learningPlanDD_chosen a').click();
    await waitForPaceLoad(page);
    await page.locator('#learningPlanDD_chosen').getByRole('textbox').click();
    const storedlp = await page.evaluate(() => localStorage.getItem("LP1"));
    await page.locator('#learningPlanDD_chosen').getByRole('textbox').fill(storedlp);
    await page.locator('#learningPlanDD_chosen').getByText(storedlp).click();
    await waitForPaceLoad(page);
    await page.locator('#leaderBoardType').selectOption('Score');
    await page.click('#saveBtn');
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);

    
    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Scores = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`User: ${username}, Scores: ${Scores}, Position: ${position}`);
    }

    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});

     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
     await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);;
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Score = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`User: ${username}, Score: ${Score}, Position: ${position}`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});

    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const Score = (await row.locator('td').nth(3).innerText()).trim();

    console.log(`User: ${username}, Scores: ${Score}, Position: ${position}`);

    if (position === "1") {
        rank1Users.push({ username, Score });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Scores: ${u.Score}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


});
test('leaderboard_with_selected_profile_module_lp_measured_by_scores_group_by_profile', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username2 = await page.evaluate(() => {
      let name = 'playwright_user_2_' + Math.floor(Math.random() * 100000); localStorage.setItem('username2', name); return name;
    });
    await page.fill('#username', username2);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username2);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const user2gridText = await page.locator('#contentlearnersGrid').innerText();
    const user2Found = user2gridText.includes(username2);
    if (user2Found) {
        console.log(`\x1b[32mâœ… Verified: User "${username2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.locator('.jqx-checkbox-default').nth(2).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#setProfileBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);


    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.getByRole('button', { name: 'Save Lesson' }).waitFor({state:'hidden'});
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



      // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const quizgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create leaderboard
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const ldbname = await page.evaluate(() => {
      let name = 'leaderboard_playwright_' + Math.floor(Math.random() * 100000); localStorage.setItem('LDB1', name); return name;
    });
    await page.fill('#name',ldbname);
    await page.click('#description');
    await page.fill('#description','this leaderboard is created through playwright for leaderboard scenario testing.');
    await page.locator('a.learningProfile').click();
    await page.locator('#profilesDD_chosen a').click();
    await waitForPaceLoad(page);
    await page.locator('#profilesDD_chosen').getByRole('textbox').click();
    const storedprofile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.locator('#profilesDD_chosen').getByRole('textbox').fill(storedprofile);
    await page.locator(`#profilesDD_chosen .chosen-results li:has-text("${storedprofile}")`).waitFor({state:'visible'});
    await page.locator(`#profilesDD_chosen .chosen-results li:has-text("${storedprofile}")`).click();
    await waitForPaceLoad(page);
    await page.locator('#learningPlanDD_chosen a').click();
    await waitForPaceLoad(page);
    await page.locator('#learningPlanDD_chosen').getByRole('textbox').click();
    const storedlp = await page.evaluate(() => localStorage.getItem("LP1"));
    await page.locator('#learningPlanDD_chosen').getByRole('textbox').fill(storedlp);
    await page.locator(`#learningPlanDD_chosen .chosen-results li:has-text("${storedlp}")`).waitFor({state:'visible'});
    await page.locator(`#learningPlanDD_chosen .chosen-results li:has-text("${storedlp}")`).click();
    await waitForPaceLoad(page);
    await page.locator('#modulesDD_chosen a').click();
    await waitForPaceLoad(page);
    await page.locator('#modulesDD_chosen').getByRole('textbox').click();
    const storedquiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    await page.locator('#modulesDD_chosen').getByRole('textbox').fill(storedquiz);
    await page.locator(`#modulesDD_chosen .chosen-results li:has-text("${storedquiz}")`).waitFor({state:'visible'});
    await page.locator(`#modulesDD_chosen .chosen-results li:has-text("${storedquiz}")`).click();
    await waitForPaceLoad(page);
    await page.locator('#leaderBoardType').selectOption('Score');
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… leaderboard created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ leaderboard is not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentleaderboardGrid');
    const leaderboardgridText = await page.locator('#contentleaderboardGrid').innerText();
    const leaderboardFound = leaderboardgridText.includes(ldbname);
    if (leaderboardFound) {
        console.log(`\x1b[32mâœ… Verified: LeaderBoard "${ldbname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LeaderBoard "${ldbname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }




    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);

    
    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    const storedldb = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    console.log('leaderboard name' ,storedldb);
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    const targetCard = page.locator('.leaderboard-card', {
        has: page.locator('h5', { hasText: storedldb })
    });
    await targetCard.getByRole('button', { name: 'View' }).click();
    const rows = page.locator('div.flex.flex-row.justify-between.items-center.rounded-xl.p-4.shadow-lg');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const Scores = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, Scores: ${Scores}, Position: ${position} \x1b[0m`);
    }

    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


     // login user 2
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName2 = await page.evaluate(() => {return localStorage.getItem("username2");});
    console.log(userName2);
    await page.fill('#basic_username', userName2);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');



    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');



    const targetCard4 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard4.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // check leaderboard
    await page.goto('userui/leaderboard/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).click();
    await page.getByRole('textbox', { name: 'Search Leaderboards' }).fill(storedldb);
    await targetCard.getByRole('button', { name: 'View' }).click();
    await page.waitForTimeout(4000);
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
        const row = rows.nth(i);
        const username = (await row.locator('div >> nth=0').innerText()).trim();
        const score = (await row.locator('.text-sm').innerText()).trim();
        const position = (await row.locator('.font-color-1.font-semibold').innerText()).trim();
        console.log(`\x1b[34m User: ${username}, score: ${score}, Position: ${position} \x1b[0m`);
    }
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
    await login(page);

    // check leaderboard data
    await page.goto('ManageLeaderBoard.php');
    await waitForPaceLoad(page);
    const storedleaderboard = await page.evaluate(() => {return localStorage.getItem("LDB1");});
    await page.locator('div[role="row"]', { hasText: storedleaderboard }).locator('.showLeaderboardLink').click();
    const rows1 = page.locator('table tbody tr');
    await rows1.first().waitFor({ state: 'visible', timeout: 4000 });

    const rowCounts = await rows1.count();

    let rank1Users = [];

    for (let i = 0; i < rowCounts; i++) {
    const row = rows1.nth(i);

    const username = (await row.locator('td').nth(1).innerText()).trim();
    const position = (await row.locator('td').nth(2).innerText()).trim();
    const Score = (await row.locator('td').nth(3).innerText()).trim();

    console.log(`\x1b[33m User: ${username}, Scores: ${Score}, Position: ${position} \x1b[0m`);

    if (position === "1") {
        rank1Users.push({ username, Score });
    }
    }

    if (rank1Users.length > 0) {
    console.log("ðŸ† Rank 1 holders:");
    rank1Users.forEach(u => {
        console.log(`User: ${u.username}, Scores: ${u.Score}`);
    });
    } else {
    console.log("No Rank 1 user found.");
    }


    // delete user,module
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('ManageLeaderBoard.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});

// badges scenarios
test('badge_scenario_1_learningplan_completion_based', async ({ page }) => {
 test.setTimeout('1200000');
    await attachNetworkLogger(page);  

 await login(page);
// create user 
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    

// create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#setProfileBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);


     // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpBadgeQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

   
    // create lp for badge sceanrio1
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName= 'lp_Badge_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpbadgeQuizName);
    await page.fill('#name', lpbadgeQuizName);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpBadgeQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpbadgegridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpbadgeFound = lpbadgegridText.includes(lpbadgeQuizName);
    if (lpbadgeFound) {
        console.log(`\x1b[32mâœ… Verified: Learning Plan for badge "${lpbadgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Learning Plan for badge "${lpbadgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create badge based on performance of lp
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#badgeName');
    const gridbadgename = await page.evaluate(() => {
    const gridbadgename1 = 'lp_performance_badge1_' + Math.floor(Math.random() * 100000);localStorage.setItem('gridbadgename1', gridbadgename1); return gridbadgename1;
    });
    await page.fill('#badgeName', gridbadgename);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.learningPlanBadgeType');
    await page.click('#learningPlanDD_chosen .default');
    const storedlp1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('#learningPlanDD_chosen .default', storedlp1);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedlp1}")`).waitFor({state:'visible'})
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedlp1}")`);
    await page.click('.completionAllotmentType');
    await page.click('#saveBadgeBtn > .ladda-label');
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBadgeBtn').waitFor({ state: 'hidden' });
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageBadgesGrid');
    const badgegridText = await page.locator('#contentmanageBadgesGrid').innerText();
    const badgeFound = badgegridText.includes(gridbadgename);
    if (badgeFound) {
        console.log(`\x1b[32mâœ… Verified: Badge "${gridbadgename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Badge "${gridbadgename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // execute lp activation cron call
    await execute_learningplan_activation_cron(page);

    
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp for badge scenario 1
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpBadgeQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

// check badge allotment
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    await page.reload();
    await page.waitForLoadState('networkidle');
    const gridbadge = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log(`\x1b[32m%s\x1b[0m`,'grid badge from user logs: ', gridbadge);
    const assignbadge= await page.evaluate(() => {return localStorage.getItem("gridbadgename1");});
    console.log(`\x1b[32m%s\x1b[0m`,'admin assigned badge: ',assignbadge);
    if (assignbadge == gridbadge){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user on completion of learning plan. ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // admin login call
  await login(page);

  // check logs data of badge widget 
  await page.goto('manageBadgesCards.php');
    await waitForPaceLoad(page);
    await page.locator('#searchText').waitFor({state:'visible'});
    await page.click('#searchText');
    const badge1 = await page.evaluate(() => {return localStorage.getItem("gridbadgename1");});
    await page.fill('#searchText', badge1);
    await page.click('#searchBtn');
    await page.click(`.card-container:has(h5.card-title:has-text("${badge1}")) .showBadgeLogsLnk`);
    const storedUsername = await page.evaluate(() => localStorage.getItem("username")); 
    if (!storedUsername) {
      throw new Error("No username found in localStorage");
    }
    const rows = page.locator('[role="row"]');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    let found = false;
    for (let i = 0; i < rowCount; i++) {
    const row = rows.nth(i);
    const username = await row.locator('[columnindex="3"]').innerText();
    if (username.trim() === storedUsername.trim()) {
      found = true;
      const name = await row.locator('[columnindex="2"]').innerText();
      const lpName = await row.locator('[columnindex="5"]').innerText();
      const allottedOn = await row.locator('[columnindex="6"]').innerText();
      const imgSrc = await row.locator('img').getAttribute('src');
      const message = `
        Matched Username: ${username}
        Name: ${name}
        Learning Plan: ${lpName}
        Allotted On: ${allottedOn}
        Image: ${imgSrc}
      `;
       console.log( `\x1b[32m%s\x1b[0m`,'user badge allotment data report: ' , message);
      page.once('dialog', async dialog => {
        console.log('Alert text:', dialog.message());
        await page.waitForTimeout(3000); 
        await dialog.dismiss(); 
      });

      await page.evaluate((msg) => alert(msg), message);

      break;

    }
  }

  if (!found) {
    console.log(`\x1b[31m%s\x1b[0m`,"No row found for username:", storedUsername);
  }

  await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');


  // delete user,badges
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('showBadges.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});
test('badge_scenario_2_lp_performance_based_score_less_greater_equalto', async ({ page }) => {
    test.setTimeout('1200000');
    await attachNetworkLogger(page);  

    await login(page);
// create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    

// create profile
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



// assign profile to users
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#setProfileBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);

 
  // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz1 "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz1 "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName2= 'lp_Quiz_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz2", name);}, lpQuizName2);
    await page.fill('#name', lpQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const Quizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, Quizques1);
    await page.fill('#questionname ', Quizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const Quizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, Quizques2);
    await page.fill('#questionname', Quizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const Quizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, Quizques3);
    await page.fill('#questionname', Quizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const Quizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, Quizques4);
    await page.fill('#questionname', Quizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz2gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz2Found = quiz2gridText.includes(lpQuizName2);
    if (quiz2Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz2 "${lpQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz2 "${lpQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// create quiz 3
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName3= 'Badge_Quiz_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz3", name);}, badgeQuizName3);
    await page.fill('#name', badgeQuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '20');
    await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
    await page.click('#questionname');
    const ques1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques1);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'we');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'ew');
    await page.click('#quizQuestionOption2 .col-md-5');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno5 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno5.click();
    await page.click('#questionname');
    const ques2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques2);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) #Layer_1');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'dg');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'erfer');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option3').waitFor({ state: 'visible'});
    await page.click('#option3');
    await page.fill('#option3', 'erf');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option4').waitFor({ state: 'visible'})
    await page.click('#option4');
    await page.fill('#option4', 'ergfer');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab > div');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques4);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'erger');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'erger');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno6 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno6.click();
    await page.fill('#totalMarks', '10');
    await page.click('#totalMarks');
    await page.click('#questionname');
    const ques5= 'Quiz_QUE5_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques5);
    await page.click('.py-2:nth-child(4)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz3gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz3Found = quiz3gridText.includes(badgeQuizName3);
    if (quiz3Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz3 "${badgeQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz3 "${badgeQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


   
    const storedprofilename = await page.evaluate(() => {return localStorage.getItem("ProfileName");});

    // create lp1 for badge sceanrio2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName= 'lp_Badge_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpbadgeQuizName);
    await page.fill('#name', lpbadgeQuizName);
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpbadgegridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpbadgeFound = lpbadgegridText.includes(lpbadgeQuizName);
    if (lpbadgeFound) {
        console.log(`\x1b[32mâœ… Verified: Learning Plan 1for badge "${lpbadgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Learning Plan 1for badge "${lpbadgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // craete lp 2 for badge scenario2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName2= 'lp_Badge_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP2", name);}, lpbadgeQuizName2);
    await page.fill('#name', lpbadgeQuizName2);
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname2 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz2");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname2);
    await page.locator(`.select2-results__option:has-text("${storedquizname2}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname2}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpbadge2gridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpbadge2Found = lpbadge2gridText.includes(lpbadgeQuizName2);
    if (lpbadge2Found) {
        console.log(`\x1b[32mâœ… Verified: Learning Plan 2 for badge "${lpbadgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Learning Plan 2 for badge "${lpbadgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create lp 3 for bage scenario 2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName3 = 'lp_Badge_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP3", name);}, lpbadgeQuizName3);
    await page.fill('#name',lpbadgeQuizName3 );
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname3 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz3");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname3);
    await page.locator(`.select2-results__option:has-text("${storedquizname3}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname3}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({ state: 'hidden' });
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpbadge3gridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpbadge3Found = lpbadge3gridText.includes(lpbadgeQuizName3);
    if (lpbadge3Found) {
        console.log(`\x1b[32mâœ… Verified: Learning Plan 3 for badge "${lpbadgeQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Learning Plan 3 for badge "${lpbadgeQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// create badges  based on performance of lp
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#badgeName');
    const gridbadgename = await page.evaluate(() => {
    const gridbadgename1 = 'lp_performance_badge1_' + Math.floor(Math.random() * 100000);localStorage.setItem('gridbadgename1', gridbadgename1); return gridbadgename1;
    });
    await page.fill('#badgeName', gridbadgename);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.learningPlanBadgeType');
    await page.click('#learningPlanDD_chosen .default');
    const storedlp1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('#learningPlanDD_chosen .default', storedlp1);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedlp1}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedlp1}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.scoreCriteriaType');
    await page.click('.pointCriteriaGreaterThan');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '50');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename2 = await page.evaluate(() => {
      let gridbadgename2 ="lp_performance_badge2_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename2",gridbadgename2); return gridbadgename2;
    });
    await page.fill('#badgeName', grid_badgename2);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.learningPlanBadgeType');
    await page.click('#learningPlanDD_chosen .default');
    const storedlp2 = await page.evaluate(() => {return localStorage.getItem("LP2");});
    await page.fill('#learningPlanDD_chosen .default', storedlp2);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedlp2}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedlp2}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.scoreCriteriaType');
    await page.click('.pointCriteriaLessThan ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '80');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename3 = await page.evaluate(() => {
      let gridbadgename3 ="lp_performance_badge3_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename3",gridbadgename3); return gridbadgename3;
    });
    await page.fill('#badgeName', grid_badgename3);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.learningPlanBadgeType');
    await page.click('#learningPlanDD_chosen .default');
    const storedlp3 = await page.evaluate(() => {return localStorage.getItem("LP3");});
    await page.fill('#learningPlanDD_chosen .default', storedlp3);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedlp3}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedlp3}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.scoreCriteriaType');
    await page.click('.pointCriteriaEqualTo ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '100');
    await page.click('#saveBadgeBtn');
    await page.locator('#saveBadgeBtn').waitFor({state:'hidden'});

    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageBadgesGrid');
    const gridText = await page.locator('#contentmanageBadgesGrid').innerText();
    const badgesToCheck = [
      gridbadgename,
      grid_badgename2,
      grid_badgename3,
    ];
    for (const badge of badgesToCheck) {
      if (gridText.includes(badge)) {
        console.log(`\x1b[32mâœ… Verified: badge "${badge}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: badge "${badge}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }
    


    // execute lp activation cron call 
    await execute_learningplan_activation_cron(page);

    
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');



    // attempt lp 1
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_quiz1 = await page.evaluate(() => localStorage.getItem("badgeQuiz"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_quiz1 });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.reload();
    await page.waitForLoadState('networkidle');


    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('grid badge from user logs: ', gridbadge);
    const assignbadge= await page.evaluate(() => {return localStorage.getItem("gridbadgename1");});
    console.log('admin assigned badge: ',assignbadge);
    if (assignbadge == gridbadge){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  condition  based learning plan that if scores is greater than 50% in learning plan ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    // attempt lp2
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP2 = await page.evaluate(() => {return localStorage.getItem("LP2");});
    await page.fill('.ant-select-selection-search-input', storedLP2);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP2}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP2}")`);
    const stored_quiz2 = await page.evaluate(() => localStorage.getItem("badgeQuiz2"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz2 });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.reload();
    await page.waitForLoadState('networkidle');



    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge2 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user2 logs badge: ',gridbadge2);
    const assignbadge2 = await page.evaluate(() => { return localStorage.getItem("gridbadgename2"); });
    console.log('admin assigned badge 2 : ',assignbadge2);
    if (assignbadge2 == gridbadge2){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  condition  based learning plan that if scores is less than 80% in learning plan ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }


    // attempt lp 3
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP3 = await page.evaluate(() => {return localStorage.getItem("LP3");});
    await page.fill('.ant-select-selection-search-input', storedLP3);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP3}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP3}")`);
    const stored_quiz3 = await page.evaluate(() => localStorage.getItem("badgeQuiz3"));
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_quiz3 });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.reload();
    await page.waitForLoadState('networkidle');


    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge3 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user 3 logs grid badge: ', gridbadge3);
    const assignbadge3 = await page.evaluate(() => { return localStorage.getItem("gridbadgename3"); });
    console.log('admin assigned badge 3 : ',assignbadge3);
    if (assignbadge3 == gridbadge3){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  condition  based learning plan that if scores is equal to  100% in learning plan ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});

    // admin login call
  await login(page);

  // check logs data of badge widgets 
    await page.goto('manageBadgesCards.php');
    await waitForPaceLoad(page);
    await page.click('#searchText');
    const badge1 = await page.evaluate(() => {return localStorage.getItem("gridbadgename1");});
    await page.fill('#searchText', badge1);
    await page.click('#searchBtn');
    await page.click(`.card-container:has(h5.card-title:has-text("${badge1}")) .showBadgeLogsLnk`);
    const storedUsername = await page.evaluate(() => localStorage.getItem("username")); 
    if (!storedUsername) {
      throw new Error("No username found in localStorage");
    }
    const rows = page.locator('[role="row"]');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    let found = false;
    for (let i = 0; i < rowCount; i++) {
    const row = rows.nth(i);
    const username = await row.locator('[columnindex="3"]').innerText();
    if (username.trim() === storedUsername.trim()) {
      found = true;
      const name = await row.locator('[columnindex="2"]').innerText();
      const lpName = await row.locator('[columnindex="5"]').innerText();
      const allottedOn = await row.locator('[columnindex="6"]').innerText();
      const imgSrc = await row.locator('img').getAttribute('src');
      const message = `
        Matched Username: ${username}
        Name: ${name}
        Learning Plan: ${lpName}
        Allotted On: ${allottedOn}
        Image: ${imgSrc}
      `;
       console.log( 'user badge allotment data report: ' , message);
      page.once('dialog', async dialog => {
        console.log('Alert text:', dialog.message());
        await page.waitForTimeout(3000); 
        await dialog.dismiss(); 
      });

      await page.evaluate((msg) => alert(msg), message);

      break;

    }
  }

  if (!found) {
    console.log("No row found for username:", storedUsername);
  }
  await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');

    await page.click('#searchText');
    const badge2 = await page.evaluate(() => { return localStorage.getItem("gridbadgename2"); });
    await page.fill('#searchText', badge2);
    await page.click('#searchBtn');
    await page.click(`.card-container:has(h5.card-title:has-text("${badge2}")) .showBadgeLogsLnk`);
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });

      if (!storedUsername) {
        throw new Error("No username found in localStorage");
      }
      for (let i = 0; i < rowCount; i++) {
      const row = rows.nth(i);
      const username = await row.locator('[columnindex="3"]').innerText();
      if (username.trim() === storedUsername.trim()) {
        found = true;
        const name = await row.locator('[columnindex="2"]').innerText();
        const lpName = await row.locator('[columnindex="5"]').innerText();
        const allottedOn = await row.locator('[columnindex="6"]').innerText();
        const imgSrc = await row.locator('img').getAttribute('src');
        const message = `
          Matched Username: ${username}
          Name: ${name}
          Learning Plan: ${lpName}
          Allotted On: ${allottedOn}
          Image: ${imgSrc}
        `;
        console.log( 'user badge allotment data report: ' , message);
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000); 
          await dialog.dismiss(); 
        });

        await page.evaluate((msg) => alert(msg), message);

        break;

      }
    }

  if (!found) {
    console.log("No row found for username:", storedUsername);
  }

  await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');


    await page.click('#searchText');
    const badge3 = await page.evaluate(() => { return localStorage.getItem("gridbadgename3"); });
    await page.fill('#searchText', badge3);
    await page.click('#searchBtn');
    await page.click(`.card-container:has(h5.card-title:has-text("${badge3}")) .showBadgeLogsLnk`);
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });

    if (!storedUsername) {
      throw new Error("No username found in localStorage");
    }
    for (let i = 0; i < rowCount; i++) {
    const row = rows.nth(i);
    const username = await row.locator('[columnindex="3"]').innerText();
    if (username.trim() === storedUsername.trim()) {
      found = true;
      const name = await row.locator('[columnindex="2"]').innerText();
      const lpName = await row.locator('[columnindex="5"]').innerText();
      const allottedOn = await row.locator('[columnindex="6"]').innerText();
      const imgSrc = await row.locator('img').getAttribute('src');
      const message = `
        Matched Username: ${username}
        Name: ${name}
        Learning Plan: ${lpName}
        Allotted On: ${allottedOn}
        Image: ${imgSrc}
      `;
       console.log( 'user badge allotment data report: ' , message);
      page.once('dialog', async dialog => {
        console.log('Alert text:', dialog.message());
        await page.waitForTimeout(3000); 
        await dialog.dismiss(); 
      });

      await page.evaluate((msg) => alert(msg), message);

      break;

    }
  }

  if (!found) {
    console.log("No row found for username:", storedUsername);
  }

  await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');


  // delete user,badges,badge widgets
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('showBadges.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});
test('badge_scenario_3_lp_performance_based_points_less_greater_equalto', async ({ page }) => {
    test.setTimeout('1200000');
    await attachNetworkLogger(page);  

    await login(page);
// create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
   await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    

// create profile
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to users
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#setProfileBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);
 

 // create quiz 1
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName= 'Badge_Quiz_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz", name);}, badgeQuizName);
    await page.fill('#name', badgeQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques1= 'Badge_Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname ', badgeQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques2= 'Badge_Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(1)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const badgeQuizques3= 'Badge_Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques3);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno1 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno1.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques4= 'Badge_Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(badgeQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz1 "${badgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz1 "${badgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName2= 'Badge_Quiz_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz2", name);}, badgeQuizName2);
    await page.fill('#name', badgeQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('#lessonType-page-tab');
    await page.click('#questionname');
    const que1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que1);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'php');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'react');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const que2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que2);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'marketing');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'finance');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option3').waitFor({state:'visible'});
    await page.click('#option3');
    await page.fill('#option3', 'account');
    await page.click('#marks3');
    await page.fill('#marks3', '10');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const que3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que3);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const que4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz2gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz2Found = quiz2gridText.includes(badgeQuizName2);
    if (quiz2Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz2 "${badgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz2 "${badgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// create quiz 3
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName3= 'Badge_Quiz_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz3", name);}, badgeQuizName3);
    await page.fill('#name', badgeQuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '20');
    await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques1);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'we');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'ew');
    await page.click('#quizQuestionOption2 .col-md-5');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno5 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno5.click();
    await page.click('#questionname');
    const ques2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques2);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) #Layer_1');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques3);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'dg');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'erfer');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option3').waitFor({state:'visible'});
    await page.click('#option3');
    await page.fill('#option3', 'erf');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option4').waitFor({state:'visible'});
    await page.click('#option4');
    await page.fill('#option4', 'ergfer');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab > div');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques4);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'erger');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'erger');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno6 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno6.click();
    await page.fill('#totalMarks', '10');
    await page.click('#totalMarks');
    await page.click('#questionname');
    const ques5= 'Quiz_QUE5_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques5);
    await page.click('.py-2:nth-child(4)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quiz3gridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quiz3Found = quiz3gridText.includes(badgeQuizName3);
    if (quiz3Found) {
        console.log(`\x1b[32mâœ… Verified: Quiz3 "${badgeQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz3 "${badgeQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


   
    const storedprofilename = await page.evaluate(() => {return localStorage.getItem("ProfileName");});

    // create lp1 for badge sceanrio2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName= 'lp_Badge_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpbadgeQuizName);
    await page.fill('#name', lpbadgeQuizName);
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addPointsBtn');
    await page.click('.performer-table > .d-flex');
    await page.click('[name="points[]"]');
    await page.fill('[name="points[]"]', '60');
    await page.click('.learningPlanBadgeType');
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpbadgeQuizName);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpbadgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpbadgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // craete lp 2 for badge scenario2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName2= 'lp_Badge_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP2", name);}, lpbadgeQuizName2);
    await page.fill('#name', lpbadgeQuizName2);
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addPointsBtn');
    await page.click('.performer-table > .d-flex');
    await page.click('[name="points[]"]');
    await page.fill('[name="points[]"]', '40');
    await page.click('.learningPlanBadgeType');
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname2 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz2");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname2);
    await page.locator(`.select2-results__option:has-text("${storedquizname2}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname2}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lp2gridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lp2Found = lp2gridText.includes(lpbadgeQuizName2);
    if (lp2Found) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpbadgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpbadgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create lp 3 for bage scenario 2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName3 = 'lp_Badge_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP3", name);}, lpbadgeQuizName3);
    await page.fill('#name',lpbadgeQuizName3 );
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addPointsBtn');
    await page.click('.performer-table > .d-flex');
    await page.click('[name="points[]"]');
    await page.fill('[name="points[]"]', '100');
    await page.click('.learningPlanBadgeType');
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname3 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz3");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname3);
    await page.locator(`.select2-results__option:has-text("${storedquizname3}")`).waitFor({state:'visible'});;
    await page.click(`.select2-results__option:has-text("${storedquizname3}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lp3gridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lp3Found = lp3gridText.includes(lpbadgeQuizName3);
    if (lp3Found) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpbadgeQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpbadgeQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// create badges  based on performance of lp
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#badgeName');
    const gridbadgename = await page.evaluate(() => {
    const gridbadgename1 = 'lp_performance_badge1_' + Math.floor(Math.random() * 100000);localStorage.setItem('gridbadgename1', gridbadgename1); return gridbadgename1;
    });
    await page.fill('#badgeName', gridbadgename);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.learningPlanBadgeType');
    await page.click('#learningPlanDD_chosen .default');
    const storedlp1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('#learningPlanDD_chosen .default', storedlp1);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedlp1}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedlp1}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.pointsCriteriaType');
    await page.click('.pointCriteriaGreaterThan');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '50');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename2 = await page.evaluate(() => {
      let gridbadgename2 ="lp_performance_badge2_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename2",gridbadgename2); return gridbadgename2;
    });
    await page.fill('#badgeName', grid_badgename2);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.learningPlanBadgeType');
    await page.click('#learningPlanDD_chosen .default');
    const storedlp2 = await page.evaluate(() => {return localStorage.getItem("LP2");});
    await page.fill('#learningPlanDD_chosen .default', storedlp2);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedlp2}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedlp2}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.pointsCriteriaType');
    await page.click('.pointCriteriaLessThan ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '80');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename3 = await page.evaluate(() => {
      let gridbadgename3 ="lp_performance_badge3_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename3",gridbadgename3); return gridbadgename3;
    });
    await page.fill('#badgeName', grid_badgename3);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.learningPlanBadgeType');
    await page.click('#learningPlanDD_chosen .default');
    const storedlp3 = await page.evaluate(() => {return localStorage.getItem("LP3");});
    await page.fill('#learningPlanDD_chosen .default', storedlp3);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedlp3}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedlp3}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.pointsCriteriaType');
    await page.click('.pointCriteriaEqualTo ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '100');
    await page.click('#saveBadgeBtn');
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageBadgesGrid');
    const gridText = await page.locator('#contentmanageBadgesGrid').innerText();
    const badgesToCheck = [
      gridbadgename,
      grid_badgename2,
      grid_badgename3,
    ];
    for (const badge of badgesToCheck) {
      if (gridText.includes(badge)) {
        console.log(`\x1b[32mâœ… Verified: badge "${badge}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: badge "${badge}" NOT FOUND in jqxGrid!\x1b[0m`);
      }
    }


    // execute lp activation cron call 
    await execute_learningplan_activation_cron(page);

    
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');



    // attempt lp's module for badge scenario 3
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_quiz1 = await page.evaluate(() => localStorage.getItem("badgeQuiz"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_quiz1 });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.reload();
    await page.waitForLoadState('networkidle');


    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('grid badge from user logs: ', gridbadge);
    const assignbadge= await page.evaluate(() => {return localStorage.getItem("gridbadgename1");});
    console.log('admin assigned badge: ',assignbadge);
    if (assignbadge == gridbadge){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  condition  based learning plan that if Points are greater than 50% in learning plan ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }


// attempt lp2
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP2 = await page.evaluate(() => {return localStorage.getItem("LP2");});
    await page.fill('.ant-select-selection-search-input', storedLP2);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP2}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP2}")`);
    const stored_quiz2 = await page.evaluate(() => localStorage.getItem("badgeQuiz2"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz2 });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    // await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.reload();
    await page.waitForLoadState('networkidle');


    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge2 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user2 logs badge: ',gridbadge2);
    const assignbadge2 = await page.evaluate(() => { return localStorage.getItem("gridbadgename2"); });
    console.log('admin assigned badge 2 : ',assignbadge2);
    if (assignbadge2 == gridbadge2){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  condition  based learning plan that if Points are less than 80% in learning plan ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }
  
    // attempt lp3
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP3 = await page.evaluate(() => {return localStorage.getItem("LP3");});
    await page.fill('.ant-select-selection-search-input', storedLP3);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP3}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP3}")`);
    const stored_quiz3 = await page.evaluate(() => localStorage.getItem("badgeQuiz3"));
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_quiz3 });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.reload();
    await page.waitForLoadState('networkidle');


    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge3 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user 3 logs grid badge: ', gridbadge3);
    const assignbadge3 = await page.evaluate(() => { return localStorage.getItem("gridbadgename3"); });
    console.log('admin assigned badge 3 : ',assignbadge3);
    if (assignbadge3 == gridbadge3){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  condition  based learning plan that if Points are equal to 100% in learning plan ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});
 

    // admin login call
  await login(page);

  // check logs data of badge widgets 
  await page.goto('manageBadgesCards.php');
    await waitForPaceLoad(page);
    await page.click('#searchText');
    const badge1 = await page.evaluate(() => {return localStorage.getItem("gridbadgename1");});
    await page.fill('#searchText', badge1);
    await page.click('#searchBtn');
    await page.click(`.card-container:has(h5.card-title:has-text("${badge1}")) .showBadgeLogsLnk`);
    const storedUsername = await page.evaluate(() => localStorage.getItem("username")); 
    if (!storedUsername) {
      throw new Error("No username found in localStorage");
    }
    const rows = page.locator('[role="row"]');
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    const rowCount = await rows.count();
    let found = false;
    for (let i = 0; i < rowCount; i++) {
    const row = rows.nth(i);
    const username = await row.locator('[columnindex="3"]').innerText();
    if (username.trim() === storedUsername.trim()) {
      found = true;
      const name = await row.locator('[columnindex="2"]').innerText();
      const lpName = await row.locator('[columnindex="5"]').innerText();
      const allottedOn = await row.locator('[columnindex="6"]').innerText();
      const imgSrc = await row.locator('img').getAttribute('src');
      const message = `
        Matched Username: ${username}
        Name: ${name}
        Learning Plan: ${lpName}
        Allotted On: ${allottedOn}
        Image: ${imgSrc}
      `;
       console.log( 'user badge allotment data report: ' , message);
      page.once('dialog', async dialog => {
        console.log('Alert text:', dialog.message());
        await page.waitForTimeout(3000); 
        await dialog.dismiss(); 
      });

      await page.evaluate((msg) => alert(msg), message);

      break;

    }
  }

  if (!found) {
    console.log("No row found for username:", storedUsername);
  }

  await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');

    await page.click('#searchText');
    const badge2 = await page.evaluate(() => { return localStorage.getItem("gridbadgename2"); });
    await page.fill('#searchText', badge2);
    await page.click('#searchBtn');
    await page.click(`.card-container:has(h5.card-title:has-text("${badge2}")) .showBadgeLogsLnk`);
      if (!storedUsername) {
        throw new Error("No username found in localStorage");
      }
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
      for (let i = 0; i < rowCount; i++) {
      const row = rows.nth(i);
      const username = await row.locator('[columnindex="3"]').innerText();
      if (username.trim() === storedUsername.trim()) {
        found = true;
        const name = await row.locator('[columnindex="2"]').innerText();
        const lpName = await row.locator('[columnindex="5"]').innerText();
        const allottedOn = await row.locator('[columnindex="6"]').innerText();
        const imgSrc = await row.locator('img').getAttribute('src');
        const message = `
          Matched Username: ${username}
          Name: ${name}
          Learning Plan: ${lpName}
          Allotted On: ${allottedOn}
          Image: ${imgSrc}
        `;
        console.log( 'user badge allotment data report: ' , message);
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000); 
          await dialog.dismiss(); 
        });

        await page.evaluate((msg) => alert(msg), message);

        break;

      }
    }

  if (!found) {
    console.log("No row found for username:", storedUsername);
  }

  await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');


    await page.click('#searchText');
    const badge3 = await page.evaluate(() => { return localStorage.getItem("gridbadgename3"); });
    await page.fill('#searchText', badge3);
    await page.click('#searchBtn');
    await page.click(`.card-container:has(h5.card-title:has-text("${badge3}")) .showBadgeLogsLnk`);
    if (!storedUsername) {
      throw new Error("No username found in localStorage");
    }
    await rows.first().waitFor({ state: 'visible', timeout: 4000 });
    for (let i = 0; i < rowCount; i++) {
    const row = rows.nth(i);
    const username = await row.locator('[columnindex="3"]').innerText();
    if (username.trim() === storedUsername.trim()) {
      found = true;
      const name = await row.locator('[columnindex="2"]').innerText();
      const lpName = await row.locator('[columnindex="5"]').innerText();
      const allottedOn = await row.locator('[columnindex="6"]').innerText();
      const imgSrc = await row.locator('img').getAttribute('src');
      const message = `
        Matched Username: ${username}
        Name: ${name}
        Learning Plan: ${lpName}
        Allotted On: ${allottedOn}
        Image: ${imgSrc}
      `;
       console.log( 'user badge allotment data report: ' , message);
      page.once('dialog', async dialog => {
        console.log('Alert text:', dialog.message());
        await page.waitForTimeout(3000); 
        await dialog.dismiss(); 
      });

      await page.evaluate((msg) => alert(msg), message);

      break;

    }
  }

  if (!found) {
    console.log("No row found for username:", storedUsername);
  }

  await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');



  // delete user,badges,badge widgets
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('showBadges.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});
test('badge_scenario_4_module_completion_based', async ({ page }) => {
    test.setTimeout('1200000');
    await attachNetworkLogger(page);  

    await login(page);
  // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    

// create profile
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to users
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

 

   // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpBadgeQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(3000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create badge based on completion of module
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#badgeName');
    const gridbadgename = await page.evaluate(() => {
    const gridbadgename1 = 'lp_performance_badge1_' + Math.floor(Math.random() * 100000);localStorage.setItem('modulegridbadgename1', gridbadgename1); return gridbadgename1;
    });
    await page.fill('#badgeName', gridbadgename);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedModule = await page.evaluate(() => {return localStorage.getItem("lpBadgeQuiz");});
    await page.fill('#moduleDD_chosen .default', storedModule);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedModule}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedModule}")`);
    await page.click('.completionAllotmentType');
    await page.click('#saveBadgeBtn > .ladda-label');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… badge created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ badge not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBadgeBtn').waitFor({ state: 'hidden' });
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageBadgesGrid');
    const badgegridText = await page.locator('#contentmanageBadgesGrid').innerText();
    const badgeFound = badgegridText.includes(gridbadgename);
    if (badgeFound) {
        console.log(`\x1b[32mâœ… Verified: Badge "${gridbadgename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Badge "${gridbadgename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // create lp for badge sceanrio 
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName= 'lp_module_Badge_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpbadgeQuizName);
    await page.fill('#name', lpbadgeQuizName);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpBadgeQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.getByRole('button', { name: 'Save', exact: true }).click();
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lp3gridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lp3Found = lp3gridText.includes(lpbadgeQuizName);
    if (lp3Found) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpbadgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpbadgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



    // execute lp activation cron call 
    await execute_learningplan_activation_cron(page);

     // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp's module for badge scenario 4
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_quiz1 = await page.evaluate(() => localStorage.getItem("lpBadgeQuiz"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_quiz1 });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('grid badge from user logs: ', gridbadge);
    const assignbadge= await page.evaluate(() => {return localStorage.getItem("modulegridbadgename1");});
    console.log('admin assigned badge: ',assignbadge);
    if (assignbadge == gridbadge){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user on completion of module. ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }


    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


  // admin login call
  await login(page);


  // delete user,badges,badge widgets
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('showBadges.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});
test('badge_scenario_5_module_performance_based_score_less_greater_equalto', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

await login(page);
  // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    

// create profile
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
     await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

// assign profile to users
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

 

// create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'Badge_Quiz_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }



// create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName2= 'Badge_Quiz_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz2", name);}, badgeQuizName2);
    await page.fill('#name', badgeQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('#lessonType-page-tab');
    await page.click('#questionname');
    const que1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que1);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'php');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'react');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const que2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que2);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'marketing');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'finance');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option3').waitFor({ state: 'visible'});
    await page.click('#option3');
    await page.fill('#option3', 'account');
    await page.click('#marks3');
    await page.fill('#marks3', '10');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const que3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que3);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const que4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText2 = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound2 = quizgridText2.includes(badgeQuizName2);
    if (quizFound2) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// create quiz 3
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName3= 'Badge_Quiz_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz3", name);}, badgeQuizName3);
    await page.fill('#name', badgeQuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '20');
    await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
    await page.click('#questionname');
    const ques1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques1);
    await page.click('#option1');
    await page.fill('#option1', 'we');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'ew');
    await page.click('#quizQuestionOption2 .col-md-5');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno5 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno5.click();
    await page.click('#questionname');
    const ques2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques2);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) #Layer_1');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques3);
    await page.click('#option1');
    await page.fill('#option1', 'dg');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erfer');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option3');
    await page.fill('#option3', 'erf');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option4');
    await page.fill('#option4', 'ergfer');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab > div');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques4);
    await page.click('#option1');
    await page.fill('#option1', 'erger');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erger');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno6 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno6.click();
    await page.fill('#totalMarks', '10');
    await page.click('#totalMarks');
    await page.click('#questionname');
    const ques5= 'Quiz_QUE5_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques5);
    await page.click('.py-2:nth-child(4)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText3 = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound3 = quizgridText3.includes(badgeQuizName3);
    if (quizFound3) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create badges  based on performance of module in lp
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#badgeName');
    const gridbadgename = await page.evaluate(() => {
    const gridbadgename1 = 'module_performance_badge1_' + Math.floor(Math.random() * 100000);localStorage.setItem('gridbadgename1', gridbadgename1); return gridbadgename1;
    });
    await page.fill('#badgeName', gridbadgename);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule1 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.fill('#moduleDD_chosen .default', storedmodule1);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule1}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule1}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.scoreCriteriaType');
    await page.click('.pointCriteriaGreaterThan');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '50');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename2 = await page.evaluate(() => {
      let gridbadgename2 ="module_performance_badge2_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename2",gridbadgename2); return gridbadgename2;
    });
    await page.fill('#badgeName', grid_badgename2);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule2 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz2");});
    await page.fill('#moduleDD_chosen .default', storedmodule2);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule2}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule2}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.scoreCriteriaType');
    await page.click('.pointCriteriaLessThan ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '80');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename3 = await page.evaluate(() => {
      let gridbadgename3 ="module_performance_badge3_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename3",gridbadgename3); return gridbadgename3;
    });
    await page.fill('#badgeName', grid_badgename3);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule3 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz3");});
    await page.fill('#moduleDD_chosen .default', storedmodule3);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule3}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule3}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.scoreCriteriaType');
    await page.click('.pointCriteriaEqualTo ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '100');
    await page.click('#saveBadgeBtn');
    await page.locator('#saveBadgeBtn').waitFor({ state: 'hidden' });
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… badge created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ badge not created (validation / no toastr /save button didn't trigger)");
    }
    await page.waitForSelector('#contentmanageBadgesGrid');
    const gridText = await page.locator('#contentmanageBadgesGrid').innerText();
    const badgesToCheck = [
      gridbadgename,
      grid_badgename2,
      grid_badgename3,
    ];
    console.log("badge1 name : ",gridbadgename ,
       "badge2 name : ",grid_badgename2, 
       "badge3 name : ",grid_badgename3
      );
    for (const badge of badgesToCheck) {
      if (gridText.includes(badge)) {
        console.log(`\x1b[32mâœ… Verified: Badge "${badge}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Badge "${badge}" NOT FOUND in jqxGrid!\x1b[0m`);
      } 
    }



    const storedprofilename = await page.evaluate(() => {return localStorage.getItem("ProfileName");});

    // create lp1 for badge sceanrio2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName= 'lp_Badge_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpbadgeQuizName);
    await page.fill('#name', lpbadgeQuizName);
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.getByRole('button', { name: 'Save', exact: true }).click();
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lp3gridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lp3Found = lp3gridText.includes(lpbadgeQuizName);
    if (lp3Found) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpbadgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpbadgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // craete lp 2 for badge scenario2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName2= 'lp_Badge_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP2", name);}, lpbadgeQuizName2);
    await page.fill('#name', lpbadgeQuizName2);
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname2 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz2");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname2);
    await page.locator(`.select2-results__option:has-text("${storedquizname2}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname2}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.getByRole('button', { name: 'Save', exact: true }).click();
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lp3gridText2 = await page.locator('#contentlearningPlanGrid').innerText();
    const lp3Found2 = lp3gridText2.includes(lpbadgeQuizName2);
    if (lp3Found2) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpbadgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpbadgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create lp 3 for bage scenario 2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName3 = 'lp_Badge_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP3", name);}, lpbadgeQuizName3);
    await page.fill('#name',lpbadgeQuizName3 );
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname3 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz3");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname3);
    await page.locator(`.select2-results__option:has-text("${storedquizname3}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname3}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.getByRole('button', { name: 'Save', exact: true }).click();
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lp3gridText3 = await page.locator('#contentlearningPlanGrid').innerText();
    const lp3Found3 = lp3gridText3.includes(lpbadgeQuizName3);
    if (lp3Found3) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpbadgeQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpbadgeQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    
    // execute lp activation cron call 
    await execute_learningplan_activation_cron(page);
    
     
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');


    // attempt lp's module for badge scenario 5
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_quiz1 = await page.evaluate(() => localStorage.getItem("badgeQuiz"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_quiz1 });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('grid badge from user logs: ', gridbadge);
    const assignbadge= await page.evaluate(() => {return localStorage.getItem("gridbadgename1");});
    console.log('admin assigned badge: ',assignbadge);
    if (assignbadge == gridbadge){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  performance condition  that if scores is greater than 50% in module ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    // attempt lp2
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP2 = await page.evaluate(() => {return localStorage.getItem("LP2");});
    await page.fill('.ant-select-selection-search-input', storedLP2);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP2}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP2}")`);
    const stored_quiz2 = await page.evaluate(() => localStorage.getItem("badgeQuiz2"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz2 });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge2 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user2 logs badge: ',gridbadge2);
    const assignbadge2 = await page.evaluate(() => { return localStorage.getItem("gridbadgename2"); });
    console.log('admin assigned badge 2 : ',assignbadge2);
    if (assignbadge2 == gridbadge2){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  performance condition   that if scores is less than 80% in module ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    // attempt lp3
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP3 = await page.evaluate(() => {return localStorage.getItem("LP3");});
    await page.fill('.ant-select-selection-search-input', storedLP3);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP3}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP3}")`);
    const stored_quiz3 = await page.evaluate(() => localStorage.getItem("badgeQuiz3"));
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_quiz3 });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
     await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge3 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user 3 logs grid badge: ', gridbadge3);
    const assignbadge3 = await page.evaluate(() => { return localStorage.getItem("gridbadgename3"); });
    console.log('admin assigned badge 3 : ',assignbadge3);
    if (assignbadge3 == gridbadge3){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  performance condition  that if scores is equal to  100% in module ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});

    // admin login call
  await login(page);

  // delete user,badges,badge widgets
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


  await page.goto('showBadges.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});
test('badge_scenario_6_module_performance_based_points_less_greater_equalto', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    

// create profile
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
     await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to users
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

 

 // create quiz 1
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName= 'Badge_Quiz_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz", name);}, badgeQuizName);
    await page.fill('#name', badgeQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques1= 'Badge_Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname ', badgeQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques2= 'Badge_Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const badgeQuizques3= 'Badge_Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques3);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques4= 'Badge_Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.getByRole('button', { name: 'Add Points' }).click();
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).click();
    await page.click('[name="points[]"]');
    await page.fill('[name="points[]"]', '80');
    await page.getByText('Completion', { exact: true }).click();
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(badgeQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName2= 'Badge_Quiz_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz2", name);}, badgeQuizName2);
    await page.fill('#name', badgeQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('#lessonType-page-tab');
    await page.click('#questionname');
    const que1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que1);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'php');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'react');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const que2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que2);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', 'marketing');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', 'finance');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option3').waitFor({state:'visible'});
    await page.click('#option3');
    await page.fill('#option3', 'account');
    await page.click('#marks3');
    await page.fill('#marks3', '10');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const que3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que3);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const que4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.getByRole('button', { name: 'Add Points' }).click();
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).click();
    await page.click('[name="points[]"]');
    await page.fill('[name="points[]"]', '50');
    await page.getByText('Completion', { exact: true }).click();
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText2 = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound2 = quizgridText2.includes(badgeQuizName2);
    if (quizFound2) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// create quiz 3
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName3= 'Badge_Quiz_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz3", name);}, badgeQuizName3);
    await page.fill('#name', badgeQuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '20');
    await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
    await page.click('#questionname');
    const ques1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques1);
    await page.click('#option1');
    await page.fill('#option1', 'we');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'ew');
    await page.click('#quizQuestionOption2 .col-md-5');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno5 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno5.click();
    await page.click('#questionname');
    const ques2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques2);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab > div');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques3);
    await page.click('#option1');
    await page.fill('#option1', 'dg');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erfer');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option3');
    await page.fill('#option3', 'erf');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option4');
    await page.fill('#option4', 'ergfer');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab > div');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques4);
    await page.click('#option1');
    await page.fill('#option1', 'erger');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erger');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno6 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno6.click();
    await page.fill('#totalMarks', '10');
    await page.click('#totalMarks');
    await page.click('#questionname');
    const ques5= 'Quiz_QUE5_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques5);
    await page.click('.py-2:nth-child(4)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.getByRole('button', { name: 'Add Points' }).click();
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).click();
    await page.click('[name="points[]"]');
    await page.fill('[name="points[]"]', '100');
    await page.getByText('Completion', { exact: true }).click();
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText3 = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound3 = quizgridText3.includes(badgeQuizName3);
    if (quizFound3) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


   // create badges  based on performance of module in lp
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#badgeName');
    const gridbadgename = await page.evaluate(() => {
    const gridbadgename1 = 'module_performance_badge1_' + Math.floor(Math.random() * 100000);localStorage.setItem('gridbadgename1', gridbadgename1); return gridbadgename1;
    });
    await page.fill('#badgeName', gridbadgename);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule1 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.fill('#moduleDD_chosen .default', storedmodule1);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule1}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule1}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.pointsCriteriaType');
    await page.click('.pointCriteriaGreaterThan');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '50');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename2 = await page.evaluate(() => {
      let gridbadgename2 ="module_performance_badge2_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename2",gridbadgename2); return gridbadgename2;
    });
    await page.fill('#badgeName', grid_badgename2);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule2 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz2");});
    await page.fill('#moduleDD_chosen .default', storedmodule2);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule2}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule2}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.pointsCriteriaType');
    await page.click('.pointCriteriaLessThan ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '80');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename3 = await page.evaluate(() => {
      let gridbadgename3 ="module_performance_badge3_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename3",gridbadgename3); return gridbadgename3;
    });
    await page.fill('#badgeName', grid_badgename3);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule3 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz3");});
    await page.fill('#moduleDD_chosen .default', storedmodule3);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule3}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule3}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.pointsCriteriaType');
    await page.click('.pointCriteriaEqualTo ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '100');
    await page.click('#saveBadgeBtn');
     await page.locator('#saveBadgeBtn').waitFor({ state: 'hidden' });
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… badge created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ badge not created (validation / no toastr /save button didn't trigger)");
    }
    await page.waitForSelector('#contentmanageBadgesGrid');
    const gridText = await page.locator('#contentmanageBadgesGrid').innerText();
    const badgesToCheck = [
      gridbadgename,
      grid_badgename2,
      grid_badgename3,
    ];
    console.log("badge1 name : ",gridbadgename ,
       "badge2 name : ",grid_badgename2, 
       "badge3 name : ",grid_badgename3
      );
    for (const badge of badgesToCheck) {
      if (gridText.includes(badge)) {
        console.log(`\x1b[32mâœ… Verified: Badge "${badge}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Badge "${badge}" NOT FOUND in jqxGrid!\x1b[0m`);
      } 
    }



    const storedprofilename = await page.evaluate(() => {return localStorage.getItem("ProfileName");});

    // create lp1 for badge sceanrio2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName= 'module_Badge_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpbadgeQuizName);
    await page.fill('#name', lpbadgeQuizName);
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.getByRole('button', { name: 'Save', exact: true }).click();
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lp3gridText1 = await page.locator('#contentlearningPlanGrid').innerText();
    const lp3Found1 = lp3gridText1.includes(lpbadgeQuizName);
    if (lp3Found1) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpbadgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpbadgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // craete lp 2 for badge scenario2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName2= 'lp_Badge_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP2", name);}, lpbadgeQuizName2);
    await page.fill('#name', lpbadgeQuizName2);
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname2 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz2");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname2);
    await page.locator(`.select2-results__option:has-text("${storedquizname2}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname2}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.getByRole('button', { name: 'Save', exact: true }).click();
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lp3gridText2 = await page.locator('#contentlearningPlanGrid').innerText();
    const lp3Found2 = lp3gridText2.includes(lpbadgeQuizName2);
    if (lp3Found2) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpbadgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpbadgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create lp 3 for bage scenario 2
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpbadgeQuizName3 = 'lp_Badge_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP3", name);}, lpbadgeQuizName3);
    await page.fill('#name',lpbadgeQuizName3 );
    await page.click('#profilesDiv .select2-search__field');
    console.log(storedprofilename);
    await page.fill('#profilesDiv .select2-search__field', storedprofilename);
    await page.locator(`.select2-results__option:has-text("${storedprofilename}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedprofilename}")`);
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname3 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz3");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname3);
    await page.locator(`.select2-results__option:has-text("${storedquizname3}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname3}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.getByRole('button', { name: 'Save', exact: true }).click();
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lp3gridText3 = await page.locator('#contentlearningPlanGrid').innerText();
    const lp3Found3 = lp3gridText3.includes(lpbadgeQuizName3);
    if (lp3Found3) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpbadgeQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpbadgeQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

      // execute lp activation cron call 
    await execute_learningplan_activation_cron(page);

    
    // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');

    // attempt lp's module for badge scenario 3
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_quiz1 = await page.evaluate(() => localStorage.getItem("badgeQuiz"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_quiz1 });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('grid badge from user logs: ', gridbadge);
    const assignbadge= await page.evaluate(() => {return localStorage.getItem("gridbadgename1");});
    console.log('admin assigned badge: ',assignbadge);
    if (assignbadge == gridbadge){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  condition  based learning plan that if Points are greater than 50% in learning plan ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    // attempt lp2
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP2 = await page.evaluate(() => {return localStorage.getItem("LP2");});
    await page.fill('.ant-select-selection-search-input', storedLP2);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP2}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP2}")`);
    const stored_quiz2 = await page.evaluate(() => localStorage.getItem("badgeQuiz2"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz2 });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge2 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user2 logs badge: ',gridbadge2);
    const assignbadge2 = await page.evaluate(() => { return localStorage.getItem("gridbadgename2"); });
    console.log('admin assigned badge 2 : ',assignbadge2);
    if (assignbadge2 == gridbadge2){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  condition  based learning plan that if Points are less than 80% in learning plan ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

  //  attempt lp3
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP3 = await page.evaluate(() => {return localStorage.getItem("LP3");});
    await page.fill('.ant-select-selection-search-input', storedLP3);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP3}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP3}")`);
     const stored_quiz3 = await page.evaluate(() => localStorage.getItem("badgeQuiz3"));
    const targetCard3 = page.locator('.card-module-container', { hasText: stored_quiz3 });
    await targetCard3.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge3 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user 3 logs grid badge: ', gridbadge3);
    const assignbadge3 = await page.evaluate(() => { return localStorage.getItem("gridbadgename3"); });
    console.log('admin assigned badge 3 : ',assignbadge3);
    if (assignbadge3 == gridbadge3){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  condition  based learning plan that if Points are equal to 100% in learning plan ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});



    // admin login call
  await login(page);

  // delete user,badges,badge widgets
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


  await page.goto('showBadges.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);


});
test('badge_scenario_7_direct_allotment_module_completion', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    

    // create quiz 1
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName= 'Badge_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz", name);}, badgeQuizName);
    await page.fill('#name', badgeQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques1= 'Badge_Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname ', badgeQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno1 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno1.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques2= 'Badge_Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const badgeQuizques3= 'Badge_Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques3);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques4= 'Badge_Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(badgeQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create badge based on completion of module
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#badgeName');
    const gridbadgename = await page.evaluate(() => {
    const gridbadgename1 = 'lp_performance_badge1_' + Math.floor(Math.random() * 100000);localStorage.setItem('modulegridbadgename1', gridbadgename1); return gridbadgename1;
    });
    await page.fill('#badgeName', gridbadgename);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedModule = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.fill('#moduleDD_chosen .default', storedModule);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedModule}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedModule}")`);
    await page.click('.completionAllotmentType');
    await page.click('#saveBadgeBtn > .ladda-label');
     await page.locator('#saveBadgeBtn').waitFor({ state: 'hidden' });
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… badge created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ badge not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageBadgesGrid');
    const quizgridText1 = await page.locator('#contentmanageBadgesGrid').innerText();
    const quizFound1 = quizgridText1.includes(gridbadgename);
    if (quizFound1) {
        console.log(`\x1b[32mâœ… Verified: Badge "${gridbadgename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Badge "${gridbadgename}" NOT FOUND in jqxGrid!\x1b[0m`);
      } 



     // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    

    // attempt module
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('grid badge from user logs: ', gridbadge);
    const assignbadge= await page.evaluate(() => {return localStorage.getItem("modulegridbadgename1");});
    console.log('admin assigned badge: ',assignbadge);
    if (assignbadge == gridbadge){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user on completion of module. ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


  // admin login call
  await login(page);


  // delete user,badges,badge widgets
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);

  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('showBadges.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


});
test('badge_scenario_8_direct_allotment_module_performance_based_score_less_greater_equalto', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);
  // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    

    // create quiz 1
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName= 'Badge_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz", name);}, badgeQuizName);
    await page.fill('#name', badgeQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({State:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques1= 'Badge_Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname ', badgeQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno1 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno1.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques2= 'Badge_Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const badgeQuizques3= 'Badge_Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques3);
    await page.locator('#option1').waitFor({state:'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({state:'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques4= 'Badge_Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(badgeQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

  
// create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName2= 'Badge_Quiz_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz2", name);}, badgeQuizName2);
    await page.fill('#name', badgeQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('#lessonType-page-tab');
    await page.click('#questionname');
    const que1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que1);
    await page.click('#option1');
    await page.fill('#option1', 'php');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'react');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const que2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que2);
    await page.click('#option1');
    await page.fill('#option1', 'marketing');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'finance');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option3');
    await page.fill('#option3', 'account');
    await page.click('#marks3');
    await page.fill('#marks3', '10');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const que3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que3);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const que4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText2 = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound2 = quizgridText2.includes(badgeQuizName2);
    if (quizFound2) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// create quiz 3
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName3= 'Badge_Quiz_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz3", name);}, badgeQuizName3);
    await page.fill('#name', badgeQuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '20');
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
    await page.click('#questionname');
    const ques1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques1);
    await page.click('#option1');
    await page.fill('#option1', 'we');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'ew');
    await page.click('#quizQuestionOption2 .col-md-5');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno5 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno5.click();
    await page.click('#questionname');
    const ques2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques2);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques3);
    await page.click('#option1');
    await page.fill('#option1', 'dg');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erfer');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option3');
    await page.fill('#option3', 'erf');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option4');
    await page.fill('#option4', 'ergfer');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques4);
    await page.click('#option1');
    await page.fill('#option1', 'erger');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erger');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno6 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno6.click();
    await page.fill('#totalMarks', '10');
    await page.click('#totalMarks');
    await page.click('#questionname');
    const ques5= 'Quiz_QUE5_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques5);
    await page.click('.py-2:nth-child(4)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
     try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText3 = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound3 = quizgridText3.includes(badgeQuizName3);
    if (quizFound3) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create badges  based on performance of module in lp
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#badgeName');
    const gridbadgename = await page.evaluate(() => {
    const gridbadgename1 = 'module_performance_badge1_' + Math.floor(Math.random() * 100000);localStorage.setItem('gridbadgename1', gridbadgename1); return gridbadgename1;
    });
    await page.fill('#badgeName', gridbadgename);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule1 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.fill('#moduleDD_chosen .default', storedmodule1);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule1}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule1}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.scoreCriteriaType');
    await page.click('.pointCriteriaGreaterThan');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '50');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename2 = await page.evaluate(() => {
      let gridbadgename2 ="module_performance_badge2_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename2",gridbadgename2); return gridbadgename2;
    });
    await page.fill('#badgeName', grid_badgename2);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule2 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz2");});
    await page.fill('#moduleDD_chosen .default', storedmodule2);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule2}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule2}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.scoreCriteriaType');
    await page.click('.pointCriteriaLessThan ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '80');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename3 = await page.evaluate(() => {
      let gridbadgename3 ="module_performance_badge3_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename3",gridbadgename3); return gridbadgename3;
    });
    await page.fill('#badgeName', grid_badgename3);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule3 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz3");});
    await page.fill('#moduleDD_chosen .default', storedmodule3);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule3}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule3}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.scoreCriteriaType');
    await page.click('.pointCriteriaEqualTo ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '100');
    await page.click('#saveBadgeBtn');
    await page.locator('#saveBadgeBtn').waitFor({ state: 'hidden' });
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… badge created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ badge not created (validation / no toastr /save button didn't trigger)");
    }
    await page.waitForSelector('#contentmanageBadgesGrid');
    const gridText = await page.locator('#contentmanageBadgesGrid').innerText();
    const badgesToCheck = [
      gridbadgename,
      grid_badgename2,
      grid_badgename3,
    ];
    console.log("badge1 name : ",gridbadgename ,
       "badge2 name : ",grid_badgename2, 
       "badge3 name : ",grid_badgename3
      );
    for (const badge of badgesToCheck) {
      if (gridText.includes(badge)) {
        console.log(`\x1b[32mâœ… Verified: Badge "${badge}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Badge "${badge}" NOT FOUND in jqxGrid!\x1b[0m`);
      } 
    }

      // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    

    // attempt  module for badge scenario 8
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.locator(`tr.ant-table-row:has(td span.font-medium:has-text("${storedModulequiz}")) button:has-text("Launch")`).click();
    // await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('grid badge from user logs: ', gridbadge);
    const assignbadge= await page.evaluate(() => {return localStorage.getItem("gridbadgename1");});
    console.log('admin assigned badge: ',assignbadge);
    if (assignbadge == gridbadge){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user on completion of module. ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

// attempt lp2
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz2 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz2");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz2);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.locator(`tr.ant-table-row:has(td span.font-medium:has-text("${storedModulequiz2}")) button:has-text("Launch")`).click();
    // await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge2 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user2 logs badge: ',gridbadge2);
    const assignbadge2 = await page.evaluate(() => { return localStorage.getItem("gridbadgename2"); });
    console.log('admin assigned badge 2 : ',assignbadge2);
    if (assignbadge2 == gridbadge2){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  performance condition   that if scores is less than 80% in module ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    // attempt lp3
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz3 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz3");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz3);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
        await page.locator(`tr.ant-table-row:has(td span.font-medium:has-text("${storedModulequiz3}")) button:has-text("Launch")`).click();

    // await page.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge3 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user 3 logs grid badge: ', gridbadge3);
    const assignbadge3 = await page.evaluate(() => { return localStorage.getItem("gridbadgename3"); });
    console.log('admin assigned badge 3 : ',assignbadge3);
    if (assignbadge3 == gridbadge3){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  performance condition  that if scores is equal to  100% in module ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});


    // sdmin login call 
    await login(page);

   // check logs data of badge widgets 
    await page.goto('manageBadgesCards.php');
    await waitForPaceLoad(page);
    await page.click('#searchText');
    const badge1 = await page.evaluate(() => localStorage.getItem("gridbadgename1"));
    await page.fill('#searchText', badge1);
    await page.click('#searchBtn');
    await page.waitForSelector(`.card-container:has(h5.card-title:has-text("${badge1}"))`);
    await page.locator(`.card-container:has(h5.card-title:has-text("${badge1}")) button.showBadgeLogsLnk`).click();
    const storedUsername = await page.evaluate(() => localStorage.getItem("username"));
    if (!storedUsername) {
      throw new Error("No username found for ", storedUsername);
    }
    const row = page.locator(
      `#contenttablegridArea div[role="row"]:has([columnindex="3"]:has-text("${storedUsername}"))`
    );
    await row.first().waitFor(); 
    const UserName = await row.locator('[columnindex="3"]').innerText();
    const name = await row.locator('[columnindex="2"]').innerText();
    const lpName = await row.locator('[columnindex="5"]').innerText();
    const allottedOn = await row.locator('[columnindex="6"]').innerText();
    const imgSrc = await row.locator('img').getAttribute('src');

    const message = `
    Matched Username: ${UserName}
    Name: ${name}
    Module Name: ${lpName}
    Allotted On: ${allottedOn}
    Image: ${imgSrc}
    `;
    console.log('user badge allotment data report:', message);

    // Handle alert popup
    page.once('dialog', async dialog => {
      console.log('Alert text:', dialog.message());
      await page.waitForTimeout(3000);
      await dialog.dismiss();
    });

    await page.evaluate((msg) => alert(msg), message);

  
    await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');


    await page.click('#searchText');
    const badge2 = await page.evaluate(() => { return localStorage.getItem("gridbadgename2"); });
    await page.fill('#searchText', badge2);
    await page.click('#searchBtn');
    await page.waitForSelector(`.card-container:has(h5.card-title:has-text("${badge2}"))`);
    await page.locator(`.card-container:has(h5.card-title:has-text("${badge2}")) button.showBadgeLogsLnk`).click(); 
    if (!storedUsername) {
      throw new Error("No username found for ", storedUsername);
    }
    const row1 = page.locator(
      `#contenttablegridArea div[role="row"]:has([columnindex="3"]:has-text("${storedUsername}"))`
    );
    await row1.first().waitFor(); 
    const UserName1 = await row1.locator('[columnindex="3"]').innerText();
    const name1 = await row1.locator('[columnindex="2"]').innerText();
    const lpName1 = await row1.locator('[columnindex="5"]').innerText();
    const allottedOn1 = await row1.locator('[columnindex="6"]').innerText();
    const imgSrc1 = await row1.locator('img').getAttribute('src');

    const message1 = `
    Matched Username: ${UserName1}
    Name: ${name1}
    Module Name: ${lpName1}
    Allotted On: ${allottedOn1}
    Image: ${imgSrc1}
    `;
    console.log('user badge allotment data report:', message1);

    // Handle alert popup
    page.once('dialog', async dialog => {
      console.log('Alert text:', dialog.message());
      await page.waitForTimeout(3000);
      await dialog.dismiss();
    });

    await page.evaluate((msg) => alert(msg), message1);

  
    await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');



    await page.click('#searchText');
    const badge3 = await page.evaluate(() => { return localStorage.getItem("gridbadgename3"); });
    await page.fill('#searchText', badge3);
    await page.click('#searchBtn');
    await page.waitForSelector(`.card-container:has(h5.card-title:has-text("${badge3}"))`);
    await page.locator(`.card-container:has(h5.card-title:has-text("${badge3}")) button.showBadgeLogsLnk`).click();
    if (!storedUsername) {
      throw new Error("No username found for ", storedUsername);
    }
    const row2 = page.locator(
      `#contenttablegridArea div[role="row"]:has([columnindex="3"]:has-text("${storedUsername}"))`
    );
    await row2.first().waitFor(); 
    const UserName2 = await row2.locator('[columnindex="3"]').innerText();
    const name2 = await row2.locator('[columnindex="2"]').innerText();
    const lpName2 = await row2.locator('[columnindex="5"]').innerText();
    const allottedOn2 = await row2.locator('[columnindex="6"]').innerText();
    const imgSrc2 = await row2.locator('img').getAttribute('src');

    const message2 = `
    Matched Username: ${UserName2}
    Name: ${name2}
    Module Name: ${lpName2}
    Allotted On: ${allottedOn2}
    Image: ${imgSrc2}
    `;
    console.log('user badge allotment data report:', message2);

    // Handle alert popup
    page.once('dialog', async dialog => {
      console.log('Alert text:', dialog.message());
      await page.waitForTimeout(3000);
      await dialog.dismiss();
    });

    await page.evaluate((msg) => alert(msg), message2);

  
    await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');



   // delete user,badges,badge widgets
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('showBadges.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


});
test('badge_scenario_9_direct_allotment_module_performance_based_points_less_greater_equalto', async ({ page }) => {
  test.setTimeout('1200000');
    await attachNetworkLogger(page);  

  await login(page);

  // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


     // create quiz 1
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName= 'Badge_Quiz_1_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz", name);}, badgeQuizName);
    await page.fill('#name', badgeQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    const user_Name = await page.evaluate(() => {return localStorage.getItem("username");});
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques1= 'Badge_Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname ', badgeQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques2= 'Badge_Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const badgeQuizques3= 'Badge_Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques3);
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno1 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno1.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const badgeQuizques4= 'Badge_Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', badgeQuizques4);
    await page.waitForTimeout(2000);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.getByRole('button', { name: 'Add Points' }).click();
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).click();
    await page.click('[name="points[]"]');
    await page.fill('[name="points[]"]', '80');
    await page.getByText('Completion', { exact: true }).click();
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(badgeQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// create quiz 2
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName2= 'Badge_Quiz_2_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz2", name);}, badgeQuizName2);
    await page.fill('#name', badgeQuizName2);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('#lessonType-page-tab');
    await page.click('#questionname');
    const que1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que1);
    await page.click('#option1');
    await page.fill('#option1', 'php');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'react');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const que2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que2);
    await page.click('#option1');
    await page.fill('#option1', 'marketing');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'finance');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option3');
    await page.fill('#option3', 'account');
    await page.click('#marks3');
    await page.fill('#marks3', '10');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const que3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que3);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const que4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', que4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.getByRole('button', { name: 'Add Points' }).click();
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).click();
    await page.click('[name="points[]"]');
    await page.fill('[name="points[]"]', '50');
    await page.getByText('Completion', { exact: true }).click();
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText2 = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound2 = quizgridText2.includes(badgeQuizName2);
    if (quizFound2) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName2}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName2}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// create quiz 3
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const badgeQuizName3= 'Badge_Quiz_3_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("badgeQuiz3", name);}, badgeQuizName3);
    await page.fill('#name', badgeQuizName3);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '20');
    await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
    await page.getByRole('textbox', { name: 'Select Users' }).click();
    await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
    await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${user_Name}")`);
    await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
    await page.click('#questionname');
    const ques1= 'Quiz_QUE1_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques1);
    await page.click('#option1');
    await page.fill('#option1', 'we');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'ew');
    await page.click('#quizQuestionOption2 .col-md-5');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno4 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno4.click();
    await page.click('#questionname');
    const ques2= 'Quiz_QUE2_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques2);
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques3= 'Quiz_QUE3_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques3);
    await page.click('#option1');
    await page.fill('#option1', 'dg');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erfer');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option3');
    await page.fill('#option3', 'erf');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option4');
    await page.fill('#option4', 'ergfer');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#marks2');
    await page.fill('#marks2', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(2)', { state: 'visible' });
    await page.waitForTimeout(2000);
    await page.click('.nav-item:nth-child(2) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    const ques4= 'Quiz_QUE4_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques4);
    await page.click('#option1');
    await page.fill('#option1', 'erger');
    await page.click('#addQuizQuestionOptionButton');
    await page.click('#option2');
    await page.fill('#option2', 'erger');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno5 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno5.click();
    await page.fill('#totalMarks', '10');
    await page.click('#totalMarks');
    await page.click('#questionname');
    const ques5= 'Quiz_QUE5_' + Math.floor(Math.random() * 100000);
    await page.fill('#questionname', ques5);
    await page.click('.py-2:nth-child(4)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.getByRole('button', { name: 'Add Points' }).click();
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Performance' }).click();
    await page.click('[name="points[]"]');
    await page.fill('[name="points[]"]', '100');
    await page.getByText('Completion', { exact: true }).click();
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveBtn').waitFor({state:'hidden'});
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText3 = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound3 = quizgridText3.includes(badgeQuizName3);
    if (quizFound3) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${badgeQuizName3}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${badgeQuizName3}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


      // create badges  based on performance of module in lp
    await page.goto('showBadges.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#badgeName');
    const gridbadgename = await page.evaluate(() => {
    const gridbadgename1 = 'module_performance_badge1_' + Math.floor(Math.random() * 100000);localStorage.setItem('gridbadgename1', gridbadgename1); return gridbadgename1;
    });
    await page.fill('#badgeName', gridbadgename);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule1 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.fill('#moduleDD_chosen .default', storedmodule1);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule1}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule1}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.pointsCriteriaType');
    await page.click('.pointCriteriaGreaterThan');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '50');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename2 = await page.evaluate(() => {
      let gridbadgename2 ="module_performance_badge2_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename2",gridbadgename2); return gridbadgename2;
    });
    await page.fill('#badgeName', grid_badgename2);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule2 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz2");});
    await page.fill('#moduleDD_chosen .default', storedmodule2);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule2}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule2}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.pointsCriteriaType');
    await page.click('.pointCriteriaLessThan ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '80');
    await page.click('#saveNewBadgeBtn > .ladda-label');
    await page.waitForTimeout(2000);
    await page.click('#badgeName');
    const grid_badgename3 = await page.evaluate(() => {
      let gridbadgename3 ="module_performance_badge3_"+  Math.floor(Math.random() * 100000); localStorage.setItem("gridbadgename3",gridbadgename3); return gridbadgename3;
    });
    await page.fill('#badgeName', grid_badgename3);
    await page.click('#badgeImg');
    await page.click('#galleryBtn');
    await page.getByRole('button', { name: 'Images Gallery' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Images Gallery' }).click();
    await page.locator('.gallery img').nth(1).click();
    await page.locator('#addImgBtn').click();
    await page.locator('#addImgBtn').waitFor({state:'hidden'});
    await page.click('.moduleBadgeType');
    await page.click('#moduleDD_chosen .default');
    const storedmodule3 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz3");});
    await page.fill('#moduleDD_chosen .default', storedmodule3);
    await page.locator(`.chosen-drop .chosen-results li:has-text("${storedmodule3}")`).waitFor({state:'visible'});
    await page.click(`.chosen-drop .chosen-results li:has-text("${storedmodule3}")`);
    await page.click('.performanceAllotmentType');
    await page.click('.pointsCriteriaType');
    await page.click('.pointCriteriaEqualTo ');
    await page.click('#allotmentScore');
    await page.fill('#allotmentScore', '100');
    await page.click('#saveBadgeBtn');
    await page.locator('#saveBadgeBtn').waitFor({ state: 'hidden' });
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… badge created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ badge not created (validation / no toastr /save button didn't trigger)");
    }
    await page.waitForSelector('#contentmanageBadgesGrid');
    const gridText = await page.locator('#contentmanageBadgesGrid').innerText();
    const badgesToCheck = [
      gridbadgename,
      grid_badgename2,
      grid_badgename3,
    ];
    console.log("badge1 name : ",gridbadgename ,
       "badge2 name : ",grid_badgename2, 
       "badge3 name : ",grid_badgename3
      );
    for (const badge of badgesToCheck) {
      if (gridText.includes(badge)) {
        console.log(`\x1b[32mâœ… Verified: Badge "${badge}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Badge "${badge}" NOT FOUND in jqxGrid!\x1b[0m`);
      } 
    }

      // login user
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log(`\x1b[32m%s\x1b[0m`,'learner logged in successfully.');
    

    // attempt  module for badge scenario 8
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz = await page.evaluate(() => {return localStorage.getItem("badgeQuiz");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.locator(`tr.ant-table-row:has(td span.font-medium:has-text("${storedModulequiz}")) button:has-text("Launch")`).click();
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('grid badge from user logs: ', gridbadge);
    const assignbadge= await page.evaluate(() => {return localStorage.getItem("gridbadgename1");});
    console.log('admin assigned badge: ',assignbadge);
    if (assignbadge == gridbadge){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user on completion of module. ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }


    // attempt lp2
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz2 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz2");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz2);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.locator(`tr.ant-table-row:has(td span.font-medium:has-text("${storedModulequiz2}")) button:has-text("Launch")`).click();
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(3) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge2 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user2 logs badge: ',gridbadge2);
    const assignbadge2 = await page.evaluate(() => { return localStorage.getItem("gridbadgename2"); });
    console.log('admin assigned badge 2 : ',assignbadge2);
    if (assignbadge2 == gridbadge2){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  performance condition   that if scores is less than 80% in module ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }


    // attempt lp3
    await page.goto('userui/modules/');
    await page.waitForLoadState('networkidle');
    await page.getByRole('textbox', { name: 'Search Module' }).click();
    const storedModulequiz3 = await page.evaluate(() => {return localStorage.getItem("badgeQuiz3");});
    await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz3);
    await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
    await page.locator(`tr.ant-table-row:has(td span.font-medium:has-text("${storedModulequiz3}")) button:has-text("Launch")`).click();
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(2) .ant-checkbox-input');
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-checkbox-wrapper:nth-child(1) .ant-checkbox-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'OK' }).click();
    await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
    await page.reload();
    await page.goto('userui/logs/?type=badges');
    await page.waitForLoadState('networkidle');
    const gridbadge3 = await page.evaluate(() => {
      return [...document.querySelectorAll("div.flex.justify-start.items-center.gap-1")].filter(el => el.offsetParent !== null)[0]?.innerText;
    });
    console.log('user 3 logs grid badge: ', gridbadge3);
    const assignbadge3 = await page.evaluate(() => { return localStorage.getItem("gridbadgename3"); });
    console.log('admin assigned badge 3 : ',assignbadge3);
    if (assignbadge3 == gridbadge3){
        page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
        await page.evaluate(() => {
          alert("badge is allotted to the user for  performance condition  that if scores is equal to  100% in module ");
        });
    }else{
       page.once('dialog', async dialog => {
          console.log('Alert text:', dialog.message());
          await page.waitForTimeout(3000);
          await dialog.dismiss();
        });
         await page.evaluate(() => {alert("badge is not alloted or found. ");});
    }

    await page.getByRole('banner').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});



    //  admin login call 
     await login(page);

    // check logs data of badge widgets 
    await page.goto('manageBadgesCards.php');
    await waitForPaceLoad(page);
    await page.click('#searchText');
    const badge1 = await page.evaluate(() => localStorage.getItem("gridbadgename1"));
    await page.fill('#searchText', badge1);
    await page.click('#searchBtn');
    await page.waitForSelector(`.card-container:has(h5.card-title:has-text("${badge1}"))`);
    await page.locator(`.card-container:has(h5.card-title:has-text("${badge1}")) button.showBadgeLogsLnk`).click();
    const storedUsername = await page.evaluate(() => localStorage.getItem("username"));
    if (!storedUsername) {
      throw new Error("No username found for ", storedUsername);
    }
    const row = page.locator(
      `#contenttablegridArea div[role="row"]:has([columnindex="3"]:has-text("${storedUsername}"))`
    );
    await row.first().waitFor(); 
    const UserName = await row.locator('[columnindex="3"]').innerText();
    const name = await row.locator('[columnindex="2"]').innerText();
    const lpName = await row.locator('[columnindex="5"]').innerText();
    const allottedOn = await row.locator('[columnindex="6"]').innerText();
    const imgSrc = await row.locator('img').getAttribute('src');

    const message = `
    Matched Username: ${UserName}
    Name: ${name}
    Module Name: ${lpName}
    Allotted On: ${allottedOn}
    Image: ${imgSrc}
    `;
    console.log('user badge allotment data report:', message);

    // Handle alert popup
    page.once('dialog', async dialog => {
      console.log('Alert text:', dialog.message());
      await page.waitForTimeout(3000);
      await dialog.dismiss();
    });

    await page.evaluate((msg) => alert(msg), message);

  
    await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');


    await page.click('#searchText');
    const badge2 = await page.evaluate(() => { return localStorage.getItem("gridbadgename2"); });
    await page.fill('#searchText', badge2);
    await page.click('#searchBtn');
    await page.waitForSelector(`.card-container:has(h5.card-title:has-text("${badge2}"))`);
    await page.locator(`.card-container:has(h5.card-title:has-text("${badge2}")) button.showBadgeLogsLnk`).click(); 
    if (!storedUsername) {
      throw new Error("No username found for ", storedUsername);
    }
    const row1 = page.locator(
      `#contenttablegridArea div[role="row"]:has([columnindex="3"]:has-text("${storedUsername}"))`
    );
    await row1.first().waitFor(); 
    const UserName1 = await row1.locator('[columnindex="3"]').innerText();
    const name1 = await row1.locator('[columnindex="2"]').innerText();
    const lpName1 = await row1.locator('[columnindex="5"]').innerText();
    const allottedOn1 = await row1.locator('[columnindex="6"]').innerText();
    const imgSrc1 = await row1.locator('img').getAttribute('src');

    const message1 = `
    Matched Username: ${UserName1}
    Name: ${name1}
    Module Name: ${lpName1}
    Allotted On: ${allottedOn1}
    Image: ${imgSrc1}
    `;
    console.log('user badge allotment data report:', message1);

    // Handle alert popup
    page.once('dialog', async dialog => {
      console.log('Alert text:', dialog.message());
      await page.waitForTimeout(3000);
      await dialog.dismiss();
    });

    await page.evaluate((msg) => alert(msg), message1);

  
    await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');



    await page.click('#searchText');
    const badge3 = await page.evaluate(() => { return localStorage.getItem("gridbadgename3"); });
    await page.fill('#searchText', badge3);
    await page.click('#searchBtn');
    await page.waitForSelector(`.card-container:has(h5.card-title:has-text("${badge3}"))`);
    await page.locator(`.card-container:has(h5.card-title:has-text("${badge3}")) button.showBadgeLogsLnk`).click();
    if (!storedUsername) {
      throw new Error("No username found for ", storedUsername);
    }
    const row2 = page.locator(
      `#contenttablegridArea div[role="row"]:has([columnindex="3"]:has-text("${storedUsername}"))`
    );
    await row2.first().waitFor(); 
    const UserName2 = await row2.locator('[columnindex="3"]').innerText();
    const name2 = await row2.locator('[columnindex="2"]').innerText();
    const lpName2 = await row2.locator('[columnindex="5"]').innerText();
    const allottedOn2 = await row2.locator('[columnindex="6"]').innerText();
    const imgSrc2 = await row2.locator('img').getAttribute('src');

    const message2 = `
    Matched Username: ${UserName2}
    Name: ${name2}
    Module Name: ${lpName2}
    Allotted On: ${allottedOn2}
    Image: ${imgSrc2}
    `;
    console.log('user badge allotment data report:', message2);

    // Handle alert popup
    page.once('dialog', async dialog => {
      console.log('Alert text:', dialog.message());
      await page.waitForTimeout(3000);
      await dialog.dismiss();
    });

    await page.evaluate((msg) => alert(msg), message2);

  
    await page.click('.lg-modal .close:nth-child(2) > span:nth-child(1)');



   // delete user,badges,badge widgets
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('showBadges.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});  
test('reward_with_limited_quantity', async ({ page }) => {
    test.setTimeout(1200000);
    await attachNetworkLogger(page);  

    await login(page);

    //create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }
    


    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

    // create reward 
    await page.goto('ManageRewardPoints.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.locator('#name').click();
    const reward_quant_name = await page.evaluate(() => {
      let name = 'reward_quantity_limited_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('reward1', name); return name;
    });
    await page.locator('#name').fill(reward_quant_name);
    await page.locator('#footer').click();
    await page.locator('#footer').fill('this reward is created by playwright for limlited quantity scenario.');
    await page.locator('#rewardCriteriaDiv label:has-text("Quantity")').click();
    await page.locator('#quantityInput').click();
    await page.locator('#quantityInput').fill('1');
    await page.locator(`input[name='rewardpoints']`).click();
    await page.locator(`input[name='rewardpoints']`).fill('50');
    await page.getByRole('textbox').nth(4).click();
    await page.getByRole('textbox').nth(4).fill('Reward is only redeem if points are equal to 50 or more than 50 and only 3 times eligible.');
    await page.locator('#saveRewardBtn').click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveRewardBtn').waitFor({state:'hidden'});
    await page.goto('ManageRewardPoints.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageRewardGrid');
    const rewardgridText = await page.locator('#contentmanageRewardGrid').innerText();
    const rewardFound = rewardgridText.includes(reward_quant_name);
    if (rewardFound) {
        console.log(`\x1b[32mâœ… Verified: Reward "${reward_quant_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Reward "${reward_quant_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "question_lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    const gamificationSection = page.locator('h6:has-text("Gamification Configuration")').locator('..');
    await gamificationSection.locator('button.addpointsbtn[title="Add Points"]').click();
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).click();
    await page.locator('input[name="points[]"]').click();
    await page.locator('input[name="points[]"]').fill('50');
    await page.getByRole('button', { name: 'Save Module' }).click(); 
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

     // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({State:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.locator('#addPointsBtn').click();
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).waitFor({State:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).click();
    await page.locator('input[name="points[]"]').click();
    await page.locator('input[name="points[]"]').fill('80');
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({State:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({State:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create reward widget
    await page.goto('manageWidgets.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.locator('#widgetname').click();
    const reward_widget_name = await page.evaluate(()=>{
      let name='limited_reward_widget_' + Math.floor(Math.random() * 100000); localStorage.setItem('rewardwidget1',name); return name;
    }) 
    await page.locator('#widgetname').fill(reward_widget_name);
    await page.locator('#widgetTypeDiv').getByText('Reward').click();
    // await page.locator('#learningPlanDD_chosen a.chosen-single span').click();
    // await page.locator('#learningPlanDD_chosen a.chosen-single span').click();
    // const storedlpname = await page.evaluate(() => {return localStorage.getItem("LP1");});
    // await page.locator('#learningPlanDD_chosen input[type="text"]').fill(storedlpname);
    // const option = page.locator('#learningPlanDD_chosen .chosen-results li.active-result').filter({ hasText: storedlpname });
    // await option.waitFor({ state: 'visible' });
    // await option.click();
    await page.locator('#reward').click();
    const storedrewardname = await page.evaluate(() => {return localStorage.getItem("reward1");});
    await page.locator('#reward').selectOption({label: storedrewardname});
    await page.click('#saveWidgetBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageWidgets.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentwidgetsGrid');
    const rewardwidgetgridText = await page.locator('#contentwidgetsGrid').innerText();
    const rewardwidgetFound = rewardwidgetgridText.includes(reward_widget_name);
    if (rewardwidgetFound) {
        console.log(`\x1b[32mâœ… Verified: Reward Widget "${reward_widget_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Reward Widget "${reward_widget_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({State:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.getByRole('button', { name: 'OK' }).click();
    // await page.getByRole('button', { name: 'OK' }).waitFor({State:'hidden'});
    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');

    // redeem reward
    await page.goto('userui/rewards/');
    await page.waitForLoadState('networkidle');
    await page.locator('input[placeholder="Search Rewards"]').click();
    const storedreward = await page.evaluate(() => {return localStorage.getItem("reward1");});
    await page.locator('input[placeholder="Search Rewards"]').fill(storedreward);
    await page.waitForTimeout(4000); // wait 4 seconds
    while (await page.getByRole('button', { name: 'Redeem' }).isEnabled()) {
      await page.getByRole('button', { name: 'Redeem' }).click();
      console.log('Clicked Redeem â€” waiting 3 seconds...');
      await page.waitForTimeout(3000); // wait 3 seconds
    }
    console.log('Redeem button is now disabled âœ… as limit set by admin for reward redeem is reached');
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});

    // admin login call
    await login(page);


    // check reward redeem detail in widget on admin dashboard
    await page.goto('adminDashboard.php');
    await waitForPaceLoad(page);
    const widgetName = await page.evaluate(() => {return localStorage.getItem("rewardwidget1");});
    const widgetCard = page.locator(`.widgetNameDiv[title="${widgetName}"]`).first();
    if (await widgetCard.count() === 0) {
      console.log(`Widget "${widgetName}" not found`);
    } else {
    console.log(`Widget "${widgetName}" found âœ…`);
    const widgetContainer = widgetCard.locator('xpath=ancestor::div[contains(@class, "emd-panel")]');
    const rows = widgetContainer.locator('table.table_widget tbody tr');
    const rowCount = await rows.count();
    let data = [];
    for (let i = 0; i < rowCount; i++) {
      const row = rows.nth(i);
      const rewardName = (await row.locator('td').nth(0).innerText()).trim();
      const username = (await row.locator('td').nth(1).innerText()).trim();
      const date = (await row.locator('td').nth(2).innerText()).trim();
      const points = (await row.locator('td').nth(3).innerText()).trim();

      data.push({ rewardName, username, date, points });
    }
    const counts = {};
    for (const d of data) {
      counts[d.username] = (counts[d.username] || 0) + 1;
    }

    for (const [user, count] of Object.entries(counts)) {
      console.log(`âœ… User "${user}" redeemed the reward successfully ${count} time(s).`);
    }

    console.log("ðŸ“‹ Full data:", data);
  }
  

  // delete data
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({State:'hidden'});
  console.log('learning plan updated scucessfully.');



  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  // delete widget and actvity widget
  await page.goto('manageWidgets.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});
test('reward_with_unlimited_quantity', async ({ page }) => {
    test.setTimeout(1200000);
    await attachNetworkLogger(page);  

    await login(page);
    // create user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#username');
    const username = await page.evaluate(() => {
      let name = 'playwright_user_1_' + Math.floor(Math.random() * 100000); localStorage.setItem('username', name); return name;
    });
    await page.fill('#username', username);
    await page.click('#password');
    await page.fill('#password', '12345678');
    await page.click('#name');
    await page.fill('#name', username);
    await page.click('#emailid');
    await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    const successToast = page.locator('.toast-message', { hasText: /Successfully/i }).first();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learner created  success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learner not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearnersGrid');
    const usergridText = await page.locator('#contentlearnersGrid').innerText();
    const userFound = usergridText.includes(username);
    if (userFound) {
        console.log(`\x1b[32mâœ… Verified: User "${username}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: User "${username}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create profile 
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.click('#name');
    const profilename= 'playwright_profile_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, profilename);
    await page.fill('#name', profilename);
    await page.click('#saveBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageLearnerProfiles.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageLearningProfiles');
    const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
    const profileFound = profilegridText.includes(profilename);
    if (profileFound) {
        console.log(`\x1b[32mâœ… Verified: Profile "${profilename}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Profile "${profilename}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


// assign profile to user
    await page.goto('manageLearners.php');
    await waitForPaceLoad(page);
    await page.locator('.jqx-checkbox-default').nth(1).click();
    await page.click('#setProfile > span');
    await page.click('.search-field > input');
    const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    await page.fill('.search-field > input', storedProfile);
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({state:'visible'});
    await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
    await page.click('#setProfileBtn');
    await page.locator('#saveBtn').waitFor({state : 'hidden'});
    console.log(`\x1b[32mâœ… Profile "${profilename}" assigned to user.\x1b[0m`);

    // create reward 
    await page.goto('ManageRewardPoints.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.locator('#name').click();
    const reward_quant_name = await page.evaluate(() => {
      let name = 'reward_unlimited_' + Math.floor(Math.random() * 100000); localStorage.setItem('reward1', name); return name;
    });
    console.log(reward_quant_name);
    await page.locator('#name').fill(reward_quant_name);
    await page.locator('#footer').click();
    await page.locator('#footer').fill('this reward is created by playwright for limlited unlimited scenario.');
    await page.locator('#rewardCriteriaDiv').getByText('unlimited').click();
    await page.locator(`input[name='rewardpoints']`).click();
    await page.locator(`input[name='rewardpoints']`).fill('20');
    await page.getByRole('textbox').nth(4).click();
    await page.getByRole('textbox').nth(4).fill('Reward is only redeem if points are equal to 20 or more than 20 and eligible until multiple of points times.');
    await page.locator('#saveRewardBtn').click();
    await page.locator('#saveRewardBtn').click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… profile created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ profile not created (validation / no toastr /save button didn't trigger)");
    }
    await page.locator('#saveRewardBtn').waitFor({state:'hidden'});
    await page.goto('ManageRewardPoints.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageRewardGrid');
    const rewardgridText = await page.locator('#contentmanageRewardGrid').innerText();
    const rewardFound = rewardgridText.includes(reward_quant_name);
    if (rewardFound) {
        console.log(`\x1b[32mâœ… Verified: Reward "${reward_quant_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Reward "${reward_quant_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // create lesson
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await waitForPaceLoad(page);
    await page.getByRole('textbox', { name: 'Module Name' }).click();
    const lesson_name = await page.evaluate(()=>{
        let name = "lp_lesson_playwright_" + Math.floor(Math.random() * 100000); localStorage.setItem('lesson1',name); return name;
    });
    await page.getByRole('textbox', { name: 'Module Name' }).fill(lesson_name);
    await page.getByPlaceholder('Enter approx time(in minutes)').click();
    await page.getByPlaceholder('Enter approx time(in minutes)').fill('10');
    await page.getByRole('tab', { name: 'Page' }).click();
    await page.locator('#questionname').click();
    const lesson_question_name = "lesson_playwright_" + Math.floor(Math.random() * 100000);
    await page.locator('#questionname').fill(lesson_question_name);
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).click();
    await page.locator('#createQuestionForm0').getByRole('textbox', { name: 'Editor editing area: main' }).fill("Java is a programming language and a platform. Java is a high-level, robust, object-oriented and secure programming language.Java was developed by Sun Microsystems (which is now a subsidiary of Oracle) in the year 1995. James Gosling is known as the father of Java. Before Java, its name was Oak. Since Oak was already a registered company, so James Gosling and his team changed the name from Oak to Java.Platform: Any hardware or software environment in which a program runs is known as a platform. Since Java has a runtime environment (JRE) and API, it is called a platform.");
    await page.getByRole('button', { name: 'Save Lesson' }).click();
    await page.locator('#addQuesBtn:not(.pure-button-disabled)').waitFor();
    const gamificationSection = page.locator('h6:has-text("Gamification Configuration")').locator('..');
    await gamificationSection.locator('button.addpointsbtn[title="Add Points"]').click();
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).click();
    await page.locator('input[name="points[]"]').click();
    await page.locator('input[name="points[]"]').fill('50');
    await page.getByRole('button', { name: 'Save Module' }).click();
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… lesson module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ lesson module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.getByRole('button', { name: 'Save Module' }).waitFor({state:'hidden'}); 
    await page.goto('showModulesGrid.php?type=lesson');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const lessongridText = await page.locator('#contentmanageModulesGrid').innerText();
    const lessonFound = lessongridText.includes(lesson_name);
    if (lessonFound) {
        console.log(`\x1b[32mâœ… Verified: Lesson "${lesson_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Lesson "${lesson_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    
    // create quiz 
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpQuizName= 'lp_Quiz_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("lpQuiz", name);}, lpQuizName);
    await page.fill('#name', lpQuizName);
    await page.click('#estimatedTime');
    await page.fill('#estimatedTime', '10');
    await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques1= 'Quiz_Question1' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ1", name);}, lpQuizques1);
    await page.fill('#questionname ', lpQuizques1);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno2 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno2.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques2= 'Quiz_Question2' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ2", name);}, lpQuizques2);
    await page.fill('#questionname', lpQuizques2);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    const lpQuizques3= 'Quiz_Question3' + Math.floor(Math.random() * 100000);
    await page.waitForTimeout(2000);
    await page.click('#questionname');
    await page.evaluate((name) => {localStorage.setItem("QuizQ3", name);}, lpQuizques3);
    await page.fill('#questionname', lpQuizques3);
    await page.locator('#option1').waitFor({ state: 'visible'});
    await page.click('#option1');
    await page.fill('#option1', '1a');
    await page.click('#addQuizQuestionOptionButton');
    await page.locator('#option2').waitFor({ state: 'visible'});
    await page.click('#option2');
    await page.fill('#option2', '2a');
    await page.click('#marks1');
    await page.fill('#marks1', '10');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#addQuesBtn');
    await page.click('a.addNewQuestionButton');
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).waitFor({ state: 'visible'});
    await page.getByRole('button', { name: 'New Quiz | ( Total Marks 0)' }).click();
    await page.waitForSelector('.nav-item:nth-child(4)', { state: 'visible' });
    const yesno3 = page.locator('.nav-item:nth-child(4) > #lessonType-page-tab');
    await page.waitForTimeout(2000);
    await yesno3.click();
    await page.click('#totalMarks');
    await page.fill('#totalMarks', '10');
    await page.click('#questionname');
    const lpQuizques4= 'Quiz_Question4' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("QuizQ4", name);}, lpQuizques4);
    await page.fill('#questionname', lpQuizques4);
    await page.click('.py-2:nth-child(2)');
    await page.click('#saveQuesBtn');
    await page.locator('#saveQuesBtn').waitFor({ state: 'hidden' });
    await page.locator('#addQuesBtn').waitFor({ state: 'visible' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… quiz module created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ quiz module not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('showModulesGrid.php?type=quiz');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentmanageModulesGrid');
    const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
    const quizFound = quizgridText.includes(lpQuizName);
    if (quizFound) {
        console.log(`\x1b[32mâœ… Verified: Quiz "${lpQuizName}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Quiz "${lpQuizName}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create learning plan  
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.click('.button-primary');
    await waitForPaceLoad(page);
    await page.click('#name');
    const lpname= 'learning_plan_playwright_' + Math.floor(Math.random() * 100000);
    await page.evaluate((name) => {localStorage.setItem("LP1", name);}, lpname);
    await page.fill('#name', lpname);
    await page.click('#profilesDiv .select2-search__field');
    const stored_Profile = await page.evaluate(() => localStorage.getItem("ProfileName"));
    console.log(stored_Profile);
    await page.fill('#profilesDiv .select2-search__field', stored_Profile);
    await page.locator(`.select2-results__option:has-text("${stored_Profile}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${stored_Profile}")`);
    await page.locator('#addPointsBtn').click();
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).waitFor({state:'visible'});
    await page.getByRole('button', { name: 'Ex: 100 Points Completion' }).click();
    await page.locator('input[name="points[]"]').click();
    await page.locator('input[name="points[]"]').fill('80');
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(1)');
    await page.click('.select2-selection__placeholder');
    const storedlessonname = await page.evaluate(() => {return localStorage.getItem("lesson1");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedlessonname);
    await page.locator(`.select2-results__option:has-text("${storedlessonname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedlessonname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#addModuleButton > .ladda-label');
    await page.click('.quesModuleLbl:nth-child(2)');
    await page.click('.select2-selection__placeholder');
    const storedquizname = await page.evaluate(() => {return localStorage.getItem("lpQuiz");});
    await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
    await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({state:'visible'});
    await page.click(`.select2-results__option:has-text("${storedquizname}")`);
    await page.click('#moduleOk > .ladda-label');
    await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
    await page.click('#saveBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('ManageLearningPlan.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentlearningPlanGrid');
    const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
    const lpFound = lpgridText.includes(lpname);
    if (lpFound) {
        console.log(`\x1b[32mâœ… Verified: LearningPlan "${lpname}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: LearningPlan "${lpname}" NOT FOUND in jqxGrid!\x1b[0m`);
    }

    // create reward widget
    await page.goto('manageWidgets.php');
    await waitForPaceLoad(page);
    await page.getByRole('button', { name: 'Add New' }).click();
    await page.locator('#widgetname').click();
    const reward_widget_name = await page.evaluate(()=>{
      let name='unlimited_reward_widget_' + Math.floor(Math.random() * 100000); localStorage.setItem('rewardwidget1',name); return name;
    }) 
    await page.locator('#widgetname').fill(reward_widget_name);
    await page.locator('#widgetTypeDiv').getByText('Reward').click();
    // await page.locator('#learningPlanDD_chosen a.chosen-single span').click();
    // await page.locator('#learningPlanDD_chosen a.chosen-single span').click();
    // const storedlpname = await page.evaluate(() => {return localStorage.getItem("LP1");});
    // await page.locator('#learningPlanDD_chosen input[type="text"]').fill(storedlpname);
    // const option = page.locator('#learningPlanDD_chosen .chosen-results li.active-result').filter({ hasText: storedlpname });
    // await option.waitFor({ state: 'visible' });
    // await option.click();
    await page.locator('#reward').click();
    const storedrewardname = await page.evaluate(() => {return localStorage.getItem("reward1");});
    await page.locator('#reward').selectOption({label: storedrewardname});
    await page.click('#saveWidgetBtn');
    try {
      await Promise.race([
        successToast.waitFor({ state: 'visible', timeout: 4000 }),
      ]);
      if (await successToast.isVisible()) {
        console.log("âœ… learning plan created success message showed successfully!");
      }
    } catch (e) {
      console.log("âš ï¸ learning plan not created (validation / no toastr /save button didn't trigger)");
    }
    await page.goto('manageWidgets.php');
    await waitForPaceLoad(page);
    await page.waitForSelector('#contentwidgetsGrid');
    const rewardwidgetgridText = await page.locator('#contentwidgetsGrid').innerText();
    const rewardwidgetFound = rewardwidgetgridText.includes(reward_widget_name);
    if (rewardwidgetFound) {
        console.log(`\x1b[32mâœ… Verified: Reward Widget "${reward_widget_name}" appears in jqxGrid.\x1b[0m`);
      } else {
        console.log(`\x1b[31mâŒ ERROR: Reward Widget "${reward_widget_name}" NOT FOUND in jqxGrid!\x1b[0m`);
    }


    // lerning plan activation call 
    await execute_learningplan_activation_cron(page);


    // login user 1
    await page.goto('userui/login/');
    await page.locator('#basic_username').waitFor({state : 'visible'});
    await page.click('#basic_username');
    const userName = await page.evaluate(() => {return localStorage.getItem("username");});
    console.log(userName);
    await page.fill('#basic_username', userName);
    await page.click('#basic_password');
    await page.fill('#basic_password', '12345678');
    await page.getByRole('button', { name: 'Log In' }).click();
    await page.waitForURL('userui/dashboard/');
    await page.waitForLoadState('networkidle');
    console.log('learner logged in successfully.');


    // attempt lp 
    await page.goto('userui/timeline/');
    await page.waitForLoadState('networkidle');
    await page.click('.ant-select-selection-item');
    const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LP1");});
    await page.fill('.ant-select-selection-search-input', storedLP1);
    await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
    await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
    const stored_lesson = await page.evaluate(() => localStorage.getItem("lesson1"));
    const targetCard1 = page.locator('.card-module-container', { hasText: stored_lesson });
    await targetCard1.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.getByRole('button', { name: 'OK' }).click();
    const stored_quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
    const targetCard2 = page.locator('.card-module-container', { hasText: stored_quiz });
    await targetCard2.getByRole('button', { name: 'Launch' }).click();
    await page.waitForLoadState('networkidle');
    await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.click('.primary > span');
    await page.waitForTimeout(2000);
    await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
    await page.getByRole('button', { name: 'Finish' }).click();
    await page.waitForLoadState('networkidle');


    // redeem reward
    await page.goto('userui/rewards/');
    await page.waitForLoadState('networkidle');
    await page.locator('input[placeholder="Search Rewards"]').click();
    const storedreward = await page.evaluate(() => {return localStorage.getItem("reward1");});
    await page.locator('input[placeholder="Search Rewards"]').fill(storedreward);
    await page.waitForTimeout(4000); // wait 3 seconds
    while (await page.getByRole('button', { name: 'Redeem' }).isEnabled()) {
      await page.getByRole('button', { name: 'Redeem' }).click();
      console.log('Clicked Redeem â€” waiting 3 seconds...');
      await page.waitForTimeout(3000); // wait 3 seconds
    }
    console.log('Redeem button is now disabled âœ… because of points are not sufficient get more points and redeem again.');
    await page.getByRole('listitem').locator('img').click();
    await page.getByText('Logout').click();
    await page.locator('#basic_username').waitFor({state : 'visible'});

    // admin login call
    await login(page);


    // check reward redeem detail in widget on admin dashboard
    await page.goto('adminDashboard.php');
    await waitForPaceLoad(page);
    const widgetName = await page.evaluate(() => {return localStorage.getItem("rewardwidget1");});
    const widgetCard = page.locator(`.widgetNameDiv[title="${widgetName}"]`).first();
    if (await widgetCard.count() === 0) {
      console.log(`Widget "${widgetName}" not found`);
    } else {
    console.log(`Widget "${widgetName}" found âœ…`);
    const widgetContainer = widgetCard.locator('xpath=ancestor::div[contains(@class, "emd-panel")]');
    // const rows = widgetContainer.locator('table.table_widget tbody tr');
    // const rowCount = await rows.count();
    // let data = [];
    // for (let i = 0; i < rowCount; i++) {
    //   const row = rows.nth(i);
    //   const rewardName = (await row.locator('td').nth(0).innerText()).trim();
    //   const username = (await row.locator('td').nth(1).innerText()).trim();
    //   const date = (await row.locator('td').nth(2).innerText()).trim();
    //   const points = (await row.locator('td').nth(3).innerText()).trim();

    //   data.push({ rewardName, username, date, points });
    // }

    const rows = widgetContainer.locator('table.table_widget tbody tr:not(.showAllDataLink)');

    const rowCount = await rows.count();
    let data = [];

    for (let i = 0; i < rowCount; i++) {
      const row = rows.nth(i);

      const rewardName = (await row.locator('td').nth(0).innerText()).trim();
      const username = (await row.locator('td').nth(1).innerText()).trim();
      const date = (await row.locator('td').nth(2).innerText()).trim();
      const points = (await row.locator('td').nth(3).innerText()).trim();

      data.push({ rewardName, username, date, points });
    }
    const counts = {};
    for (const d of data) {
      counts[d.username] = (counts[d.username] || 0) + 1;
    }

    for (const [user, count] of Object.entries(counts)) {
      console.log(`âœ… User "${user}" redeemed the reward successfully ${count} time(s).`);
    }

    console.log("ðŸ“‹ Full data:", data);
  }


  // delete data
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  //   edit lp and remove quiz,survey and task module from lp 
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const lp = await page.evaluate(() => localStorage.getItem("LP1"));
  console.log('learning plan : ', lp);
  const targetRow3 = page.locator('#contentlearningPlanGrid [role="row"]', {
        has: page.locator('[role="gridcell"]', { hasText: lp })
    });
  console.log("Row count:", await targetRow3.count());
  await targetRow3.locator('a.editlplink').click();
  await waitForPaceLoad(page);
  const quiz = await page.evaluate(() => localStorage.getItem("lpQuiz"));
  const targetRow1 = page.locator('div.d-flex.panel-heading.lpm_heada', {
     has: page.locator('span#quesTitle0', { hasText: quiz })
  });
  await targetRow1.locator('a#decrementmodule').click();
  await page.click('#saveBtn');
  await page.locator('#saveBtn').waitFor({state:'hidden'});



  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);


  // delete widget and actvity widget
  await page.goto('manageWidgets.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
        await tostr_detector(page);

});

// pending due to searching is not working in admincompanies grid
// test('admindeletion_from_admincleanup_page', async ({ page }) => {

//   // network logger captures the network calls and  status codes like302,400 etc and console.log
//   await attachNetworkLogger(page);
//   await  login_superadmin(page);
//   await page.goto('superAdminAdminsCleanup.php');
//   await waitForPaceLoad(page);
//   await page.pause();
//   const adminUserFilter = page.locator('#contentadminsGrid .jqx-grid-cell-filter-row input[type="textarea"]').nth(2);
//   await adminUserFilter.evaluate(input => input.focus());
//   await adminUserFilter.fill('admin_selenium');
//   await adminUserFilter.press('Enter');
//   const admingridText = await page.locator('#wrapperadminsGrid').innerText();
//   const AdminUserName ='admin_selenium';
//   const admminFound = admingridText.includes(AdminUserName);
//   if (admminFound) {
//     console.log(`\x1b[32mâœ… Verified: Admin "${AdminUserName}" row appears in jqxGrid.\x1b[0m`);
//     const row = page.locator('div[role="row"]', {hasText: AdminUserName});
//     await row.locator('div[columnindex="0"] .jqx-widget.jqx-checkbox').click({ force: true });
//     console.log(`\x1b[32mðŸŸ¢ row selected fou user "${AdminUserName}".\x1b[0m`);
//     await page.getByRole('button', { name: 'Edit', exact: true }).click();
//     await waitForPaceLoad(page);
//     const admincompanyFilter = page.locator('#contentcompaniesGrid .jqx-grid-cell-filter-row input[type="textarea"]').nth(1);
//     await admincompanyFilter.evaluate(input => input.focus());
//     await admincompanyFilter.fill('test_cp');
//     await admincompanyFilter.press('Enter');
//     const admincompanygridText = await page.locator('#wrappercompaniesGrid').innerText();
//     const companyname ='test_cp';
//     const company = admincompanygridText.includes(companyname);
//     if (company) {
//       console.log(`\x1b[32mâœ… Verified: company "${companyname}" row appears in jqxGrid.\x1b[0m`);
//     }
//   await page.pause();
//   }

// });

test('module_quiz_via_question_bank_randomize_with_quickassign', async ({ page }) => {
  test.setTimeout(2000000);

  await attachNetworkLogger(page);
  await login(page);

  //create user
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  const playwright_user_name = 'playwright_user_' + Math.floor(Math.random() * 100000);
  await page.evaluate((val)=>{localStorage.setItem("UserName",val);},playwright_user_name);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#username');
  await page.fill('#username', playwright_user_name);
  await page.click('#password');
  await page.fill('#password', '12345678');
  await page.click('#name');
  await page.fill('#name', playwright_user_name);
  await page.click('#emailid');
  await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
  await page.click('#saveBtn');
  await tostr_detector(page);
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentlearnersGrid');
  const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
  const userFound1 = usergridText1.includes(playwright_user_name);
  if (userFound1) {
      console.log(`\x1b[32mâœ… Verified: User "${playwright_user_name}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: User "${playwright_user_name}" NOT FOUND in jqxGrid!\x1b[0m`);
  }
  
  
  // //create profile
  // await page.goto('manageLearnerProfiles.php');
  // await waitForPaceLoad(page);
  // const playwright_profile_name = 'playwright_profile_' + Math.floor(Math.random() * 100000);
  // await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, playwright_profile_name);
  // await page.click('.button-primary');
  // await waitForPaceLoad(page);
  // await page.click('#name');
  // await page.fill('#name', playwright_profile_name);
  // await page.click('#saveBtn');
  // await tostr_detector(page);
  // await page.goto('manageLearnerProfiles.php');
  // await waitForPaceLoad(page);
  // await page.waitForSelector('#contentmanageLearningProfiles');
  // const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
  // const profileFound = profilegridText.includes(playwright_profile_name);
  // if (profileFound) {
  //     console.log(`\x1b[32mâœ… Verified: Profile "${playwright_profile_name}" appears in jqxGrid.\x1b[0m`);
  //   } else {
  //     console.log(`\x1b[31mâŒ ERROR: Profile "${playwright_profile_name}" NOT FOUND in jqxGrid!\x1b[0m`);
  // }


  // // assign profile to user
  // await page.goto('manageLearners.php');
  // await waitForPaceLoad(page);
  // await page.locator('.jqx-checkbox-default').nth(1).click();
  // await page.click('#setProfile > span');
  // await page.click('.search-field > input');
  // const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
  // await page.fill('.search-field > input', storedProfile);
  // await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({ state: 'visible' });
  // await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
  // await page.click('#setProfileBtn');
  // await page.locator('#saveBtn').waitFor({state : 'hidden'});
  // console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);

// create questions
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  const playwright_question1 = 'playwright_QUE1_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question1", name);}, playwright_question1);
  const playwright_question2 = 'playwright_QUE2_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question2", name);}, playwright_question2);
  const playwright_question3 = 'playwright_QUE3_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question3", name);}, playwright_question3);
  const playwright_question4 = 'playwright_QUE4_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question4", name);}, playwright_question4);
  const playwright_question5 = 'playwright_QUE5_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question5", name);}, playwright_question5);
  const playwright_question6 = 'playwright_QUE6_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question6", name);}, playwright_question6);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(1) > #lessonType-page-tab > div').waitFor({ state: 'visible' });
  await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
  await page.locator('#questionname').waitFor({ state: 'visible' });
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question1);
  await page.click('.select2-selection__rendered');
  await page.fill('.select2-search__field', 'tag1');
  await page.press('.select2-search__field', 'Enter');
  await page.locator('#option1').waitFor({ state: 'visible' });
  await page.click('#option1');
  await page.fill('#option1', 'opt1');
  await page.click('#addQuizQuestionOptionButton');
  await page.locator('#option2').waitFor({ state: 'visible' });
  await page.click('#option2');
  await page.fill('#option2', 'opt2');
  await page.click('#marks2');
  await page.fill('#marks2', '10');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);

  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText1 = await page.locator('#contentquestionGrid').innerText();
  const questionFound1 = questiongridText1.includes(playwright_question1);
  if (questionFound1) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question1}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question1}" NOT FOUND in jqxGrid!\x1b[0m`);
  }
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(1) > #lessonType-page-tab').waitFor({ state: 'visible' });;
  await page.click('.nav-item:nth-child(1) > #lessonType-page-tab');
  await page.locator('#questionname').waitFor({ state: 'visible' });;
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question2);
  await page.click('#option1');
  await page.fill('#option1', 'opt1');
  await page.click('#addQuizQuestionOptionButton');
  await page.click('#option2');
  await page.fill('#option2', 'opt2');
  await page.click('#addQuizQuestionOptionButton');
  await page.click('#option3');
  await page.fill('#option3', 'opt3');
  await page.click('#addQuizQuestionOptionButton');
  await page.click('#option4');
  await page.fill('#option4', 'opt4');
  await page.click('#marks3');
  await page.fill('#marks3', '10');
  await page.click('#marks1');
  await page.fill('#marks1', '10');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);

  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText2 = await page.locator('#contentquestionGrid').innerText();
  const questionFound2 = questiongridText2.includes(playwright_question2);
  if (questionFound2) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question2}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question2}" NOT FOUND in jqxGrid!\x1b[0m`);
  }
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(4) > #lessonType-page-tab').waitFor({ state: 'visible' });;
  await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
  await page.locator('#questionname').waitFor({ state: 'visible' });;
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question3);
  await page.click('#totalMarks');
  await page.fill('#totalMarks', '10');
  await page.click('.py-2:nth-child(2)');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText3 = await page.locator('#contentquestionGrid').innerText();
  const questionFound3 = questiongridText3.includes(playwright_question3);
  if (questionFound3) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question3}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question3}" NOT FOUND in jqxGrid!\x1b[0m`);
  }

  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(4) > #lessonType-page-tab').waitFor({ state: 'visible' });;
  await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
  await page.locator('#questionname').waitFor({ state: 'visible' });;
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question4);
  await page.click('#totalMarks');
  await page.fill('#totalMarks', '10');
  await page.click('.py-2:nth-child(2)');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText4 = await page.locator('#contentquestionGrid').innerText();
  const questionFound4 = questiongridText4.includes(playwright_question4);
  if (questionFound4) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question4}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question4}" NOT FOUND in jqxGrid!\x1b[0m`);
  }

  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(4) > #lessonType-page-tab').waitFor({ state: 'visible' });;
  await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
  await page.locator('#questionname').waitFor({ state: 'visible' });;
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question5);
  await page.click('#totalMarks');
  await page.fill('#totalMarks', '10');
  await page.click('.py-2:nth-child(2)');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText5 = await page.locator('#contentquestionGrid').innerText();
  const questionFound5 = questiongridText5.includes(playwright_question5);
  if (questionFound5) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question5}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question5}" NOT FOUND in jqxGrid!\x1b[0m`);
  }

  
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(4) > #lessonType-page-tab').waitFor({ state: 'visible' });;
  await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
  await page.locator('#questionname').waitFor({ state: 'visible' });;
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question6);
  await page.click('#totalMarks');
  await page.fill('#totalMarks', '10');
  await page.click('.py-2:nth-child(2)');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText6 = await page.locator('#contentquestionGrid').innerText();
  const questionFound6 = questiongridText6.includes(playwright_question6);
  if (questionFound6) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question6}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question6}" NOT FOUND in jqxGrid!\x1b[0m`);
  }

  // create question bank
  await page.goto('showQuestionBanks.php');
  await waitForPaceLoad(page);
  const playwright_que_bank_name = 'playwright_QUE_BANK_' + Math.floor(Math.random() * 100000);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel');
  await page.click('#bankName');
  await page.fill('#bankName', playwright_que_bank_name);
  await page.click('#description');
  await page.fill('#description', 'important questions');
  await page.click('#existingTab'); 
  await page.locator('#multiSelectExistingQuestionsModal .modal-content').waitFor({ state: 'visible' });
  async function clickCheckboxByTitle(page, title) {
  const scrollArea = page.locator('#contentquestionsGrid');
  await scrollArea.evaluate(el => el.scrollTop = 0);
  await page.waitForTimeout(150);
  const attempts = 3;

  for (let i = 0; i < attempts; i++) {
    const row = page.locator('[role="row"]', {
      has: page.locator('.activeTitleClass', { hasText: title })
    });

    if (await row.count() > 0) {
      await row.locator('.jqx-checkbox-default').click();
      return;
    }
    await scrollArea.evaluate(el => {
      el.scrollTop += 60;
    });

    await page.waitForTimeout(150);
  }

  throw new Error(`Row "${title}" not found in first visible range`);
}

  const ques1 = await page.evaluate(() => {return localStorage.getItem("question1");});
  const ques2 = await page.evaluate(() => {return localStorage.getItem("question2");});
  const ques3 = await page.evaluate(() => {return localStorage.getItem("question3");});
  const ques4 = await page.evaluate(() => {return localStorage.getItem("question4");});
  const ques5 = await page.evaluate(() => {return localStorage.getItem("question5");});
  const ques6 = await page.evaluate(() => {return localStorage.getItem("question6");});

  const titles = [
    ques6,
    ques5,
    ques4,
    ques3,
  ];

  for (const title of titles) {
    await clickCheckboxByTitle(page, title);
  }
  await page.getByRole('button', { name: 'Confirm' }).click();
  await page.waitForSelector('#contentselectedQuestionsGrid', { state: 'visible' });
  await page.waitForTimeout(2000);
  await page.click('#existingTab'); 
  await page.locator('#multiSelectExistingQuestionsModal .modal-content').waitFor({ state: 'visible' });
  const titles2 = [
    ques2,
    ques1,
  ];

  for (const title of titles2) {
    await clickCheckboxByTitle(page, title);
  }

  await page.getByRole('button', { name: 'Confirm' }).click();
  await page.waitForSelector('#contentselectedQuestionsGrid', { state: 'visible' });
  await page.click('#setBankNameOnExistingQuestions > .ladda-label');
  await tostr_detector(page);
  await page.waitForURL('showQuestionBanks.php');
  await waitForPaceLoad(page);
  await page.goto('showQuestionBanks.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionBanksGrid');
  const questionbankgridText = await page.locator('#contentquestionBanksGrid').innerText();
  const questionbankFound = questionbankgridText.includes(playwright_que_bank_name);
  if (questionbankFound) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_que_bank_name}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_que_bank_name}" NOT FOUND in jqxGrid!\x1b[0m`);
  }


  //create quiz with question bank
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  const playwright_quiz_name = 'playwright_quiz_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("QuizName", name);}, playwright_quiz_name);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#name');
  await page.fill('#name',playwright_quiz_name);
  await page.click('#estimatedTime');
  await page.fill('#estimatedTime', '10');
  const user_Name = await page.evaluate(() => {return localStorage.getItem("UserName");});
  await page.locator('.col-sm-3 > .simple-switch-outter').first().click();
  await page.getByRole('textbox', { name: 'Select Users' }).click();
  await page.getByRole('textbox', { name: 'Select Users' }).fill(user_Name);
  await page.locator(`.select2-results__option:has-text("${user_Name}")`).waitFor({state:'visible'});
  await page.click(`.select2-results__option:has-text("${user_Name}")`);
  await page.getByText('By Question Bank').click();
  await page.locator('div.questionBankMainDiv').locator('#addQuesBankBtn').click();
  await page.locator('h5.modal-title', { hasText: 'Question Bank' }).waitFor({state: 'visible'});
  await page.waitForTimeout(2000);
  await page.locator('#questionBanksGrid').waitFor({ state: 'visible' });
  const row = page.locator('#contentquestionBanksGrid [role="row"]', {
    has: page.locator(`[title="${playwright_que_bank_name}"]`)
  });
  await row.click();
  await page.waitForTimeout(2000);
  await page.pause();
  await page.getByRole('button', { name: 'Add', exact: true }).click();
  await page.locator('table.table-striped').waitFor({ state: 'visible' });
  const bankRow = page.locator('table.table-striped tbody tr td', { hasText: playwright_que_bank_name });
  if (await bankRow.count() > 0) {
    console.log('Question bank is added successfully');
  } else {
    console.log('Question bank not found');
  }
  await page.locator('#maxquestions').click();
  await page.locator('#maxquestions').fill('5');
  await page.getByRole('button', { name: 'Save Module' }).click();
  await tostr_detector(page);
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentmanageModulesGrid');
  const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
  const quizFound = quizgridText.includes(playwright_quiz_name);
  if (quizFound) {
      console.log(`\x1b[32mâœ… Verified: Quiz "${playwright_quiz_name}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Quiz "${playwright_quiz_name}" NOT FOUND in jqxGrid!\x1b[0m`);
  }


  // login user
  await page.goto('userui/login/');
  await page.locator('#basic_username').waitFor({ state: 'visible' });
  await page.locator('#basic_username').click();
  const self_userName = await page.evaluate(() => { return localStorage.getItem('UserName'); });
  await page.locator('#basic_username').fill(self_userName);
  await page.locator('#basic_password').click();
  await page.locator('#basic_password').fill('12345678');
  await page.getByRole('button', { name: 'Log In' }).click();
  await page.waitForURL('userui/dashboard/');
  await page.waitForLoadState('networkidle');
  console.log('\x1b[32m%s\x1b[0m', "learner logged in successfully.");

// attempt quiz module
  await page.goto('userui/modules/');
  await page.waitForLoadState('networkidle');
  await page.getByRole('textbox', { name: 'Search Module' }).click();
  const storedModulequiz = await page.evaluate(() => {return localStorage.getItem("QuizName");});
  await page.getByRole('textbox', { name: 'Search Module' }).fill(storedModulequiz);
  await page.getByRole('textbox', { name: 'Search Module' }).press('Enter');
  await page.getByRole('button', { name: 'Launch' }).click();
  await page.waitForLoadState('networkidle');
  const questionText = await page.locator('div.flex h4', { hasText: 'Question' }).textContent();
  const match = questionText.match(/Question \d+ of (\d+)/);
  let totalQuestions = 0;
  if (match) {
    totalQuestions = parseInt(match[1], 10);
    console.log('Total question count is:', totalQuestions);
  } else {
    console.log('Could not find total question count');
  }
  if(totalQuestions==='5'){
    console.log('Total question count is equal , randomize question count');
  }else{
    console.log('Total question count is not equal , randomize question count');
  }
  async function getQuestionName() {
    await page.waitForSelector('div.question-card div.ant-card-head-title div');
    const locator = page.locator('div.question-card div.ant-card-head-title div');
    const name = await locator.textContent();
    return name.trim();
  }
  const questionNames = [];

  questionNames.push(await getQuestionName());
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(2000);
  questionNames.push(await getQuestionName());
  await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
  await page.click('.primary');
  await page.waitForTimeout(2000);
  questionNames.push(await getQuestionName());
  await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(2000);
  questionNames.push(await getQuestionName());
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(2000);
  questionNames.push(await getQuestionName());
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.getByRole('button', { name: 'Finish' }).click();
  await page.waitForLoadState('networkidle');
  console.log('Captured Question Names:', questionNames);
  const queNumbers = questionNames.map(q => {
    const match = q.match(/QUE(\d+)_/);
    return match ? parseInt(match[1], 10) : null;
  });
  const inOrder = queNumbers.every((num, idx) => num === idx + 1);
  if (inOrder) {
    console.log('Questions are shown in order:', queNumbers);
  } else {
    console.log('Questions are not in order (random):', queNumbers);
  }
  await page.getByRole('banner').locator('img').click();
  await page.getByText('Logout').click();
  await page.locator('#basic_username').waitFor({ state: 'visible' });


  await login(page);
  // user deletion
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);

  // delete quiz module
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  console.log(`\x1b[32mâœ… tostr result for quiz deletion \x1b[0m`);
  await tostr_detector(page);

  // delete question bank
  await page.goto('showQuestionBanks.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  console.log(`\x1b[32mâœ… tostr result for question bank deletion \x1b[0m`);
  await tostr_detector(page);

  // delete questions
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.locator('.jqx-checkbox-default').nth(4).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await page.locator('.jqx-checkbox-default').nth(5).click();
  await page.locator('.jqx-checkbox-default').nth(6).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  console.log(`\x1b[32mâœ… tostr result for questions deletion \x1b[0m`);
  await tostr_detector(page);
});
test('module_quiz_via_question_bank_randomize_with_learningplan', async ({ page }) => {
  test.setTimeout(2000000);

  await attachNetworkLogger(page);
  await login(page);

  //create user
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  const playwright_user_name = 'playwright_user_' + Math.floor(Math.random() * 100000);
  await page.evaluate((val)=>{localStorage.setItem("UserName",val);},playwright_user_name);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#username');
  await page.fill('#username', playwright_user_name);
  await page.click('#password');
  await page.fill('#password', '12345678');
  await page.click('#name');
  await page.fill('#name', playwright_user_name);
  await page.click('#emailid');
  await page.fill('#emailid', 'satyainfopages.sapna@gmail.com');
  await page.click('#saveBtn');
  await tostr_detector(page);
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentlearnersGrid');
  const usergridText1 = await page.locator('#contentlearnersGrid').innerText();
  const userFound1 = usergridText1.includes(playwright_user_name);
  if (userFound1) {
      console.log(`\x1b[32mâœ… Verified: User "${playwright_user_name}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: User "${playwright_user_name}" NOT FOUND in jqxGrid!\x1b[0m`);
  }
  
  
  //create profile
  await page.goto('manageLearnerProfiles.php');
  await waitForPaceLoad(page);
  const playwright_profile_name = 'playwright_profile_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("ProfileName", name);}, playwright_profile_name);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#name');
  await page.fill('#name', playwright_profile_name);
  await page.click('#saveBtn');
  await tostr_detector(page);
  await page.goto('manageLearnerProfiles.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentmanageLearningProfiles');
  const profilegridText = await page.locator('#contentmanageLearningProfiles').innerText();
  const profileFound = profilegridText.includes(playwright_profile_name);
  if (profileFound) {
      console.log(`\x1b[32mâœ… Verified: Profile "${playwright_profile_name}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Profile "${playwright_profile_name}" NOT FOUND in jqxGrid!\x1b[0m`);
  }


  // assign profile to user
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#setProfile > span');
  await page.click('.search-field > input');
  const storedProfile = await page.evaluate(() => localStorage.getItem("ProfileName"));
  await page.fill('.search-field > input', storedProfile);
  await page.locator(`.chosen-results li:has-text("${storedProfile}")`).waitFor({ state: 'visible' });
  await page.locator(`.chosen-results li:has-text("${storedProfile}")`).click();
  await page.click('#setProfileBtn');
  await page.locator('#saveBtn').waitFor({state : 'hidden'});
  console.log(`\x1b[32mâœ… Profile "${storedProfile}" assigned to user.\x1b[0m`);

// create questions
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  const playwright_question1 = 'playwright_QUE1_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question1", name);}, playwright_question1);
  const playwright_question2 = 'playwright_QUE2_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question2", name);}, playwright_question2);
  const playwright_question3 = 'playwright_QUE3_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question3", name);}, playwright_question3);
  const playwright_question4 = 'playwright_QUE4_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question4", name);}, playwright_question4);
  const playwright_question5 = 'playwright_QUE5_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question5", name);}, playwright_question5);
  const playwright_question6 = 'playwright_QUE6_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("question6", name);}, playwright_question6);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(1) > #lessonType-page-tab > div').waitFor({ state: 'visible' });
  await page.click('.nav-item:nth-child(1) > #lessonType-page-tab > div');
  await page.locator('#questionname').waitFor({ state: 'visible' });
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question1);
  await page.click('.select2-selection__rendered');
  await page.fill('.select2-search__field', 'tag1');
  await page.press('.select2-search__field', 'Enter');
  await page.locator('#option1').waitFor({ state: 'visible' });
  await page.click('#option1');
  await page.fill('#option1', 'opt1');
  await page.click('#addQuizQuestionOptionButton');
  await page.locator('#option2').waitFor({ state: 'visible' });
  await page.click('#option2');
  await page.fill('#option2', 'opt2');
  await page.click('#marks2');
  await page.fill('#marks2', '10');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);

  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText1 = await page.locator('#contentquestionGrid').innerText();
  const questionFound1 = questiongridText1.includes(playwright_question1);
  if (questionFound1) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question1}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question1}" NOT FOUND in jqxGrid!\x1b[0m`);
  }
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(2) > #lessonType-page-tab').waitFor({ state: 'visible' });;
  await page.click('.nav-item:nth-child(2) > #lessonType-page-tab');
  await page.locator('#questionname').waitFor({ state: 'visible' });;
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question2);
  await page.click('#option1');
  await page.fill('#option1', 'opt1');
  await page.click('#addQuizQuestionOptionButton');
  await page.click('#option2');
  await page.fill('#option2', 'opt2');
  await page.click('#addQuizQuestionOptionButton');
  await page.click('#option3');
  await page.fill('#option3', 'opt3');
  await page.click('#addQuizQuestionOptionButton');
  await page.click('#option4');
  await page.fill('#option4', 'opt4');
  await page.click('#marks3');
  await page.fill('#marks3', '10');
  await page.click('#marks1');
  await page.fill('#marks1', '10');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);

  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText2 = await page.locator('#contentquestionGrid').innerText();
  const questionFound2 = questiongridText2.includes(playwright_question2);
  if (questionFound2) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question2}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question2}" NOT FOUND in jqxGrid!\x1b[0m`);
  }
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(4) > #lessonType-page-tab').waitFor({ state: 'visible' });;
  await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
  await page.locator('#questionname').waitFor({ state: 'visible' });;
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question3);
  await page.click('#totalMarks');
  await page.fill('#totalMarks', '10');
  await page.click('.py-2:nth-child(2)');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText3 = await page.locator('#contentquestionGrid').innerText();
  const questionFound3 = questiongridText3.includes(playwright_question3);
  if (questionFound3) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question3}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question3}" NOT FOUND in jqxGrid!\x1b[0m`);
  }

  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(4) > #lessonType-page-tab').waitFor({ state: 'visible' });;
  await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
  await page.locator('#questionname').waitFor({ state: 'visible' });;
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question4);
  await page.click('#totalMarks');
  await page.fill('#totalMarks', '10');
  await page.click('.py-2:nth-child(2)');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText4 = await page.locator('#contentquestionGrid').innerText();
  const questionFound4 = questiongridText4.includes(playwright_question4);
  if (questionFound4) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question4}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question4}" NOT FOUND in jqxGrid!\x1b[0m`);
  }

  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(4) > #lessonType-page-tab').waitFor({ state: 'visible' });;
  await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
  await page.locator('#questionname').waitFor({ state: 'visible' });;
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question5);
  await page.click('#totalMarks');
  await page.fill('#totalMarks', '10');
  await page.click('.py-2:nth-child(2)');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText5 = await page.locator('#contentquestionGrid').innerText();
  const questionFound5 = questiongridText5.includes(playwright_question5);
  if (questionFound5) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question5}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question5}" NOT FOUND in jqxGrid!\x1b[0m`);
  }

  
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel > svg');
  await page.locator('.nav-item:nth-child(4) > #lessonType-page-tab').waitFor({ state: 'visible' });;
  await page.click('.nav-item:nth-child(4) > #lessonType-page-tab');
  await page.locator('#questionname').waitFor({ state: 'visible' });;
  await page.click('#questionname');
  await page.fill('#questionname', playwright_question6);
  await page.click('#totalMarks');
  await page.fill('#totalMarks', '10');
  await page.click('.py-2:nth-child(2)');
  await page.click('#saveQuesBtn');
  await page.waitForURL('showQuestions.php');
  await waitForPaceLoad(page);
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionGrid');
  const questiongridText6 = await page.locator('#contentquestionGrid').innerText();
  const questionFound6 = questiongridText6.includes(playwright_question6);
  if (questionFound6) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_question6}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_question6}" NOT FOUND in jqxGrid!\x1b[0m`);
  }

  // create question bank
  await page.goto('showQuestionBanks.php');
  await waitForPaceLoad(page);
  const playwright_que_bank_name = 'playwright_QUE_BANK_' + Math.floor(Math.random() * 100000);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#quizQuestionTypeLabel');
  await page.click('#bankName');
  await page.fill('#bankName', playwright_que_bank_name);
  await page.click('#description');
  await page.fill('#description', 'important questions');
  await page.click('#existingTab'); 
  await page.locator('#multiSelectExistingQuestionsModal .modal-content').waitFor({ state: 'visible' });
  async function clickCheckboxByTitle(page, title) {
  const scrollArea = page.locator('#contentquestionsGrid');
  await scrollArea.evaluate(el => el.scrollTop = 0);
  await page.waitForTimeout(150);
  const attempts = 3;

  for (let i = 0; i < attempts; i++) {
    const row = page.locator('[role="row"]', {
      has: page.locator('.activeTitleClass', { hasText: title })
    });

    if (await row.count() > 0) {
      await row.locator('.jqx-checkbox-default').click();
      return;
    }
    await scrollArea.evaluate(el => {
      el.scrollTop += 60;
    });

    await page.waitForTimeout(150);
  }

  throw new Error(`Row "${title}" not found in first visible range`);
}

  const ques1 = await page.evaluate(() => {return localStorage.getItem("question1");});
  const ques2 = await page.evaluate(() => {return localStorage.getItem("question2");});
  const ques3 = await page.evaluate(() => {return localStorage.getItem("question3");});
  const ques4 = await page.evaluate(() => {return localStorage.getItem("question4");});
  const ques5 = await page.evaluate(() => {return localStorage.getItem("question5");});
  const ques6 = await page.evaluate(() => {return localStorage.getItem("question6");});

  const titles = [
    ques6,
    ques5,
    ques4,
    ques3,
  ];

  for (const title of titles) {
    await clickCheckboxByTitle(page, title);
  }
  await page.getByRole('button', { name: 'Confirm' }).click();
  await page.waitForSelector('#contentselectedQuestionsGrid', { state: 'visible' });
  await page.waitForTimeout(2000);
  await page.click('#existingTab'); 
  await page.locator('#multiSelectExistingQuestionsModal .modal-content').waitFor({ state: 'visible' });
  const titles2 = [
    ques2,
    ques1,
  ];

  for (const title of titles2) {
    await clickCheckboxByTitle(page, title);
  }

  await page.getByRole('button', { name: 'Confirm' }).click();
  await page.waitForSelector('#contentselectedQuestionsGrid', { state: 'visible' });
  await page.pause();
  await page.click('#setBankNameOnExistingQuestions > .ladda-label');
  await tostr_detector(page);
  await page.waitForURL('showQuestionBanks.php');
  await waitForPaceLoad(page);
  await page.goto('showQuestionBanks.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentquestionBanksGrid');
  const questionbankgridText = await page.locator('#contentquestionBanksGrid').innerText();
  const questionbankFound = questionbankgridText.includes(playwright_que_bank_name);
  if (questionbankFound) {
      console.log(`\x1b[32mâœ… Verified: Question "${playwright_que_bank_name}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Question "${playwright_que_bank_name}" NOT FOUND in jqxGrid!\x1b[0m`);
  }


  //create quiz with question bank
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  const playwright_quiz_name = 'playwright_quiz_' + Math.floor(Math.random() * 100000);
  await page.evaluate((name) => {localStorage.setItem("QuizName", name);}, playwright_quiz_name);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#name');
  await page.fill('#name',playwright_quiz_name);
  await page.click('#estimatedTime');
  await page.fill('#estimatedTime', '10');
  await page.getByText('By Question Bank').click();
  await page.locator('div.questionBankMainDiv').locator('#addQuesBankBtn').click();
  await page.locator('h5.modal-title', { hasText: 'Question Bank' }).waitFor({state: 'visible'});
  await page.locator('#questionBanksGrid').waitFor({ state: 'visible' });
  const row = page.locator('#contentquestionBanksGrid [role="row"]', {
    has: page.locator(`[title="${playwright_que_bank_name}"]`)
  });
  await row.click();
  await page.waitForTimeout(1000);
  await page.getByRole('button', { name: 'Add', exact: true }).click();
  await page.locator('table.table-striped').waitFor({ state: 'visible' });
  const bankRow = page.locator('table.table-striped tbody tr td', { hasText: playwright_que_bank_name });
  if (await bankRow.count() > 0) {
    console.log('Question bank is added successfully');
  } else {
    console.log('Question bank not found');
  }
  await page.getByRole('button', { name: 'Save Module' }).click();
  await tostr_detector(page);
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentmanageModulesGrid');
  const quizgridText = await page.locator('#contentmanageModulesGrid').innerText();
  const quizFound = quizgridText.includes(playwright_quiz_name);
  if (quizFound) {
      console.log(`\x1b[32mâœ… Verified: Quiz "${playwright_quiz_name}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: Quiz "${playwright_quiz_name}" NOT FOUND in jqxGrid!\x1b[0m`);
  }

//create learning plan
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  const playwright_learningplan_name = 'playwright_lp_' + Math.floor(Math.random() * 100000);
  await page.evaluate((val)=>{localStorage.setItem("LPName",val);},playwright_learningplan_name);
  await page.click('.button-primary');
  await waitForPaceLoad(page);
  await page.click('#name');
  await page.fill('#name', playwright_learningplan_name);
  await page.click('#profilesDiv .select2-search__field');
  const storedprofilename = await page.evaluate(() => {return localStorage.getItem("ProfileName");});
  await page.fill('#profilesDiv .select2-search__field', storedprofilename);
  await page.press('#profilesDiv .select2-search__field', 'Enter');
  await page.click('#addModuleButton > .ladda-label');
  await page.click('.quesModuleLbl:nth-child(2)');
  const storedquizname = await page.evaluate(() => {return localStorage.getItem("QuizName");});
  await page.click('.select2-selection__placeholder');
  await page.fill('.select2-search--dropdown > .select2-search__field', storedquizname);
  await page.locator(`.select2-results__option:has-text("${storedquizname}")`).waitFor({ state: 'visible' });
  await page.click(`.select2-results__option:has-text("${storedquizname}")`);
  await page.click('#moduleOk > .ladda-label');
  await page.locator('#viewQuestionModel .modal-content').waitFor({ state: 'hidden' });
  console.log('quiz1 module added in learningplan.');
  const quiz1dataid = await page.locator('.modulediv_each:last-of-type').getAttribute('data-id');
  console.log('quiz 1 data id for proctoring: ',quiz1dataid);
  const latestModule1 = page.locator(`.modulediv_each[data-id="${quiz1dataid}"]`);
  await latestModule1.locator('.checkblock', { hasText: 'Randomize Question' }).click();
  // const randomizeid = `#israndom${quiz1dataid}`;
  // console.log(' quiz randomizecheckbox id: ',randomizeid);
  // await page.check(`input[name="${randomizeid}"]`);
  await page.locator('input#israndom').click();
  const randomizeMaxQuesCount = `#maxquestions${quiz1dataid}`;
  console.log(' quiz randomize ques count input field id: ',randomizeMaxQuesCount);
  await page.locator(randomizeMaxQuesCount).click();
  await page.locator(randomizeMaxQuesCount).fill('5');
  await page.pause();
  // await page.getByRole('a', { name: 'OK' }).click();
  await page.locator('#israndom').nth(1).click();
  await page.pause();
  await page.click('#saveBtn');
  await tostr_detector(page);
  await page.locator('#saveBtn').waitFor({state:'hidden'});
  await page.goto('ManageLearningPlan.php');
  await waitForPaceLoad(page);
  await page.waitForSelector('#contentlearningPlanGrid');
  const lpgridText = await page.locator('#contentlearningPlanGrid').innerText();
  const lpFound = lpgridText.includes(playwright_learningplan_name);
  if (lpFound) {
      console.log(`\x1b[32mâœ… Verified: LearningPlan "${playwright_learningplan_name}" appears in jqxGrid.\x1b[0m`);
    } else {
      console.log(`\x1b[31mâŒ ERROR: LearningPlan "${playwright_learningplan_name}" NOT FOUND in jqxGrid!\x1b[0m`);
  }


    // lerning plan activation call 
  await execute_learningplan_activation_cron(page);


  // login user
  await page.goto('userui/login/');
  await page.locator('#basic_username').waitFor({ state: 'visible' });
  await page.locator('#basic_username').click();
  const self_userName = await page.evaluate(() => { return localStorage.getItem('UserName'); });
  await page.locator('#basic_username').fill(self_userName);
  await page.locator('#basic_password').click();
  await page.locator('#basic_password').fill('12345678');
  await page.getByRole('button', { name: 'Log In' }).click();
  await page.waitForURL('userui/dashboard/');
  await page.waitForLoadState('networkidle');
  console.log('\x1b[32m%s\x1b[0m', "learner logged in successfully.");


  // attempt lp 
  await page.goto('userui/timeline/');
  await page.waitForLoadState('networkidle');
  await page.click('.ant-select-selection-item');
  const storedLP1 = await page.evaluate(() => {return localStorage.getItem("LPName");});
  await page.fill('.ant-select-selection-search-input', storedLP1);
  await page.locator(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`).waitFor({state:'visible'});
  await page.click(`.ant-select-dropdown .ant-select-item-option:has-text("${storedLP1}")`);
  const stored_quiz = await page.evaluate(() => localStorage.getItem("QuizName"));
  const targetCard = page.locator('.card-module-container', { hasText: stored_quiz });
  await page.getByRole('button', { name: 'Launch' }).click();
  await page.waitForLoadState('networkidle');
  const questionText = await page.locator('div.flex h4', { hasText: 'Question' }).textContent();
  const match = questionText.match(/Question \d+ of (\d+)/);
  let totalQuestions = 0;
  if (match) {
    totalQuestions = parseInt(match[1], 10);
    console.log('Total question count is:', totalQuestions);
  } else {
    console.log('Could not find total question count');
  }
  if(totalQuestions==='5'){
    console.log('Total question count is equal , randomize question count');
  }else{
    console.log('Total question count is not equal , randomize question count');
  }
  async function getQuestionName() {
    await page.waitForSelector('div.question-card div.ant-card-head-title div');
    const locator = page.locator('div.question-card div.ant-card-head-title div');
    const name = await locator.textContent();
    return name.trim();
  }
  const questionNames = [];

  questionNames.push(await getQuestionName());
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(2000);
  questionNames.push(await getQuestionName());
  await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
  await page.click('.primary');
  await page.waitForTimeout(2000);
  questionNames.push(await getQuestionName());
  await page.click('.ant-space-item:nth-child(1) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(2000);
  questionNames.push(await getQuestionName());
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.click('.primary > span');
  await page.waitForTimeout(2000);
  questionNames.push(await getQuestionName());
  await page.click('.ant-space-item:nth-child(2) .ant-radio-input');
  await page.getByRole('button', { name: 'Finish' }).click();
  await page.waitForLoadState('networkidle');
  console.log('Captured Question Names:', questionNames);
  const queNumbers = questionNames.map(q => {
    const match = q.match(/QUE(\d+)_/);
    return match ? parseInt(match[1], 10) : null;
  });
  const inOrder = queNumbers.every((num, idx) => num === idx + 1);
  if (inOrder) {
    console.log('Questions are shown in order:', queNumbers);
  } else {
    console.log('Questions are not in order (random):', queNumbers);
  }
  await page.pause();
  await page.getByRole('banner').locator('img').click();
  await page.getByText('Logout').click();
  await page.locator('#basic_username').waitFor({ state: 'visible' });


  await login(page);
  // user deletion
  await page.goto('manageLearners.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await tostr_detector(page);

  // delete quiz module
  await page.goto('showModulesGrid.php?type=quiz');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  console.log(`\x1b[32mâœ… tostr result for quiz deletion \x1b[0m`);
  await tostr_detector(page);

  // delete question bank
  await page.goto('showQuestionBanks.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  console.log(`\x1b[32mâœ… tostr result for question bank deletion \x1b[0m`);
  await tostr_detector(page);

  // delete questions
  await page.goto('showQuestions.php');
  await waitForPaceLoad(page);
  await page.locator('.jqx-checkbox-default').nth(1).click();
  await page.locator('.jqx-checkbox-default').nth(2).click();
  await page.locator('.jqx-checkbox-default').nth(3).click();
  await page.locator('.jqx-checkbox-default').nth(4).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  await page.locator('.jqx-checkbox-default').nth(5).click();
  await page.locator('.jqx-checkbox-default').nth(6).click();
  await page.click('#deleteContainer');
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'visible'});
  await page.getByRole('button', { name: 'OK' }).click();
  await page.getByRole('button', { name: 'OK' }).waitFor({state:'hidden'});
  console.log(`\x1b[32mâœ… tostr result for questions deletion \x1b[0m`);
  await tostr_detector(page);
});








